<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lukas Arnold">
<meta name="author" content="Simone Arnold">
<meta name="author" content="Florian Bagemihl">
<meta name="author" content="Matthias Baitsch">
<meta name="author" content="Marc Fehr">
<meta name="author" content="Maik Poetzsch">
<meta name="author" content="Sebastian Seipel">

<title>Methodenbaustein Einlesen strukturierter Datensätze</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="einlesen-strukturierter-datensätze_files/libs/clipboard/clipboard.min.js"></script>
<script src="einlesen-strukturierter-datensätze_files/libs/quarto-html/quarto.js"></script>
<script src="einlesen-strukturierter-datensätze_files/libs/quarto-html/popper.min.js"></script>
<script src="einlesen-strukturierter-datensätze_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="einlesen-strukturierter-datensätze_files/libs/quarto-html/anchor.min.js"></script>
<link href="einlesen-strukturierter-datensätze_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="einlesen-strukturierter-datensätze_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="einlesen-strukturierter-datensätze_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="einlesen-strukturierter-datensätze_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="einlesen-strukturierter-datensätze_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#voraussetzungen" id="toc-voraussetzungen" class="nav-link active" data-scroll-target="#voraussetzungen"><span class="header-section-number">1</span> Voraussetzungen</a></li>
  <li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">2</span> Lernziele</a></li>
  <li><a href="#einleitung" id="toc-einleitung" class="nav-link" data-scroll-target="#einleitung"><span class="header-section-number">3</span> Einleitung</a></li>
  <li><a href="#grundlagen-merkmale-von-datensätzen" id="toc-grundlagen-merkmale-von-datensätzen" class="nav-link" data-scroll-target="#grundlagen-merkmale-von-datensätzen"><span class="header-section-number">4</span> Grundlagen: Merkmale von Datensätzen</a>
  <ul class="collapse">
  <li><a href="#technisches-format" id="toc-technisches-format" class="nav-link" data-scroll-target="#technisches-format"><span class="header-section-number">4.1</span> Technisches Format</a></li>
  <li><a href="#struktur" id="toc-struktur" class="nav-link" data-scroll-target="#struktur"><span class="header-section-number">4.2</span> Struktur</a>
  <ul class="collapse">
  <li><a href="#eindimensionale-datensätze" id="toc-eindimensionale-datensätze" class="nav-link" data-scroll-target="#eindimensionale-datensätze">Eindimensionale Datensätze</a></li>
  <li><a href="#eindimensionale-daten-einlesen-mit-python" id="toc-eindimensionale-daten-einlesen-mit-python" class="nav-link" data-scroll-target="#eindimensionale-daten-einlesen-mit-python">Eindimensionale Daten einlesen mit Python</a></li>
  <li><a href="#zweidimensionale-datensätze" id="toc-zweidimensionale-datensätze" class="nav-link" data-scroll-target="#zweidimensionale-datensätze">Zweidimensionale Datensätze</a></li>
  <li><a href="#long--und-wide-format" id="toc-long--und-wide-format" class="nav-link" data-scroll-target="#long--und-wide-format">long- und wide-Format</a></li>
  <li><a href="#übung-zweidimensionale-datensätze" id="toc-übung-zweidimensionale-datensätze" class="nav-link" data-scroll-target="#übung-zweidimensionale-datensätze">Übung zweidimensionale Datensätze</a></li>
  <li><a href="#drei--und-mehrdimensionale-datensätze" id="toc-drei--und-mehrdimensionale-datensätze" class="nav-link" data-scroll-target="#drei--und-mehrdimensionale-datensätze">Drei- und mehrdimensionale Datensätze</a></li>
  <li><a href="#übung-dreidimensionale-datensätze" id="toc-übung-dreidimensionale-datensätze" class="nav-link" data-scroll-target="#übung-dreidimensionale-datensätze">Übung dreidimensionale Datensätze</a></li>
  </ul></li>
  <li><a href="#sec-datentyp" id="toc-sec-datentyp" class="nav-link" data-scroll-target="#sec-datentyp"><span class="header-section-number">4.3</span> Datentyp</a>
  <ul class="collapse">
  <li><a href="#sec-missing" id="toc-sec-missing" class="nav-link" data-scroll-target="#sec-missing">Fehlende Werte</a></li>
  <li><a href="#fehlende-werte-in-der-praxis" id="toc-fehlende-werte-in-der-praxis" class="nav-link" data-scroll-target="#fehlende-werte-in-der-praxis">Fehlende Werte in der Praxis</a></li>
  </ul></li>
  <li><a href="#sec-metadaten" id="toc-sec-metadaten" class="nav-link" data-scroll-target="#sec-metadaten"><span class="header-section-number">4.4</span> Metadaten</a></li>
  </ul></li>
  <li><a href="#sec-numpypandas" id="toc-sec-numpypandas" class="nav-link" data-scroll-target="#sec-numpypandas"><span class="header-section-number">5</span> Die Module NumPy und Pandas</a>
  <ul class="collapse">
  <li><a href="#datentypen" id="toc-datentypen" class="nav-link" data-scroll-target="#datentypen"><span class="header-section-number">5.1</span> Datentypen</a></li>
  <li><a href="#dateien-lesen-und-schreiben" id="toc-dateien-lesen-und-schreiben" class="nav-link" data-scroll-target="#dateien-lesen-und-schreiben"><span class="header-section-number">5.2</span> Dateien lesen und schreiben</a></li>
  <li><a href="#datentypen-erkennen-und-festlegen" id="toc-datentypen-erkennen-und-festlegen" class="nav-link" data-scroll-target="#datentypen-erkennen-und-festlegen"><span class="header-section-number">5.3</span> Datentypen erkennen und festlegen</a>
  <ul class="collapse">
  <li><a href="#numpy-1" id="toc-numpy-1" class="nav-link" data-scroll-target="#numpy-1">NumPy</a></li>
  <li><a href="#pandas-1" id="toc-pandas-1" class="nav-link" data-scroll-target="#pandas-1">Pandas</a></li>
  <li><a href="#aufgabe-datentypen" id="toc-aufgabe-datentypen" class="nav-link" data-scroll-target="#aufgabe-datentypen">Aufgabe Datentypen</a></li>
  </ul></li>
  <li><a href="#umgang-mit-fehlenden-werten" id="toc-umgang-mit-fehlenden-werten" class="nav-link" data-scroll-target="#umgang-mit-fehlenden-werten"><span class="header-section-number">5.4</span> Umgang mit fehlenden Werten</a>
  <ul class="collapse">
  <li><a href="#numpy-2" id="toc-numpy-2" class="nav-link" data-scroll-target="#numpy-2">NumPy</a></li>
  <li><a href="#pandas-2" id="toc-pandas-2" class="nav-link" data-scroll-target="#pandas-2">Pandas</a></li>
  <li><a href="#aufgabe-fehlende-werte" id="toc-aufgabe-fehlende-werte" class="nav-link" data-scroll-target="#aufgabe-fehlende-werte">Aufgabe fehlende Werte</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-zeitreihen" id="toc-sec-zeitreihen" class="nav-link" data-scroll-target="#sec-zeitreihen"><span class="header-section-number">6</span> Zeitreihen</a>
  <ul class="collapse">
  <li><a href="#datums--und-zeitinformationen-in-python" id="toc-datums--und-zeitinformationen-in-python" class="nav-link" data-scroll-target="#datums--und-zeitinformationen-in-python"><span class="header-section-number">6.1</span> Datums- und Zeitinformationen in Python</a>
  <ul class="collapse">
  <li><a href="#alles-ist-relativ-die-epoche" id="toc-alles-ist-relativ-die-epoche" class="nav-link" data-scroll-target="#alles-ist-relativ-die-epoche">Alles ist relativ: die Epoche</a></li>
  <li><a href="#naive-und-bewusste-datetime-objekte" id="toc-naive-und-bewusste-datetime-objekte" class="nav-link" data-scroll-target="#naive-und-bewusste-datetime-objekte">Naive und bewusste Datetime-Objekte</a></li>
  <li><a href="#zeit" id="toc-zeit" class="nav-link" data-scroll-target="#zeit">Zeit</a></li>
  <li><a href="#kalender" id="toc-kalender" class="nav-link" data-scroll-target="#kalender">Kalender</a></li>
  </ul></li>
  <li><a href="#datum-und-zeit-in-numpy-und-pandas" id="toc-datum-und-zeit-in-numpy-und-pandas" class="nav-link" data-scroll-target="#datum-und-zeit-in-numpy-und-pandas"><span class="header-section-number">6.2</span> Datum und Zeit in NumPy und Pandas</a></li>
  <li><a href="#zeitreihen-einlesen" id="toc-zeitreihen-einlesen" class="nav-link" data-scroll-target="#zeitreihen-einlesen"><span class="header-section-number">6.3</span> Zeitreihen einlesen</a></li>
  <li><a href="#zugriff-auf-zeitreihen" id="toc-zugriff-auf-zeitreihen" class="nav-link" data-scroll-target="#zugriff-auf-zeitreihen"><span class="header-section-number">6.4</span> Zugriff auf Zeitreihen</a></li>
  <li><a href="#sec-übungenzeitreihen" id="toc-sec-übungenzeitreihen" class="nav-link" data-scroll-target="#sec-übungenzeitreihen"><span class="header-section-number">6.5</span> Übungen: Zeitreihen einlesen</a>
  <ul class="collapse">
  <li><a href="#zeitzonen-in-numpy-und-pandas" id="toc-zeitzonen-in-numpy-und-pandas" class="nav-link" data-scroll-target="#zeitzonen-in-numpy-und-pandas">Zeitzonen in NumPy und Pandas</a></li>
  </ul></li>
  <li><a href="#fehlende-werte-in-zeitreihen" id="toc-fehlende-werte-in-zeitreihen" class="nav-link" data-scroll-target="#fehlende-werte-in-zeitreihen"><span class="header-section-number">6.6</span> fehlende Werte in Zeitreihen</a></li>
  </ul></li>
  <li><a href="#zugriff-auf-mehrere-lokale-dateien-modul-glob" id="toc-zugriff-auf-mehrere-lokale-dateien-modul-glob" class="nav-link" data-scroll-target="#zugriff-auf-mehrere-lokale-dateien-modul-glob"><span class="header-section-number">7</span> Zugriff auf mehrere lokale Dateien: Modul glob</a></li>
  <li><a href="#datensätze-organisieren" id="toc-datensätze-organisieren" class="nav-link" data-scroll-target="#datensätze-organisieren"><span class="header-section-number">8</span> Datensätze organisieren</a>
  <ul class="collapse">
  <li><a href="#sec-tidydata" id="toc-sec-tidydata" class="nav-link" data-scroll-target="#sec-tidydata"><span class="header-section-number">8.1</span> Tidy data</a></li>
  </ul></li>
  <li><a href="#räumliche-daten" id="toc-räumliche-daten" class="nav-link" data-scroll-target="#räumliche-daten"><span class="header-section-number">9</span> Räumliche Daten</a></li>
  <li><a href="#strategien-der-fehlersuche-und-bereinigung" id="toc-strategien-der-fehlersuche-und-bereinigung" class="nav-link" data-scroll-target="#strategien-der-fehlersuche-und-bereinigung"><span class="header-section-number">10</span> Strategien der Fehlersuche und Bereinigung</a>
  <ul class="collapse">
  <li><a href="#werte-plausibilisieren" id="toc-werte-plausibilisieren" class="nav-link" data-scroll-target="#werte-plausibilisieren"><span class="header-section-number">10.1</span> Werte plausibilisieren</a></li>
  </ul></li>
  <li><a href="#sec-spezialformate" id="toc-sec-spezialformate" class="nav-link" data-scroll-target="#sec-spezialformate"><span class="header-section-number">11</span> Spezialformate</a>
  <ul class="collapse">
  <li><a href="#hdf-netcdf" id="toc-hdf-netcdf" class="nav-link" data-scroll-target="#hdf-netcdf"><span class="header-section-number">11.1</span> HDF, netCDF</a></li>
  <li><a href="#maskierte-arrays" id="toc-maskierte-arrays" class="nav-link" data-scroll-target="#maskierte-arrays"><span class="header-section-number">11.2</span> Maskierte Arrays</a>
  <ul class="collapse">
  <li><a href="#operationen-mit-maskierten-arrays" id="toc-operationen-mit-maskierten-arrays" class="nav-link" data-scroll-target="#operationen-mit-maskierten-arrays">Operationen mit maskierten Arrays</a></li>
  <li><a href="#unmasking-and-hard-masks" id="toc-unmasking-and-hard-masks" class="nav-link" data-scroll-target="#unmasking-and-hard-masks">Unmasking and hard masks</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#das-wichtigste-vielleicht-als-video" id="toc-das-wichtigste-vielleicht-als-video" class="nav-link" data-scroll-target="#das-wichtigste-vielleicht-als-video"><span class="header-section-number">12</span> Das Wichtigste (vielleicht als Video)</a></li>
  <li><a href="#lernzielkontrolle" id="toc-lernzielkontrolle" class="nav-link" data-scroll-target="#lernzielkontrolle"><span class="header-section-number">13</span> Lernzielkontrolle</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Methodenbaustein Einlesen strukturierter Datensätze</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor:innen</div>
    <div class="quarto-title-meta-contents">
             <p>Lukas Arnold </p>
             <p>Simone Arnold </p>
             <p>Florian Bagemihl </p>
             <p>Matthias Baitsch </p>
             <p>Marc Fehr </p>
             <p>Maik Poetzsch </p>
             <p>Sebastian Seipel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Veröffentlichungsdatum</div>
    <div class="quarto-title-meta-contents">
      <p class="date">13. November 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="Lizenz" class="border">
<div>

</div>
<div class="quarto-layout-panel" data-layout="[20, 80]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 20.0%;justify-content: center;">
<p><img src="skript/00-bilder/CC-BY.svg" class="img-fluid" alt="Symbol des Lizenzhinweises Creative Commons BY"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: flex-start;">
<p>Bausteine Computergestützter Datenanalyse von Lukas Arnold, Simone Arnold, Florian Bagemihl, Matthias Baitsch, Marc Fehr, Maik Poetzsch und Sebastian Seipel. Methodenbaustein Einlesen strukturierter Datensätze von Maik Poetzsch ist lizensiert unter <a href="https://creativecommons.org/licenses/by/4.0/deed.de">CC BY 4.0</a>. Das Werk ist abrufbar auf <a href="https://github.com/bausteine-der-datenanalyse/m-Einlesen-strukturierter-Datens-tze">GitHub</a>. Ausgenommen von der Lizenz sind alle Logos und anders gekennzeichneten Inhalte. 2024</p>
</div>
</div>
</div>
<p>Zitiervorschlag</p>
<p>Arnold, Lukas, Simone Arnold, Matthias Baitsch, Marc Fehr, Maik Poetzsch, und Sebastian Seipel. 2024. „Bausteine Computergestützter Datenanalyse. Methodenbaustein Einlesen strukturierter Datensätze“. <a href="https://github.com/bausteine-der-datenanalyse/m-Einlesen-strukturierter-Datens-tze" class="uri">https://github.com/bausteine-der-datenanalyse/m-Einlesen-strukturierter-Datens-tze</a>.</p>
<p>BibTeX-Vorlage</p>
<pre><code>@misc{BCD-m-einlesen-strukturierter-datensätze-2024,
 title={Bausteine Computergestützter Datenanalyse. Methodenbaustein Einlesen strukturierter Datensätze},
 author={Arnold, Lukas and Arnold, Simone and Baitsch, Matthias and Fehr, Marc and Poetzsch, Maik and Seipel, Sebastian},
 year={2024},
 url={https://github.com/bausteine-der-datenanalyse/m-Einlesen-strukturierter-Datens-tze}} </code></pre>
</div>
<div style="page-break-after: always;"></div>
<section id="voraussetzungen" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Voraussetzungen</h1>
<p>Die Bearbeitungszeit dieses Bausteins beträgt circa <strong>Platzhalter</strong>. Für die Bearbeitung dieses Bausteins werden folgende Bausteine vorausgesetzt und die genannten Bibliotheken verwendet:</p>
<ul>
<li><p>Werkzeugbaustein Python</p>
<ul>
<li><p>Modul os</p></li>
<li><p>Modul Pandas</p>
<ul>
<li><p>openpyxl <code>pip install openpyxl</code></p></li>
<li><p>xlrd <code>pip install xlrd</code></p></li>
</ul></li>
<li><p>Modul Matplotlib</p></li>
<li><p><strong>ggf. xarray</strong></p></li>
</ul></li>
</ul>
<p>Im Baustein werden folgende Daten verwendet:</p>
<ul>
<li><p>Zahnwachstum bei Meerschweinchen <a href="https://github.com/vincentarelbundock/Rdatasets/blob/master/csv/datasets/ToothGrowth.csv">SCV-Datei</a></p></li>
<li><p>Strommarktdaten der Bundesnetzagentur <a href="%5Bhttps://www.smard.de/%5D(https://www.smard.de/home/downloadcenter/download-marktdaten/)">hier verfügbar</a></p></li>
<li><p>Industriestrompreise in den Mitgliedsändern der Internationalen Energieagentur <a href="https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/670121/table_531.xls">XLS-Datei</a></p></li>
<li><p>Kursdaten des amerikanischen Aktienindexes S&amp;P500 (<a href="https://img1.wsimg.com/blobby/go/e5e77e0b-59d1-44d9-ab25-4763ac982e53/downloads/ie_data.xls?ver=1712069253887">XLS-Datei</a>).</p></li>
</ul>
<p>Querverweis auf:</p>
<ul>
<li><p>w-NumPy</p></li>
<li><p>w-Pandas</p></li>
<li><p>w-rechtliche Grundlagen Datenmanagement</p></li>
</ul>
</section>
<section id="lernziele" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Lernziele</h1>
<p>In diesem Baustein lernen Sie …</p>
<ul>
<li><p>Datensätze unterschiedlicher Struktur und Formate einzulesen, zu bearbeiten und zu speichern.</p></li>
<li><p>den Unterschied zwischen identifizierenden und gemessenen Variablen kennen sowie Datensätze ins long- und wide-Format zu konvertieren.</p></li>
<li><p>das System tidy data kennen.</p></li>
<li><p>typische Probleme beim Einlesen von Datensätzen und Strategien zu deren Lösung kennen.</p></li>
</ul>
</section>
<section id="einleitung" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Einleitung</h1>
<p>2016 stellte eine Studie fest, dass ein Fünftel aller wissenschaftlichen Artikel im Bereich der Genetik auf der Grundlage von durch die Tabellenkalkulation Excel verfälschten Daten durchgeführt wurde <span class="citation" data-cites="Ziemann-2016">(<a href="#ref-Ziemann-2016" role="doc-biblioref">Ziemann, Eren, und El-Osta 2016</a>)</span>. Genbezeichnungen wie “MARCH1” wurden fälschlicherweise in ein Datumsformat umgewandelt. 2021 wurde diese Schätzung des Anteils betroffener Arbeiten sogar auf 30 Prozent angehoben. (<a href="https://www.heise.de/news/Excel-wandelt-Genbezeichnungen-in-Datumsangaben-um-Problem-groesser-als-gedacht-6165902.html">heise online</a>)</p>
<p>Am Beginn der computergestützten Datenanalyse steht das Einlesen von Daten aus Dateien. In der Praxis ist das Einlesen von Daten alles andere als trivial. Daten werden in einer Vielzahl von Dateiformaten gespeichert. Deshalb ist es in der Datenanalyse erforderlich, mit verschiedenen Dateiformaten umgehen zu können: mit wenigen Kilobyte großen Textdateien, offenen und proprietären Formaten gängiger Büroanwendungen und mehreren hundert Megabyte großen Dateien in speziell für den Austausch wissenschaftlicher Daten entwickelten Formaten. Programmiersprachen wie Python und R bringen verschiedene Werkzeuge zum Lesen, Bearbeiten und Speichern von verschiedenen Dateiformaten mit. Spezialisierte Pakete ergänzen den Werkzeugkasten.</p>
<p>Die praktischen Herausforderungen der Datenanalyse beschränken sich jedoch nicht nur auf technische Aspekte. Oftmals bereitet der innere Aufbau von Datensätzen die größten Schwierigkeiten. Ein wichtiger Bestandteil des Einlesens strukturierter Datensätze besteht darin, Fehler im Datensatz zu suchen und ggf. zu bereinigen. Dasu und Johnson schreiben:</p>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Unfortunately, the data set is usually dirty, composed of many tables, and has unknown properties. Before any results can be produced, the data must be cleaned and explored—often a long and difficult task. […] In our experience, the tasks of exploratory data mining and data cleaning constitute 80% of the effort that determines 80% of the value of the ultimate data mining results.” (<span class="citation" data-cites="Dasu-Johnson-2003">Dasu und Johnson (<a href="#ref-Dasu-Johnson-2003" role="doc-biblioref">2003</a>)</span>, S. ix)</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Das Einlesen strukturierter Datensätze umfasst somit den gesamten Prozess des technischen Zugriffs auf Dateien, der Organisation, Fehlersuche und -korrektur sowie des Abspeicherns der Daten in einer für die weitere Bearbeitung geeigneten Form.</p>
<p>In der praktischen Datenanalyse helfen zwei einfache Tipps beim Einlesen strukturierter Datensätze:</p>
<div id="tip-editor" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><strong>Schauen Sie sich Ihre Daten an, bevor Sie diese mit Python einlesen!</strong> Dafür reicht ein Texteditor oder ein Tabellenkalkulationsprogramm. Ein kurzer Blick genügt, um die verwendeten Zeichentrenner, Tausendertrennzeichen, Datumsformate, die Kodierung fehlender Werte und die Unicode-Kodierung (wie UTF-8) zu identifizieren.</p>
</div>
</div>
</div>
<p>Dies ist aber nicht immer möglich, beispielsweise wenn Ihr Datensatz aus hunderten Spalten und zehntausenden Zeilen besteht. Dieser Baustein vermittelt deshalb die Handwerkszeuge, um Datensätze ausschließlich mit den in Python verfügbaren Mitteln einzulesen.</p>
<p>Es ist nicht erforderlich, die Besonderheiten aller hier vorgestellten Pakete und Funktionen auswendig zu beherrschen. Dafür ist das Themenfeld zu komplex und nicht selten ändert sich das Verhalten von Funktionen mit der Weiterentwicklung der Programmiersprache. Die hier vorgestellten Besonderheiten von Funktionen dienen jedoch als mentale Ankerpunkte, die als Anknüpfungspunkt dienen sollen, wenn Sie in der Praxis auf Probleme stoßen.</p>
<div id="tip-dokumentation" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><strong>Benutzen Sie die Dokumentation!</strong> Auf diese Weise erhalten Sie einen vollständigen Überblick über standardmäßig gesetzte und optional verfügbare Parameter. Außerdem erkennen Sie Änderungen in der Programmausführung und vermeiden so unerwartete Fehler.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/added-in-pyhton.png" class="img-fluid figure-img"></p>
<figcaption>Neuerung in Python</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/deprecated-in-python.png" class="img-fluid figure-img"></p>
<figcaption>Abkündigung in Python</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="grundlagen-merkmale-von-datensätzen" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Grundlagen: Merkmale von Datensätzen</h1>
<p>Bevor wir uns mit den praktischen Herausforderungen des Einlesens strukturierter Datensätze beschäftigten, werden zunächst einige Merkmale von Datensätzen behandelt, um ein grundlegendes Verständnis der Begrifflichkeiten zu schaffen und den Umgang der in der Basis von Python enthaltenen Werkzeuge zu vermitteln.</p>
<div id="imp-Datensatz" class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition&nbsp;1: Datensatz
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ein Datensatz ist eine Sammlung zusammengehöriger Daten. Datensätze enthalten einer oder mehreren Variablen zugeordnete Werte. Jeder Datensatz besitzt ein technisches Format, eine Struktur, mindestens eine Variable und mindestens einen Wert.</p>
</div>
</div>
<section id="technisches-format" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="technisches-format"><span class="header-section-number">4.1</span> Technisches Format</h2>
<p>Das technische Format eines Datensatzes gibt vor, mit welchen Mitteln Daten eingelesen, bearbeitet und gespeichert werden können. Einige Beispiele sind:</p>
<ul>
<li><p>Druckerzeugnis, z. B. Telefonbuch: manuelles Ablesen von Name und Telefonnummer, irreversible Bearbeitung per Stift</p></li>
<li><p>Lochkarte, z. B. Parkschein: Lesegerät erkennt Lochung und gewährt eine Freistunde, irreversible Bearbeitung mit Stanzgerät</p></li>
<li><p>Textdatei, z. B. Einwohnerzahl nach Bundesländern: Kann mit einer Vielzahl von Computerprogrammen wie Texteditor, Tabellenkalkulationsprogramm oder Programmierumgebung eingelesen, bearbeitet und gespeichert werden.</p></li>
<li><p>Hierarchical Data Format HDF5, z. B. räumliche Daten zur Blitzdichte: benötigt spezialisierte Programme oder Pakete</p></li>
</ul>
</section>
<section id="struktur" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="struktur"><span class="header-section-number">4.2</span> Struktur</h2>
<p>Datensätze speichern Daten in einer definierten n-dimensionalen Struktur.</p>
<div class="border">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/slicing_mf_mp.png" class="img-fluid figure-img"></p>
<figcaption>n-dimensionale Datensätze</figcaption>
</figure>
</div>
<p>slicing von Marc Fehr ist lizensiert unter <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen#CC-BY-4.0-1-ov-file">CC-BY-4.0</a> und abrufbar auf <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen">GitHub</a>. 2024</p>
</div>
<section id="eindimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="eindimensionale-datensätze">Eindimensionale Datensätze</h3>
<p>Die einfachste Form sind eindimensionale Datensätze, die Werte einer einzigen Variablen zuordnen. Eindimensionale Datensätze mit Werten des gleichen Typs (bspw. Zahlen) werden <strong>Vektor</strong> genannt. Eindimensionale Datensätze, die unterschiedliche Datentypen enthalten können, heißen <strong>Liste</strong>. Eindimensionale Datensätze verfügen lediglich über eine Achse: den Index, über den Elemente angesprochen werden können.</p>
<div class="border">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/eindimensionaler-datensatz-slicing-mf-mp.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>eindimensionale Datensätze</figcaption>
</figure>
</div>
<p>slicing von Marc Fehr ist lizensiert unter <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen#CC-BY-4.0-1-ov-file">CC-BY-4.0</a> und abrufbar auf <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen">GitHub</a>. Die Grafik wurde auf den gezeigten Teil beschnitten und die obenstehende Beschriftung entfernt. 2024</p>
</div>
<p>&nbsp;</p>
<p>Beispiele eindimensionaler Datensätze sind ein Einkaufszettel oder die Urliste eines Würfelexperiments. Über den Index kann beispielsweise das Würfelergebnis an der Indexposition 2 ausgegeben werden.</p>
<div id="090f2950" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="op">*</span>( Augen <span class="op">:=</span> [<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>] ) )</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Das Würfelergebnis an Indexposition 2 lautet: </span><span class="sc">{</span>Augen[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6 2 1 2
Das Würfelergebnis an Indexposition 2 lautet: 1</code></pre>
</div>
</div>
</section>
<section id="eindimensionale-daten-einlesen-mit-python" class="level3">
<h3 class="anchored" data-anchor-id="eindimensionale-daten-einlesen-mit-python">Eindimensionale Daten einlesen mit Python</h3>
<p>Maya und Hans haben je sechs Mal einen Würfel geworfen und ihre Wurfergebnisse in einer .txt-Datei protokolliert. Wir wollen mit die Dateien mit Python auswerten, um zu bestimmen, wer von beiden in Summe die höchste Augenzahl erreicht hat.</p>
<table class="table">
<thead>
<tr class="header">
<th>Daten</th>
<th>Dateiname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Würfelergebnisse Maya</td>
<td>dice-maya.txt</td>
</tr>
<tr class="even">
<td>Würfelergebnisse Hans</td>
<td>dice-hans.txt</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<div class="border">
<p>Um mit Python auf eine Datei zuzugreifen, muss diese fürs Lesen oder Schreiben geöffnet werden. Dazu wird in Python die Funktion <a href="https://docs.python.org/3/library/functions.html#open">open</a> verwendet. Diese nimmt zwei Argumente, den Pfad der Datei und den Zugriffsmodus, an und liefert ein <a href="https://docs.python.org/3/glossary.html#term-file-object">Dateiobjekt</a> zurück. Aus dem Dateiobjekt werden dann die Inhalte der Datei ausgelesen.</p>
<section id="dateipfad" class="level4">
<h4 class="anchored" data-anchor-id="dateipfad">Dateipfad</h4>
<p>Der lokale Dateipfad wird ausgehend vom aktuellen Arbeitsverzeichnis angegeben.</p>
<div id="80735f71" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pfad_maya <span class="op">=</span> <span class="st">"skript/01-daten/dice-maya.txt"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pfad_hans <span class="op">=</span> <span class="st">"skript/01-daten/dice-hans.txt"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tip-wd-Python" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;3: Arbeitsverzeichnis in Python ermitteln und wechseln
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Der Pfad des aktuellen Arbeitsverzeichnisses kann mit dem Modul os mittels <code>os.getcwd()</code> ermittelt werden (hier ohne Ausgabe). Mit <code>os.chdir('neuer_pfad')</code> kann das Arbeitsverzeichnis ggf. gewechselt werden. Die korrekte Formatierung des Pfads erkennen Sie an der Ausgabe von <code>os.getcwd()</code>.</p>
<div id="76ddfc69" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(os.getcwd())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="zugriffsmodus" class="level4">
<h4 class="anchored" data-anchor-id="zugriffsmodus">Zugriffsmodus</h4>
<p>Als Zugriffsmodus stehen unter anderem folgende Optionen zur Verfügung:</p>
<table class="table">
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="header">
<th>Modus</th>
<th>Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>r</code></td>
<td>lesender Zugriff</td>
</tr>
<tr class="even">
<td><code>w</code></td>
<td>Schreibzugriff, Datei wird überschrieben</td>
</tr>
<tr class="odd">
<td><code>x</code></td>
<td>Erzeugt die Datei, Fehlermeldung, wenn die Datei bereits existiert</td>
</tr>
<tr class="even">
<td><code>a</code></td>
<td>Schreibzugriff, Inhalte werden angehängt</td>
</tr>
<tr class="odd">
<td><code>b</code></td>
<td>Binärmodus (z. B. für Grafiken)</td>
</tr>
<tr class="even">
<td><code>t</code></td>
<td>Textmodus, default</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>Die Zugriffsmodi können auch kombiniert werden. Weitere Informationen dazu finden Sie in der <a href="https://docs.python.org/3/library/functions.html#open">Dokumentation</a>. Sofern nicht im Binärmodus auf Dateien zugegriffen wird, liefert die Funktion <code>open()</code> den Dateiinhalt als string zurück.</p>
<p>Im Lesemodus wird ein Datenobjekt erzeugt.</p>
<div id="19a52ee7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>daten_maya <span class="op">=</span> <span class="bu">open</span>(pfad_maya, mode <span class="op">=</span> <span class="st">'r'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_maya)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;_io.TextIOWrapper name='skript/01-daten/dice-maya.txt' mode='r' encoding='cp1252'&gt;</code></pre>
</div>
</div>
<p>Wenn das Datenobjekt <code>daten_maya</code> der Funktion <code>print()</code> übergeben wird, gibt Python die Klasse des Objekts zurück, in diesem Fall also _io.TextIOWrapper. Diese Klasse stammt aus dem Modul io und ist für das Lesen und Schreiben von Textdateien zuständig. Ebenfalls werden der Dateipfad, der Zugriffsmodus und die Enkodierung der Datei ausgegeben. Sollte die Enkodierung nicht automatisch als UTF-8 erkannt werden, kann diese mit dem Argument <code>encoding = 'UTF-8'</code> übergeben werden.</p>
<div id="74654c30" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>daten_maya <span class="op">=</span> <span class="bu">open</span>(pfad_maya, mode <span class="op">=</span> <span class="st">'r'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_maya)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;_io.TextIOWrapper name='skript/01-daten/dice-maya.txt' mode='r' encoding='UTF-8'&gt;</code></pre>
</div>
</div>
<p>Die Attribute der Datei können mit entsprechenden Befehlen abgerufen werden.</p>
<div id="821d298a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dateipfad: </span><span class="sc">{</span>daten_maya<span class="sc">.</span>name<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Dateiname: </span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>basename(daten_maya.name)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Datei ist geschlossen: </span><span class="sc">{</span>daten_maya<span class="sc">.</span>closed<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Zugriffsmodus: </span><span class="sc">{</span>daten_maya<span class="sc">.</span>mode<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dateipfad: skript/01-daten/dice-maya.txt
Dateiname: dice-maya.txt
Datei ist geschlossen: False
Zugriffsmodus: r</code></pre>
</div>
</div>
</section>
<section id="daten-ausgeben" class="level4">
<h4 class="anchored" data-anchor-id="daten-ausgeben">Daten ausgeben</h4>
<p>Um den Dateiinhalt auszugeben, kann das Datenobjekt mit einer Schleife zeilenweise durchlaufen und ausgegeben werden. (Die Datei dice-maya hat nur eine Zeile.)</p>
<div id="63a5089b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> zeile <span class="kw">in</span> daten_maya:</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Inhalt Zeile </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, mit </span><span class="sc">{</span><span class="bu">len</span>(zeile)<span class="sc">}</span><span class="ss"> Zeichen:"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(zeile)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inhalt Zeile 0, mit 28 Zeichen:
"5", "6", "2", "1", "4", "5"</code></pre>
</div>
</div>
<p>Dies ist jedoch für größere Dateien nicht sonderlich praktikabel. Die Ausgabe einzelner Zeilen mit der Funktion <code>print()</code> kann aber nützlich sein, um die genaue Formatierung der Zeichenkette zu prüfen. In diesem Fall hat Maya ihre Daten in Anführungszeichen gesetzt und mit einem Komma voneinander getrennt.</p>
<div id="tip-zeilenweise" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;4: Daten kontrollieren
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Beim Einlesen goßer Datensätze sollten nicht nur die erste(n) Zeile(n) des Datensatzes, sondern auch Ausschnitte aus der Mitte und dem Ende kontrolliert werden. Dies hilft, Fehler etwa bei der Umwandlung von Dezimal- und Tausendertrennzeichen, des Datumsformats oder eine unerwartete Anzahl fehlender Werte und sonstige Auffälligkeiten zu identifizieren.</p>
</div>
</div>
</div>
</section>
<section id="daten-einlesen" class="level4">
<h4 class="anchored" data-anchor-id="daten-einlesen">Daten einlesen</h4>
<p>Um den gesamten Inhalt einer Datei einzulesen, kann die Methode <a href="https://docs.python.org/3/tutorial/inputoutput.html">datenobjekt.read()</a> verwendet werden. Die Methode hat als optionales Argument <code>.read(size)</code>. size wird als Ganzzahl übergeben und entsprechend viele Zeichen (im Binärmodus entsprechend viele Bytes) werden ggf. bis zum Dateiende ausgelesen.</p>
<div id="e72c0068" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>augen_maya <span class="op">=</span> daten_maya.read()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"len(augen_maya): </span><span class="sc">{</span><span class="bu">len</span>(augen_maya)<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Inhalt der Datei augen_maya:</span><span class="ch">\n</span><span class="sc">{</span>augen_maya<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>len(augen_maya): 0

Inhalt der Datei augen_maya:
</code></pre>
</div>
</div>
<p>Das hat offensichtlich nicht geklappt, der ausgelesene Dateiinhalt ist leer! Der Grund dafür ist, dass beim Lesen (und beim Schreiben) einer Datei der Dateizeiger die Datei durchläuft. Nachdem die Datei daten_maya im Abschnitt “Daten ausgeben” zeilenweise ausgegeben wurde, steht der Dateizeiger am Ende der Datei.</p>
<div id="wrn-Dateizeiger" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;1: Dateizeiger in Python
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wird eine Datei zeilenweise oder mit der Methode <code>.read()</code> ausgelesen, wird der Dateizeiger um die angegebene Zeichenzahl bzw. bis ans Ende der Datei bewegt. Wird beispielsweise ein Datensatz ‘daten’ geöffnet und mit der Methode <code>daten.read(3)</code> die ersten drei Zeichen ausgelesen, bewegt sich der Dateizeiger von der Indexposition 0 zur Indexposition 3 (bzw. steht jeweils davor).</p>
<div id="fig-Dateizeiger" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Dateizeiger-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="skript/00-bilder/indexposition-0.png" class="img-fluid figure-img" alt="Dargestellt ist ein in fünf Blöcke unterteilter Streifen, der einen eindimensionalen Datensatz repräsentiert. Die Blöcke sind entlang der 0. Achse von links nach rechts mit 0 bis 4 beschriftet. Oberhalb steht links vom Block Null ein Pfeil mit der Beschriftung Indexposition Null"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="skript/00-bilder/indexposition-3.png" class="img-fluid figure-img" alt="Dargestellt ist der gleiche Streifen. Oberhalb steht links vom Block drei ein Pfeil mit der Beschriftung Indexposition drei"></p>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Dateizeiger-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;1: Bewegung des Dateizeigers beim Auslesen von drei Zeichen
</figcaption>
</figure>
</div>
<p>Die Methode <code>daten.tell()</code> gibt zurück, an welcher Position sich der Dateizeiger befindet.</p>
<p>Mit der Methode <code>daten.seek(offset, whence = 0)</code> wird der Zeiger an eine bestimmte Position gesetzt. Die Methode akzeptiert das Argument offset (Versatz) und das optionale Argument whence (woher), dessen Standardwert 0 (Dateianfang) ist. Für Zugriffe <strong>im Binärmodus</strong> (<code>open(pfad, mode = 'rb')</code>) kann das Argument whence außerdem die Werte 1 (aktuelle Position) oder 2 (Dateiende) annehmen.</p>
<ul>
<li><p><code>daten.seek(0, 0)</code> bezeichnet den Dateianfang</p></li>
<li><p><code>daten.seek(0, 1)</code> bezeichnet die aktuelle Position in der Datei</p></li>
<li><p><code>daten.seek(0, 2)</code> bezeichnet das Dateiende</p></li>
<li><p><code>daten.seek(-3, 2)</code> bezeichnet das dritte Zeichen vor dem Dateiende</p></li>
</ul>
</div>
</div>
<p>Wird der Dateizeiger mit der Methode <code>datenobjekt.seek(0)</code> an den Dateianfang gestellt, gelingt das Auslesen der Datei.</p>
<div id="610be870" class="cell" data-results="hold" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Position des Dateizeigers vor dem Zurücksetzen auf 0: </span><span class="sc">{</span>daten_maya<span class="sc">.</span>tell()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>daten_maya.seek(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Position des Dateizeigers nach dem Zurücksetzen auf 0: </span><span class="sc">{</span>daten_maya<span class="sc">.</span>tell()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>augen_maya <span class="op">=</span> daten_maya.read()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Inhalt des Objekts augen_maya:</span><span class="ch">\n</span><span class="sc">{</span>augen_maya<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Position des Dateizeigers vor dem Zurücksetzen auf 0: 28
Position des Dateizeigers nach dem Zurücksetzen auf 0: 0
Inhalt des Objekts augen_maya:
"5", "6", "2", "1", "4", "5"</code></pre>
</div>
</div>
<p><strong>Geben Sie aus dem Datenobjekt daten_maya mit den Methoden .seek() und .read() die Zahlen and zweiter und dritter Stelle, also 6 und 2, aus.</strong></p>
<div id="tip-Musterlösung-Zeigerposition" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;5: Musterlösung Dateizeiger bewegen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="afd979b3" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>daten_maya.seek(<span class="dv">6</span>, <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_maya.read(<span class="dv">1</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>daten_maya.seek(daten_maya.tell() <span class="op">+</span> <span class="dv">4</span>, <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_maya.read(<span class="dv">1</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6
2</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Um Mayas Würfelergebnisse zu addieren, müssen die Zahlen extrahiert und in Ganzzahlen umgewandelt werden, da im Textmodus stets strings zurückgegeben werden.</p>
<div id="12e0732b" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(augen_maya))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'str'&gt;</code></pre>
</div>
</div>
<p>Dazu werden mit der Methode <code>str.strip(")</code> das führende und abschließende Anführungszeichen entfernt sowie anschließend mit der Methode <code>str.split('", "')</code> der String in eine Liste aufgeteilt. Anschließend werden die Listenelemente in Ganzzahlen umgewandelt und summiert.</p>
<div id="70e39081" class="cell" data-results="hold" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"augen_maya:</span><span class="ch">\n</span><span class="sc">{</span>augen_maya<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>augen_maya <span class="op">=</span> augen_maya.strip(<span class="st">'"'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">augen_maya.strip('</span><span class="ch">\"</span><span class="ss">'):</span><span class="ch">\n</span><span class="sc">{</span>augen_maya<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>augen_maya <span class="op">=</span> augen_maya.split(<span class="st">'", "'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">augen_maya.split('</span><span class="ch">\"</span><span class="ss">, </span><span class="ch">\"</span><span class="ss">'):</span><span class="ch">\n</span><span class="sc">{</span>augen_maya<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>augen_maya_int <span class="op">=</span> []</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> augen_maya:</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  augen_maya_int.append(<span class="bu">int</span>(i))</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">augen_maya_int:</span><span class="ch">\n</span><span class="sc">{</span>augen_maya_int<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">Summe Augen: </span><span class="sc">{</span><span class="bu">sum</span>(augen_maya_int)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>augen_maya:
"5", "6", "2", "1", "4", "5"

augen_maya.strip('"'):
5", "6", "2", "1", "4", "5

augen_maya.split('", "'):
['5', '6', '2', '1', '4', '5']

augen_maya_int:
[5, 6, 2, 1, 4, 5]

Summe Augen: 23</code></pre>
</div>
</div>
</section>
<section id="datei-schließen" class="level4">
<h4 class="anchored" data-anchor-id="datei-schließen">Datei schließen</h4>
<p>Nach dem Zugriff auf die Datei, muss diese wieder geschlossen werden, um diese für andere Programme freizugeben.</p>
<div id="a8029916" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>daten_maya.close()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="wrn-Schreiboperationen" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;2: Schreiboperationen mit Python
</div>
</div>
<div class="callout-body-container callout-body">
<p>Das Schließen einer Datei ist besonders für Schreiboperationen auf Datenobjekten wichtig. Andernfalls kann es passieren, dass Inhalte mit <code>datenobjekt.write()</code> nicht vollständig auf den Datenträger geschrieben werden. Siehe dazu die <a href="https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files">Dokumentation</a>.</p>
</div>
</div>
</section>
<section id="übung-eindimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="übung-eindimensionale-datensätze">Übung eindimensionale Datensätze</h3>
<p><strong>Welche Augenzahl hat Hans erreicht?</strong></p>
<div id="tip-Musterlösung-Augenzahlvergleich" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;6: Musterlösung Augenzahlvergleich
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="border">
<div id="fc2c2f75" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Erst Einlesen der Datei:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>daten_hans <span class="op">=</span> <span class="bu">open</span>(pfad_hans, mode <span class="op">=</span> <span class="st">'r'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>augen_hans <span class="op">=</span> daten_hans.read()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(augen_hans)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Hier muss man erkennen, dass Hans seinen Namen an den Anfang seiner Liste gesetzt hat. Dieser String muss also entfernt werden, bevor die Summe gebildet werden kann!</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>augen_hans <span class="op">=</span> augen_hans.strip(<span class="st">'"Hans", '</span>) <span class="co"># das hier in einer Zeile besser lösbar? zusammen mit nächster Zeile</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>augen_hans <span class="op">=</span> augen_hans.strip(<span class="st">'"'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>augen_hans <span class="op">=</span> augen_hans.split(<span class="st">'", "'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(augen_hans)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print-Ausgabe zeigt, dass die Liste nun korrekt bereinigt wurde. Sie besteht nur noch aus Integerwerten und diese können summiert werden</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Neue (leere) Liste für die Würfe von Hans anlegen:</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>augen_hans_int <span class="op">=</span> []</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> augen_hans:</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>   augen_hans_int.append(<span class="bu">int</span>(i))</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summe Augenzahl von Hans: </span><span class="sc">{</span><span class="bu">sum</span>(augen_hans_int)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"Hans", "3", "5", "1", "3", "2", "5"
['3', '5', '1', '3', '2', '5']
Summe Augenzahl von Hans: 19</code></pre>
</div>
</div>
<p>Musterlösung von Marc Sönnecken.</p>
</div>
</div>
</div>
</div>
<p><span class="citation" data-cites="Arnold-2023-funktionen-module-dateien">(<a href="#ref-Arnold-2023-funktionen-module-dateien" role="doc-biblioref">Arnold 2023a</a>)</span></p>
</section>
</div>
</section>
<section id="zweidimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="zweidimensionale-datensätze">Zweidimensionale Datensätze</h3>
<p>Zweidimensionale Datensätze organisieren Werte in einer aus Zeilen und Spalten bestehenden <strong>Matrix</strong> oder einem <strong>Dataframe</strong>. Eine Matrix enthält nur einen Datentyp (bspw. Zahlen), ein Dataframe kann unterschiedliche Datentypen enthalten (bspw. Zahlen und Wahrheitswerte). In Python stellt das Modul Pandas die DataFrame-Struktur bereit. <strong>[hier Querverweis auf w-Pandas]</strong></p>
<div class="border">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/zweidimensionaler-datensatz-slicing-mf-mp.png" class="img-fluid figure-img" style="width:45.0%"></p>
<figcaption>zweidimensionaler Datensatz</figcaption>
</figure>
</div>
<p>slicing von Marc Fehr ist lizensiert unter <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen#CC-BY-4.0-1-ov-file">CC-BY-4.0</a> und abrufbar auf <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen">GitHub</a>. Die Grafik wurde auf den gezeigten Teil beschnitten und die obenstehende Beschriftung entfernt. 2024</p>
</div>
<p>&nbsp;</p>
<p>Typischerweise entspricht in zweidimensionalen Datensätzen jede Spalte einer <strong>Variablen</strong> und jede Zeile einer <strong>Beobachtung</strong>. Variablen speichern alle Werte eines Merkmals, zum Beispiel des Würfelergebnisses. Beobachtungen speichern alle Werte, die für eine Beobachtungseinheit gemessen wurden, z. B. für eine Person. <span class="citation" data-cites="Wickham-2014">(<a href="#ref-Wickham-2014" role="doc-biblioref">Wickham 2014, 3</a>)</span></p>
<div id="9c7def94" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>messung1 <span class="op">=</span> pd.DataFrame({<span class="st">'Name'</span>: [<span class="st">'Hans'</span>, <span class="st">'Elke'</span>, <span class="st">'Jean'</span>, <span class="st">'Maya'</span>], <span class="st">'Geburtstag'</span>: [<span class="st">'26.02.'</span>, <span class="st">'14.03.'</span>, <span class="st">'30.12.'</span>, <span class="st">'07.09.'</span>], <span class="st">'Würfelfarbe'</span>: [<span class="st">'rosa'</span>, <span class="st">'rosa'</span>, <span class="st">'blau'</span>, <span class="st">'gelb'</span>], <span class="st">'Summe Augen'</span>: [<span class="dv">17</span>, <span class="dv">12</span>, <span class="dv">8</span>, <span class="dv">23</span>]})</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>messung1</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">Würfelfarbe</th>
<th data-quarto-table-cell-role="th">Summe Augen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>rosa</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>rosa</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>blau</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>gelb</td>
<td>23</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Über die Angabe der Indizes entlang der 0. (Zeilen) und der 1. Achse (Spalten) kann die Summe der gewürfelten Augen einer Person ausgegeben werden.</p>
<div id="deb4aed9" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Jean würfelte </span><span class="sc">{</span>messung1<span class="sc">.</span>iloc[<span class="dv">2</span>, <span class="dv">3</span>]<span class="sc">}</span><span class="ss"> Augen"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jean würfelte 8 Augen</code></pre>
</div>
</div>
<p>Es ist aber auch möglich, zunächst eine Spalte auszuwählen und dann wie bei einem eindimensionalen Datensatz den Wert an einer Indexposition aufzurufen. Dies wird verkettete Indexierung genannt.</p>
<div id="026d0f1b" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Jean würfelte </span><span class="sc">{</span>messung1[<span class="st">'Summe Augen'</span>][<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> Augen"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jean würfelte 8 Augen</code></pre>
</div>
</div>
<div id="wrn-chainedassignment" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;3: Verkettete Indexierung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die verkettete Indexierung erzeugt in Pandas abhängig vom Kontext eine Kopie des Objekts oder greift auf den Speicherbereich des Objekts zu. Mit Pandas 3.0 wird die verkettete Indexierung nicht mehr unterstützt, das Anlegen einer Kopie wird zum Standard werden. Weitere Informationen erhalten Sie im zitierten Link.</p>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Whether a copy or a reference is returned for a setting operation, may depend on the context. This is sometimes called <code>chained assignment</code> and should be avoided. See <a href="https://pandas.pydata.org/docs/user_guide/indexing.html#indexing-view-versus-copy">Returning a View versus Copy</a>.”</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<p>(<a href="https://pandas.pydata.org/docs/user_guide/indexing.html">Pandas Dokumentation</a>)</p>
</div>
</div>
</section>
<section id="long--und-wide-format" class="level3">
<h3 class="anchored" data-anchor-id="long--und-wide-format">long- und wide-Format</h3>
<p>Zweidimensionale Datensätze werden zumeist in einer aus Zeilen und Spalten bestehenden Matrix dargestellt. Den zeilenweise eingetragenen Beobachtungen werden Werte für die in den Spalten organisierten Variablen zugeordnet. Diese Art Daten darzustellen, wird wide-Format genannt: Mit jeder zusätzlich gemessenen Variablen wird der Datensatz breiter.</p>
<p>Eine andere Art Daten zu organisieren und über Daten nachzudenken, ist die Darstellung im long-Format. Einige Programme und Pakete erfordern Daten im long-Format oder profitieren zumindest davon beispielsweise bei der Erstellung von Grafiken. Schauen wir uns zunächst noch einmal den Datensatz messung1 im wide-Format an. Welche Beobachtungseinheiten gibt es? Welche Variablen wurden erhoben?</p>
<div id="e7a462ee" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">Würfelfarbe</th>
<th data-quarto-table-cell-role="th">Summe Augen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>rosa</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>rosa</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>blau</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>gelb</td>
<td>23</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Vermutlich werden Sie davon ausgehen, dass die Beobachtungseinheiten Hans, Elke, Jean und Maya sind und die Variablen Geburtstag, Würfelfarbe und Summe Augen. Es ist aber auch denkbar, dass die Beobachtungseinheit Person mit 0, 1, 2 und 3 kodiert wurde (dem Zeilenindex des Datensatzes) und die Spalte Name ebenfalls eine der erhobenen Variablen ist. Ebenso könnte es nur zwei Variablen, Würfelfarbe und Summe Augen, geben, während die Spalten Name und Geburtstag die beobachteten Personen kodieren. Stellen Sie sich vor, es gäbe eine zweite Person mit dem Namen Hans. Dann könnten die Würfelergebnisse der Personen mit dem Namen Hans nur über den Geburtstag am 26.02. oder 11.11. korrekt zugeordnet werden.</p>
<div id="7ad47e95" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>messung1 <span class="op">=</span> pd.DataFrame({<span class="st">'Name'</span>: [<span class="st">'Hans'</span>, <span class="st">'Elke'</span>, <span class="st">'Jean'</span>, <span class="st">'Maya'</span>, <span class="st">'Hans'</span>], <span class="st">'Geburtstag'</span>: [<span class="st">'26.02.'</span>, <span class="st">'14.03.'</span>, <span class="st">'30.12.'</span>, <span class="st">'07.09.'</span>, <span class="st">'11.11.'</span>], <span class="st">'Würfelfarbe'</span>: [<span class="st">'rosa'</span>, <span class="st">'rosa'</span>, <span class="st">'blau'</span>, <span class="st">'gelb'</span>, <span class="st">'rosa'</span>], <span class="st">'Summe Augen'</span>: [<span class="dv">12</span>, <span class="dv">17</span>, <span class="dv">8</span>, <span class="dv">23</span>, <span class="dv">7</span>]})</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>messung1</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">Würfelfarbe</th>
<th data-quarto-table-cell-role="th">Summe Augen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>rosa</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>rosa</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>blau</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>gelb</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Hans</td>
<td>11.11.</td>
<td>rosa</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Das long-Format macht diese Überlegungen explizit, indem identifizierende Variablen (identification variables, kurz: id vars) und gemessene Variablen (measure variables oder value vars) unterschieden werden. Die Transformation eines Datensatzes aus dem wide-Format ins long-Format wird melting (schmelzen) genannt. Das Modul Pandas bietet die Funktion <code>pd.melt(frame, id_vars = None)</code>. Diese erwartet einen DataFrame. Im optionalen Argument <code>id_vars</code> wird angegeben, welche Spalten die identifizierenden Variablen sind.</p>
<div id="aa91014d" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>messung1_long <span class="op">=</span> pd.melt(messung1, id_vars <span class="op">=</span> [<span class="st">'Name'</span>, <span class="st">'Geburtstag'</span>])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>messung1_long</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>Würfelfarbe</td>
<td>blau</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>Würfelfarbe</td>
<td>gelb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Hans</td>
<td>11.11.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Hans</td>
<td>26.02.</td>
<td>Summe Augen</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Elke</td>
<td>14.03.</td>
<td>Summe Augen</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Jean</td>
<td>30.12.</td>
<td>Summe Augen</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Maya</td>
<td>07.09.</td>
<td>Summe Augen</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Hans</td>
<td>11.11.</td>
<td>Summe Augen</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Im long-Format werden die gemessenen Variablen in der Spalte variable aufgeführt und deren Wert in der Spalte value eingetragen. Mit jeder zusätzlich erhobenen Variablen wird der Datensatz länger.</p>
<p>Wenn Sie die Unterscheidung von identifizierenden und gemessenen Variablen zu Ende denken, kann der Variablenname selbst als eine identifizierende Variable für den Wert in der Spalte value aufgefasst werden. Ein Datensatz kann als eine Struktur verstanden werden, die genau eine gemessene Variable, nämlich value, und eine Anzahl identifizierender Variablen besitzt. Dies kann im long-Format wie folgt dargestellt werden.</p>
<div id="3b268f5c" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>messung1_all_id <span class="op">=</span> pd.melt(messung1, id_vars <span class="op">=</span> [<span class="st">'Name'</span>, <span class="st">'Geburtstag'</span>, <span class="st">'Würfelfarbe'</span>])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>messung1_all_id</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In dieser Darstellung wird beispielsweise der erste Wert 12 durch Name = Hans, Geburtstag = 26.02., Würfelfarbe = rosa und variable = Summe Augen identifiziert.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[70, 30]">
<div class="quarto-layout-row">
<div id="8a41d1a0" class="cell quarto-layout-cell" data-execution_count="22" style="flex-basis: 70.0%;justify-content: center;">
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Geburtstag</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Würfelfarbe</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">0</td>
<td style="text-align: left;">Hans</td>
<td style="text-align: left;">26.02.</td>
<td style="text-align: left;">rosa</td>
<td style="text-align: left;">Summe Augen</td>
<td style="text-align: left;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">1</td>
<td style="text-align: left;">Elke</td>
<td style="text-align: left;">14.03.</td>
<td style="text-align: left;">rosa</td>
<td style="text-align: left;">Summe Augen</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">2</td>
<td style="text-align: left;">Jean</td>
<td style="text-align: left;">30.12.</td>
<td style="text-align: left;">blau</td>
<td style="text-align: left;">Summe Augen</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">3</td>
<td style="text-align: left;">Maya</td>
<td style="text-align: left;">07.09.</td>
<td style="text-align: left;">gelb</td>
<td style="text-align: left;">Summe Augen</td>
<td style="text-align: left;">23</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">4</td>
<td style="text-align: left;">Hans</td>
<td style="text-align: left;">11.11.</td>
<td style="text-align: left;">rosa</td>
<td style="text-align: left;">Summe Augen</td>
<td style="text-align: left;">7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">
<p><img src="skript/00-bilder/5f489ffabc91dec1ec2192dc4e993e00.jpg" class="img-fluid" style="width:90.0%" alt="dekoratives Bild eines staunenden Hundes"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 70.0%;justify-content: flex-start;">
<!-- wow kommt wieder weg ;-) -->
</div>
</div>
</div>
<div class="border">
<p>Much wow. Such architecture. von Dmitry Kudryavtsev ist verfügbar unter <a href="https://yieldcode.blog/post/bloat-in-software-engineering/" class="uri">https://yieldcode.blog/post/bloat-in-software-engineering/</a>. <strong>Das Bild wird wahrscheinlich wieder entfernt.</strong></p>
</div>
<p><strong>Was passiert, wenn auch die Variable <code>Summe Augen</code> dem Argument <code>id_vars</code> übergeben wird?</strong></p>
<div id="tip-Antwort-all-id" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;7: Antwort
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Der Befehl <code>messung1_all_id = pd.melt(messung1, id_vars = ['Name', 'Geburtstag', 'Würfelfarbe', 'Summe Augen'])</code> produziert einen leeren Dataframe, weil keine gemessenen Werte verbleiben.</p>
</div>
</div>
</div>
<p>Auch der umgekehrte Fall ist möglich: Werden beim melting keine id_vars angegeben, werden alle Spalten als gemessene Variablen behandelt.</p>
<div id="89704aab" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>messung1_no_id <span class="op">=</span> pd.melt(messung1)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>messung1_no_id</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Name</td>
<td>Hans</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Name</td>
<td>Elke</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Name</td>
<td>Jean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Name</td>
<td>Maya</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Name</td>
<td>Hans</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Geburtstag</td>
<td>26.02.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Geburtstag</td>
<td>14.03.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Geburtstag</td>
<td>30.12.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Geburtstag</td>
<td>07.09.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Geburtstag</td>
<td>11.11.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Würfelfarbe</td>
<td>blau</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Würfelfarbe</td>
<td>gelb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>Summe Augen</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>Summe Augen</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>Summe Augen</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Summe Augen</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>Summe Augen</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Die Umkehroperation zum melting wird casting (gießen) oder pivoting (schwenken) genannt. Dabei wird ein im long-Format vorliegender Datensatz in das wide-Format konvertiert. Die Pandas Funktion <code>pd.pivot(data, columns, index)</code> nimmt einen melted DataFrame entgegen und konveriert diesen aus den einzigartigen Werten in columns (= Spaltennamen des DataFrame im wide-Format) und den einzigartigen Werten in index (= Zeilenindex des DataFrame im wide-Format). Wird der Funktion keine Spalte für index übergeben, wird der bestehende Index des melted DataFrame verwendet (der mit 20 Zeilen natürlich viel zu lang ist.) Da das Objekt messung1_no_id keine geeignete Indexspalte besitzt, muss diese vor dem casting erzeugt werden. Dies ist mit der Methode <code>messung1_no_id.groupby('variable').cumcount()</code> möglich, die die Anzahl jeder Ausprägung in der übergebenen Spalte bei 0 beginnend durchzählt. (Ein direktes Ersetzen des Index ist auf diese Weise nicht möglich, da der Index des an <code>pd.pivot(data, columns, index)</code> übergebenen DataFrames keine Doppelungen enthalten darf.)</p>
<div id="77f6e490" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.pivot() benötigt einen Index oder benutzt den bestehenden Index, des melted_df, der zu lang ist</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Deshalb eine zusätzliche Spalte in messung1_no_id einfügen</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">## einfach: messung1_no_id['new_index'] = list(range(0, 5)) * 4 </span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">## allgemein: messung1_no_id['new_index'] = messung1_no_id.groupby('variable').cumcount()</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalte new_index einfügen</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>messung1_no_id[<span class="st">'new_index'</span>] <span class="op">=</span> messung1_no_id.groupby(<span class="st">'variable'</span>).cumcount()</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="ss">f"Der Datensatz im long-Format mit zusätzlicher Spalte new_index:</span><span class="ch">\n</span><span class="sc">{</span>messung1_no_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># casting</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>messung1_cast <span class="op">=</span> pd.pivot(messung1_no_id, index <span class="op">=</span> <span class="st">'new_index'</span>, columns <span class="op">=</span> <span class="st">'variable'</span>, values <span class="op">=</span> <span class="st">'value'</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Der Datensatz im wide-Format:</span><span class="ch">\n</span><span class="sc">{</span>messung1_cast<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Der Datensatz im long-Format mit zusätzlicher Spalte new_index:
       variable   value  new_index
0          Name    Hans          0
1          Name    Elke          1
2          Name    Jean          2
3          Name    Maya          3
4          Name    Hans          4
5    Geburtstag  26.02.          0
6    Geburtstag  14.03.          1
7    Geburtstag  30.12.          2
8    Geburtstag  07.09.          3
9    Geburtstag  11.11.          4
10  Würfelfarbe    rosa          0
11  Würfelfarbe    rosa          1
12  Würfelfarbe    blau          2
13  Würfelfarbe    gelb          3
14  Würfelfarbe    rosa          4
15  Summe Augen      12          0
16  Summe Augen      17          1
17  Summe Augen       8          2
18  Summe Augen      23          3
19  Summe Augen       7          4

Der Datensatz im wide-Format:
variable  Geburtstag  Name Summe Augen Würfelfarbe
new_index                                         
0             26.02.  Hans          12        rosa
1             14.03.  Elke          17        rosa
2             30.12.  Jean           8        blau
3             07.09.  Maya          23        gelb
4             11.11.  Hans           7        rosa</code></pre>
</div>
</div>
<p>Das Ergebnis entspricht noch nicht dem ursprünglichen Datensatz im wide-Format. Um das Ausgangsformat wiederherzustellen, müssen die Spalten in die ursprüngliche Reihenfolge gebracht sowie der Index und dessen Beschriftung zurückgesetzt werden.</p>
<div id="5b803ff1" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalten anordnen, Index zurücksetzen</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>messung1_cast <span class="op">=</span> messung1_cast[[<span class="st">'Name'</span>, <span class="st">'Geburtstag'</span>, <span class="st">'Würfelfarbe'</span>, <span class="st">'Summe Augen'</span>]]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>messung1_cast.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>messung1_cast.rename_axis(<span class="va">None</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Der Datensatz im wide-Format mit zurückgesetztem Index:</span><span class="ch">\n\n</span><span class="sc">{</span>messung1_cast<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Der Datensatz im wide-Format mit zurückgesetztem Index:

   Name Geburtstag Würfelfarbe Summe Augen
0  Hans     26.02.        rosa          12
1  Elke     14.03.        rosa          17
2  Jean     30.12.        blau           8
3  Maya     07.09.        gelb          23
4  Hans     11.11.        rosa           7</code></pre>
</div>
</div>
<div id="tip-idvars" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;8: identifizierende und gemessene Variablen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Auch wenn Sie mit Datensätzen im wide-Format arbeiten, ist die Unterscheidung identifizierender und gemessener Variablen nützlich, um Datensätze zu organisieren. <a href="#sec-tidydata" class="quarto-xref">siehe&nbsp;8.1</a></p>
</div>
</div>
</div>
</section>
<section id="übung-zweidimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="übung-zweidimensionale-datensätze">Übung zweidimensionale Datensätze</h3>
<p>Oben wurde das Objekt messung1_long mit dem Befehl <code>messung1_long = pd.melt(messung1, id_vars = ['Name', 'Geburtstag'])</code> angelegt.<br>
<strong>Benutzen Sie die Funktion</strong> <code>pd.DataFrame.pivot()</code>, <strong>um den Datensatz messung1 wieder ins wide-Format zu transformieren.</strong></p>
<div id="d120a4b2" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>Würfelfarbe</td>
<td>blau</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>Würfelfarbe</td>
<td>gelb</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Hans</td>
<td>11.11.</td>
<td>Würfelfarbe</td>
<td>rosa</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Hans</td>
<td>26.02.</td>
<td>Summe Augen</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Elke</td>
<td>14.03.</td>
<td>Summe Augen</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Jean</td>
<td>30.12.</td>
<td>Summe Augen</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Maya</td>
<td>07.09.</td>
<td>Summe Augen</td>
<td>23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Hans</td>
<td>11.11.</td>
<td>Summe Augen</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="tip-pivoting" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;9: Musterlösung zweidimensionale Datensätze
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="7a1c57d1" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalte new_index einfügen</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>messung1_long[<span class="st">'new_index'</span>] <span class="op">=</span> messung1_long.groupby(<span class="st">'variable'</span>).cumcount()</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># casting</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>messung1_long_cast <span class="op">=</span> pd.pivot(messung1_long, index <span class="op">=</span> <span class="st">'new_index'</span>, columns <span class="op">=</span> <span class="st">'variable'</span>, values <span class="op">=</span> <span class="st">'value'</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalten anordnen, Index zurücksetzen</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>messung1_long_cast <span class="op">=</span> messung1_cast[[<span class="st">'Name'</span>, <span class="st">'Geburtstag'</span>, <span class="st">'Würfelfarbe'</span>, <span class="st">'Summe Augen'</span>]]</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>messung1_long_cast.reset_index(drop <span class="op">=</span> <span class="va">True</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>messung1_long_cast.rename_axis(<span class="va">None</span>, axis <span class="op">=</span> <span class="dv">1</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>messung1_long_cast</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Geburtstag</th>
<th data-quarto-table-cell-role="th">Würfelfarbe</th>
<th data-quarto-table-cell-role="th">Summe Augen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Hans</td>
<td>26.02.</td>
<td>rosa</td>
<td>12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Elke</td>
<td>14.03.</td>
<td>rosa</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jean</td>
<td>30.12.</td>
<td>blau</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Maya</td>
<td>07.09.</td>
<td>gelb</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Hans</td>
<td>11.11.</td>
<td>rosa</td>
<td>7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="drei--und-mehrdimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="drei--und-mehrdimensionale-datensätze">Drei- und mehrdimensionale Datensätze</h3>
<p>Drei- oder mehrdimensionale Datensätze organisieren komplexe Datenstrukturen in sogenannten <strong>Arrays</strong>. Arrays sind n-dimensionale Datenstrukturen und damit zugleich ein Oberbegriff. So ist eine Liste ein eindimensionales Array, eine Matrix ein zweidimensionales Array und eine Excel-Datei mit mehreren Arbeitsblättern für jährlich erhobene Umfragedaten ein 3-dimensionales Array (Arbeitsblätter, Zeilen, Spalten). Abhängig vom verwendeten Modul können Arrays ein oder mehrere Datentypen enthalten. <strong>ggf. ergänzen: Modul xarray <a href="https://docs.xarray.dev/en/stable/user-guide/pandas.html" class="uri">https://docs.xarray.dev/en/stable/user-guide/pandas.html</a></strong></p>
<div class="border">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/dreidimensionaler-datensatz-slicing-mf-mp.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>dreidimensionale Datensätze</figcaption>
</figure>
</div>
<p>slicing von Marc Fehr ist lizensiert unter <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen#CC-BY-4.0-1-ov-file">CC-BY-4.0</a> und abrufbar auf <a href="https://github.com/bausteine-der-datenanalyse/w-python-numpy-grundlagen">GitHub</a>. Die Grafik wurde auf den gezeigten Teil beschnitten und die obenstehende Beschriftung entfernt. 2024</p>
</div>
<p>&nbsp;</p>
<p>Für drei- und mehrdimensionale Datenstrukturen werden häufig spezialisierte Datenformate verwendet, die im Abschnitt <a href="#sec-spezialformate" class="quarto-xref">Kapitel&nbsp;11</a> behandelt werden. Dies hat unter anderem den Grund, dass so leichter verschiedene Datentypen verarbeitet und mit Metadaten (siehe <a href="#sec-metadaten" class="quarto-xref">Kapitel&nbsp;4.4</a>) dokumentiert werden können.</p>
<p><strong>optional: Exkurs JSON <a href="https://docs.python.org/3/tutorial/inputoutput.html" class="uri">https://docs.python.org/3/tutorial/inputoutput.html</a></strong></p>
<section id="bilddaten-einlesen" class="level4">
<h4 class="anchored" data-anchor-id="bilddaten-einlesen">Bilddaten einlesen</h4>
<div class="border">
<p>Digitale Bilder liegen in Form eines dreidimensionalen Datensatzes vor. In Zeilen und Spalten liegen für jeden Pixel Farbwerte (Rot, Grün, Blau) und gegebenenfalls ein Alphawert vor (Rot, Grün, Blau, Alpha). Die Farbwerte liegen entweder im Bereich von 0 bis 1 oder von 0 bis 255 (8-Bit).</p>
<pre><code># Farbwerte für einen Pixel
[Rotwert, Grünwert, Blauwert]

# Eine Bildzeile mit drei Pixeln
[[Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert]]

# Ein Bild aus drei Zeilen und Spalten
[[[Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert]],
[[Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert]],
[[Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert], [Rotwert, Grünwert, Blauwert]]]</code></pre>
<p>Bilddateien können mit der Funktion <code>plt.imread()</code> aus dem Modul <code>matplotlib.pyplot</code> eingelesen werden.</p>
<div class="border">
<div id="bf01cf88" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>logo <span class="op">=</span> plt.imread(fname <span class="op">=</span> <span class="st">'skript/00-bilder/python-logo-and-wordmark-cc0-tm.png'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>plt.imshow(logo)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="einlesen-strukturierter-datensätze_files/figure-html/cell-29-output-1.png" width="575" height="200" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Python Logo von Python Software Foundation steht unter der <a href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3</a>. Die Wort-Bild-Marke ist markenrechtlich geschützt: <a href="https://www.python.org/psf/trademarks/" class="uri">https://www.python.org/psf/trademarks/</a>. Das Werk ist abrufbar auf <a href="https://de.m.wikipedia.org/wiki/Datei:Python_logo_and_wordmark.svg">wikimedia</a>. 2008</p>
</div>
<p>&nbsp;</p>
<p>Die Struktur des Datensatzes kann mit dem Attribut <code>.shape</code> abgerufen werden.</p>
<div id="93544715" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(logo), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logo.shape)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.ndarray'&gt; 

(144, 486, 4)</code></pre>
</div>
</div>
<p>Die Daten wurden als NumPy.ndarray eingelesen. Das Logo hat 144 Zeilen, 486 Spalten und liegt im RGBA-Farbraum vor. Ein Ausschnitt der Daten sieht so aus:</p>
<div id="2a6a68d4" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logo[<span class="dv">50</span>:<span class="dv">52</span>, <span class="dv">50</span>:<span class="dv">52</span>, : ])</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[[0.21568628 0.44705883 0.63529414 1.        ]
  [0.21568628 0.44705883 0.63529414 1.        ]]

 [[0.21568628 0.44705883 0.63529414 1.        ]
  [0.21176471 0.44313726 0.6313726  1.        ]]]</code></pre>
</div>
</div>
<p><span class="citation" data-cites="Arnold-2023-numpy-dateien">(<a href="#ref-Arnold-2023-numpy-dateien" role="doc-biblioref">Arnold 2023b</a>)</span></p>
</div>
</section>
</section>
<section id="übung-dreidimensionale-datensätze" class="level3">
<h3 class="anchored" data-anchor-id="übung-dreidimensionale-datensätze">Übung dreidimensionale Datensätze</h3>
<p>Über den Index der dritten Dimension können die Farbkanäle Rot, Grün und Blau ausgewählt und mit der Funktion <code>plt.imshow(cmap = 'Greys_r')</code> einzeln dargestellt werden. Das Argument <code>cmap = 'Greys_r'</code> weist die Funktion an, die invertierte Grauskala benutzen. Dadurch werden hohe Farbwerte hell und niedrige Farbwerte dunkel dargestellt. <strong>Stellen Sie die Farbkanäle Rot, Grün und Blau des Pythonlogos einzeln mit der Funktion <code>plt.imshow(cmap = 'Greys_r')</code> dar.</strong></p>
<div id="tip-logo" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;11: Musterlösung dreidimensionale Datensätze
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="21d7957b" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>kanal <span class="op">=</span> [<span class="st">"Rotkanal"</span>, <span class="st">"Grünkanal"</span>, <span class="st">"Blaukanal"</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  plt.subplot(<span class="dv">1</span>, <span class="dv">4</span>, i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  plt.imshow(logo[ :, :, i], cmap <span class="op">=</span> <span class="st">'Greys_r'</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  plt.title(label <span class="op">=</span> kanal[i])</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.colorbar(shrink <span class="op">=</span> <span class="fl">0.15</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="einlesen-strukturierter-datensätze_files/figure-html/cell-32-output-1.png" width="652" height="114" class="figure-img"></p>
<figcaption>Farbkanäle des Pythonlogos</figcaption>
</figure>
</div>
</div>
</div>
<p>Möglicherweise wundern Sie sich, warum der Bildhintergrund in jedem Farbkanal schwarz ist. Die Ursache finden Sie im nächsten Tipp.</p>
<div id="tip-logo" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;10: Erklärung Bildhintergrund
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Der Bildhintergrund hat in allen Kanälen, auch im Alphakanal, den Farbwert 0. Dieser Teil des Bildes ist deshalb vollständig transparent und wird vom Hintergrund der Internetseite ausgefüllt. Der Bildhintergrund des Logos wirkt deshalb weiß.</p>
<div id="29403da1" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alphakanal</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(logo[ :, :, <span class="dv">3</span>], cmap <span class="op">=</span> <span class="st">'Greys_r'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plt.title(label <span class="op">=</span> <span class="st">'Alphakanal'</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.colorbar(shrink <span class="op">=</span> <span class="fl">0.4</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Die ersten zwei Zeilen und Spalten des Logos</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(logo[<span class="dv">0</span>:<span class="dv">2</span>, <span class="dv">0</span>:<span class="dv">2</span>, : ])</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="einlesen-strukturierter-datensätze_files/figure-html/cell-33-output-1.png" width="534" height="185" class="figure-img"></p>
<figcaption>Alphakanal des Pythonlogos</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[[0. 0. 0. 0.]
  [0. 0. 0. 0.]]

 [[0. 0. 0. 0.]
  [0. 0. 0. 0.]]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-datentyp" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-datentyp"><span class="header-section-number">4.3</span> Datentyp</h2>
<p>Der Datentyp gibt an, wie die in einem Datensatz einhaltenen Werte von Python interpretiert werden sollen. Beispielsweise kann der Wert “1” ein Zeichen, eine Ganzzahl, einen Wahrheitswert, den Monat Januar oder die Ausprägung einer kategorialen Variablen repräsentieren. Python unterstützt als vielseitig einsetzbare Programmiersprache zahlreiche Datentypen, die den Kategorien: numerics, sequences, mappings, classes, instances and exceptions zugeordnet sind. Nähere Informationen dazu finden Sie in der <a href="https://docs.python.org/3/library/stdtypes.html">Dokumentation</a>.</p>
<div class="border">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/python3-standard-type-hierarchy.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Datentypen in Python</figcaption>
</figure>
</div>
<p>Python 3. The standard type hierarchy. von Максим Пе ist lizensiert unter <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.de">CC BY SA 4.0</a> und abrufbar auf <a href="https://commons.wikimedia.org/wiki/File:Python_3._The_standard_type_hierarchy.png">wikimedia</a>. 2018</p>
</div>
<p>&nbsp;</p>
<p>Durch Module werden weitere Datentypen hinzugefügt. In der Datenanalyse häufig verwendete Datentypen sind:</p>
<ul>
<li><p>Zahlen: Ganzzahl, Fließkommazahlen</p></li>
<li><p>Wahrheitswerte</p></li>
<li><p>Zeichenketten</p></li>
<li><p>Datums- und Uhrzeitangaben</p></li>
<li><p>Kategorie<!-- Faktor in R--> (aus dem Modul <a href="https://pandas.pydata.org/docs/user_guide/categorical.html">Pandas</a>)</p></li>
</ul>
<p>Python enthält Funktionen, um den Datentyp eines Werts zu bestimmen und ggf. umzuwandeln. Einige dieser Funktionen werden exemplarisch vorgestellt.</p>
<div id="01c56b69" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">67</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a, <span class="bu">type</span>(a))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> a <span class="op">+</span> <span class="fl">1.8</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b, <span class="bu">type</span>(b), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in Ganzzahlen mit int(): </span><span class="sc">{</span>( a <span class="op">:=</span> <span class="bu">int</span>(a) )<span class="sc">,</span> (b <span class="op">:=</span> <span class="bu">int</span>(b) )<span class="sc">}</span><span class="ss"> - Beachten Sie das Abschneiden der Nachkommastelle.</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in ASCII-Zeichen mit chr(): </span><span class="sc">{</span>( a <span class="op">:=</span> <span class="bu">chr</span>(a) )<span class="sc">,</span> ( b <span class="op">:=</span> <span class="bu">chr</span>(b) )<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in eine ASCII-Zahl mit ord(): </span><span class="sc">{</span>( a <span class="op">:=</span> <span class="bu">ord</span>(a) )<span class="sc">,</span> ( b <span class="op">:=</span> <span class="bu">ord</span>(b) )<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in Fließkommazahlen mit float(): </span><span class="sc">{</span>( a <span class="op">:=</span> <span class="bu">float</span>(a) )<span class="sc">,</span> ( b <span class="op">:=</span> <span class="bu">float</span>(b) )<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in Zeichen mit str(): </span><span class="sc">{</span>( a <span class="op">:=</span> <span class="bu">str</span>(a) )<span class="sc">,</span> ( b<span class="op">:=</span> <span class="bu">str</span>(b) )<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Umwandlung in Wahrheitswerte mit bool(): </span><span class="sc">{</span><span class="bu">bool</span>(a)<span class="sc">,</span> <span class="bu">bool</span>(b)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>67 &lt;class 'int'&gt;
68.8 &lt;class 'float'&gt; 

Umwandlung in Ganzzahlen mit int(): (67, 68) - Beachten Sie das Abschneiden der Nachkommastelle.

Umwandlung in ASCII-Zeichen mit chr(): ('C', 'D')

Umwandlung in eine ASCII-Zahl mit ord(): (67, 68)

Umwandlung in Fließkommazahlen mit float(): (67.0, 68.0)

Umwandlung in Zeichen mit str(): ('67.0', '68.0')

Umwandlung in Wahrheitswerte mit bool(): (True, True)</code></pre>
</div>
</div>
<p>Der Datentyp bestimmt zum einen den zulässigen Wertebereich einer Variablen. Beispielsweise sind 0 und 13 zulässige Ganzzahlen, aber keine gültigen Kodierungen des Monats. Zum anderen definiert der Datentyp, welche Operationen mit den Werten zulässig sind und wie diese von Python ausgeführt werden. Dies betrifft Operatoren und Funktionen.</p>
<div id="nte-operation-nach-datentyp" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;1: Datentypabhängige Operationen und Funktionen
</div>
</div>
<div class="callout-body-container callout-body">
<div id="02c91406" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Der Operator + bewirkt die Addition von Zahlen</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">1</span> <span class="op">+</span> <span class="dv">13</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Der Operator + bewirkt auch das Verketten von strings</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">str</span>(<span class="dv">1</span>) <span class="op">+</span> <span class="bu">str</span>(<span class="dv">13</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>14
113</code></pre>
</div>
</div>
<p>Die Sortierfunktion arbeitet abhängig vom Datentyp.</p>
<div id="d79891a7" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Liste von Monatskürzeln erstellen</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.Series([ <span class="st">'07.06.2000'</span>, <span class="st">'12.01.2000'</span>, <span class="st">'11.02.2000'</span>, <span class="st">'04.09.2000'</span>, <span class="st">'10.03.2000'</span>, <span class="st">'03.10.2000'</span>, <span class="st">'09.04.2000'</span>, <span class="st">'08.05.2000'</span>, <span class="st">'06.07.2000'</span>, <span class="st">'05.08.2000'</span>, <span class="st">'02.11.2000'</span>, <span class="st">'01.12.2000'</span>])</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> pd.to_datetime(dates, <span class="bu">format</span> <span class="op">=</span> <span class="st">'</span><span class="sc">%d</span><span class="st">.%m.%Y'</span>)<span class="op">;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Eine unsortierte Liste von Monatskürzeln:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">list</span>(dates.dt.strftime(<span class="st">'%b'</span>))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Liste alphabetisch sortiert:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">sorted</span>(<span class="bu">list</span>(dates.dt.strftime(<span class="st">'%b'</span>)))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Liste als datetime-Objekt sortiert:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">list</span>(dates.sort_values().dt.strftime(<span class="st">'%b'</span>))<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Eine unsortierte Liste von Monatskürzeln:
['Jun', 'Jan', 'Feb', 'Sep', 'Mar', 'Oct', 'Apr', 'May', 'Jul', 'Aug', 'Nov', 'Dec']

Die Liste alphabetisch sortiert:
['Apr', 'Aug', 'Dec', 'Feb', 'Jan', 'Jul', 'Jun', 'Mar', 'May', 'Nov', 'Oct', 'Sep']

Die Liste als datetime-Objekt sortiert:
['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']</code></pre>
</div>
</div>
</div>
</div>
<div id="tip-datatype" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;12: Datentyp kontollieren und plausibilisieren
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Beim Einlesen von Datensätzen ist es wichtig, die korrekte Erkennung der Datentypen zu kontrollieren bzw. aktiv zu steuern. Weitere Methoden für die formale Prüfung des Datentyps und für die Kontrolle des Wertebereichs werden in <a href="#sec-numpypandas" class="quarto-xref">Kapitel&nbsp;5</a> vorgestellt.</p>
</div>
</div>
</div>
<section id="sec-missing" class="level3">
<h3 class="anchored" data-anchor-id="sec-missing">Fehlende Werte</h3>
<p>Ein besonderer Datentyp ist der zur Repräsentation fehlender Werte. In Python wird zwischen nicht existenten und nicht definierten Werten unterschieden.</p>
<section id="nullwert-none" class="level4">
<h4 class="anchored" data-anchor-id="nullwert-none">Nullwert None</h4>
<p>Der sogenannte Nullwert in Python ist <code>None</code>, das zu den definierten Schlüsselwörtern in Python gehört.</p>
<div id="acee6e48" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(<span class="va">None</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'NoneType'&gt;</code></pre>
</div>
</div>
<p><code>None</code> repräsentiert nicht existente Werte und Objekte. Leere (aber existente) Objekte gehören nicht zum Datentyp <code>None</code>.</p>
<div id="e389c32d" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>leere_liste <span class="op">=</span> []</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>leere_liste <span class="op">==</span> <span class="va">None</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>False</code></pre>
</div>
</div>
<p><code>None</code> kann Funktionen als Argument übergeben oder von diesen als Rückgabewert ausgegeben werden. Operationen sind mit <code>None</code> jedoch nicht möglich.</p>
<div id="c65ed66c" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Operationen mit None führen zu Fehlermeldungen</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="va">None</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Der übergebene Wert führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="va">None</span> <span class="op">+</span> <span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Der übergebene Wert führt zu der Fehlermeldung:
 unsupported operand type(s) for +: 'NoneType' and 'int'</code></pre>
</div>
</div>
<p>Eine Ausnahme ist die Umwandlung in eine Zeichenkette.</p>
<div id="0cac71b1" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Eine Ausnahme ist die Umwandlung in strings</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="va">None</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">print(a) gibt den Nullwert zurück:</span><span class="ch">\n</span><span class="st">"</span>, a, sep <span class="op">=</span> <span class="st">""</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">str(a) gibt eine Zeichenkette zurück:"</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="bu">str</span>(a)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
print(a) gibt den Nullwert zurück:
None

str(a) gibt eine Zeichenkette zurück:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>'None'</code></pre>
</div>
</div>
</section>
<section id="nan" class="level4">
<h4 class="anchored" data-anchor-id="nan">NaN</h4>
<p>Um mit fehlenden Werten innerhalb eines Datensatzes arbeiten zu können, gibt es den Wert <code>NaN</code>, der zur Klasse der Fließkommazahlen gehört. <code>NaN</code> steht für Not a Number und repräsentiert undefinierte oder nicht darstellbare Werte. Beispielsweise berechnet die Methode <code>pd.diff()</code> die Differenz jedes Werts zu seinem Vorgänger. Da der erste Wert keinen Vorgänger hat, wird <code>NaN</code> erzeugt.</p>
<div id="30c20216" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>my_series <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>])</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>my_series.diff()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0    NaN
1    1.0
2    2.0
3    4.0
dtype: float64</code></pre>
</div>
</div>
<p>Anders als <code>None</code> ist <code>NaN</code> kein Standardschlüsselwort in Python. Der Wert <code>NaN</code> wird erzeugt mit <code>float('nan')</code> oder <code>float('NaN')</code>, die Groß- und Kleinschreibung spielt keine Rolle. <code>NaN</code> hat also den Datentyp Fließkommazahl. Die Module math und NumPy bieten mit <code>math.nan</code> und <code>np.nan</code> ebenfalls Funktionen, um <code>NaN</code> zu erzeugen.</p>
<div id="90f83a8b" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(<span class="bu">float</span>(<span class="st">'NaN'</span>)))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'float'&gt;</code></pre>
</div>
</div>
<p>Mit dem Wert ‘NaN’ können Operationen ausgeführt werden. Das Ergebnis ist immer <code>NaN</code>.</p>
<div id="18f1e845" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">float</span>(<span class="st">'NaN'</span>) <span class="op">+</span> <span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nan</code></pre>
</div>
</div>
<p>Einige Funktionen können mit <code>NaN</code> als Platzhalter für fehlende Werte umgehen.</p>
<div id="7ca94f46" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python-Basis</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"sum():"</span>, <span class="bu">sum</span>([<span class="dv">1</span>, <span class="dv">2</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), <span class="dv">4</span>]), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"max():"</span>, <span class="bu">max</span>([<span class="dv">1</span>, <span class="dv">2</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), <span class="dv">4</span>]), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"any():"</span>, <span class="bu">any</span>([<span class="dv">1</span>, <span class="dv">2</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), <span class="dv">4</span>]), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pandas</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>daten_mit_nan <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), <span class="dv">4</span>])</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_mit_nan <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Summe des Datensates:"</span>, daten_mit_nan.<span class="bu">sum</span>())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sum(): nan 

max(): 4 

any(): True 

0    2.0
1    3.0
2    NaN
3    5.0
dtype: float64

Summe des Datensates: 7.0</code></pre>
</div>
</div>
<div id="wrn-logicbasepython" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;4: Achtung Logik!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Die logische Abfrage fehlender Werte unterscheidet sich für <code>None</code> und <code>NaN</code>.</p>
<div id="11d82018" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>bool_values <span class="op">=</span> [<span class="va">None</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>)]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  bool_value <span class="op">=</span> <span class="bu">bool</span>(element)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Wahrheitswert von"</span>, element, <span class="st">"ist"</span>, bool_value)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wahrheitswert von None ist False
Wahrheitswert von nan ist True</code></pre>
</div>
</div>
<p>Dies gilt auch für die (logische Identität)[https://de.wikipedia.org/wiki/Identit%C3%A4t_(Logik)].</p>
<div id="786a0dae" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> element <span class="op">==</span> element</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Identität von"</span>, element, <span class="st">"ist"</span>, result)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Identität von None ist True
Identität von nan ist False</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="fehlende-werte-in-der-praxis" class="level3">
<h3 class="anchored" data-anchor-id="fehlende-werte-in-der-praxis">Fehlende Werte in der Praxis</h3>
<p><code>None</code> und <code>NaN</code> sind pythonspezifische Repräsentationen für nicht existente oder nicht definierte Werte. In der Praxis werden fehlende Werte in Datensätzen auf unterschiedliche Weise gekennzeichnet.</p>
<p>In Datensätzen übliche Werte sind:</p>
<ul>
<li><p>kein Eintrag, beispielsweise in kommaseparierten Dateien eine leere Zeichenkette <code>""</code></p></li>
<li><p>definierte Zeichenfolge: <code>NA</code> in der Programmiersprache R, <code>NULL</code> in der Datenbanksprache SQL, <code>.</code> in der Statistik-Software Stata</p></li>
<li><p>(mehrere) manuell gewählte Zeichen oder Ziffern außerhalb des zulässigen Wertebereichs wie -1, -88, -99 (häufig bei Umfragedaten)</p></li>
</ul>
<p>Die Art der Kennzeichnung ist jeweils mit Vor- und Nachteilen verbunden. Eine definierte Zeichenfolge für fehlende Werte hilft dabei, Lücken im Datensatz von Fehlern bei der Datenerfassung zu unterscheiden. Dazu ist eine definierte Zeichenfolge wie “NA” besser als eine leere Zeichenkette geeignet. Manuell gewählte Werte erlauben es, bei der automatischen Auswertung eines Datensatzes abhängig von der Situation ein bestimmtes Verhalten für jede Variable festzulegen (z. B. Unterscheidung von nicht zutreffend, Aussage verweigert, weiß nicht, Interview abgebrochen keine Antwort).</p>
<div id="tip-missingvalues" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;13: fehlende Werte
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Die Identifizierung und ggf. Bereinigung fehlender Werte ist ein wichtiger Schritt beim Einlesen strukturierter Datensätze. Dabei hilft es, die gängigen Kennzeichnungen für fehlende Werte zu kennen und sich über die Konventionen des jeweiligen Dateiformats bzw. der jeweiligen Disziplin zu informieren. Dennoch ist manchmal ein gewisser Spürsinn unerlässlich. Geeignete Funktionen zur Identifizierung fehlender Werte werden in <a href="#sec-numpypandas" class="quarto-xref">Kapitel&nbsp;5</a> vorgestellt.</p>
</div>
</div>
</div>
</section>
</section>
<section id="sec-metadaten" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-metadaten"><span class="header-section-number">4.4</span> Metadaten</h2>
<p>Metadaten sind beschreibende Informationen eines Datensatzes. Metadaten geben beispielsweise an:</p>
<ul>
<li><p>welche Datentypen ein Datensatz enthält,</p></li>
<li><p>verwendete Kodierschemen, Skalen oder mimimal und maximal zulässige Werte,</p></li>
<li><p>die Bedingungen, unter denen die Daten erhoben wurden,</p></li>
<li><p>Herkunft der Daten,</p></li>
<li><p>Beziehungen zwischen Variablen und Datensätzen,</p></li>
<li><p>urheberrechtliche Informationen und Lizenzhinweise.</p></li>
</ul>
<p>(vgl. <a href="https://docs.hdfgroup.org/archive/support/HDF5/doc/Advanced/HDF5_Metadata/index.html">The HDF Group Help Desk</a>)</p>
<p>Spezialisierte Dateiformate wie netCDF oder HDF deklarieren Metadaten explizit in dafür vorgesehenen Feldern. Vielen Dateiformaten fehlt eine solche Funktion. Relevante Metadaten stehen deshalb häufig im Dateinamen, in Spaltenbeschriftungen, in zusätzlichen Tabellenblättern oder in separaten Dokumenten (die nicht immer zur Verfügung stehen).</p>
<div id="tip-metadata" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;14: Metadaten
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Insbesondere vor dem Einlesen komplexer Datensätze sollten Begleitmaterialien, sofern vorhanden, studiert werden.</p>
<p><strong>Hier Querverweis auf w-rechtliche Grundlagen Datenmanagement</strong></p>
</div>
</div>
</div>
</section>
</section>
<section id="sec-numpypandas" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Die Module NumPy und Pandas</h1>
<p>Die Module NumPy und Pandas erlauben ein effizientes Arbeiten mit Datensätzen. Insbesondere das Lesen- und Schreiben von Dateien und die Verwaltung von Datentypen ist erheblich einfacher als mit der Python-Basis. Außerdem sind die vektorisierten Operationen vielfach schneller als Operationen mit Python. Das Modul Pandas basiert auf NumPy. In den folgenden Abschnitten werden beide Module behandelt.</p>
<p>Eine kurze Übersicht der Vor- und Nachteile:</p>
<ul>
<li><p>NumPy: n-dimensionale Array-Struktur mit Unterstützung der am häufigsten verwendeten Datentypen sowie zahlreicher numerischer Formate für spezialisierte wissenschaftliche Berechnungen (<a href="https://numpy.org/devdocs/reference/arrays.scalars.html">siehe Dokumentation</a>). Ein Array kann immer nur einen Datentyp haben und die Größe von Arrays ist unveränderlich. Dafür werden Operationen etwas schneller als in der DataFrame-Struktur von Pandas ausgeführt.<br>
<strong>Querverweis auf w-NumPy</strong></p>
<ul>
<li>Spaltennamen sind mit einem strukturierten dtype möglich (<a href="https://numpy.org/doc/stable/user/basics.io.genfromtxt.html#setting-the-names">siehe Dokumentation</a>)</li>
</ul></li>
<li><p>Pandas: 2-dimensionale DataFrame-Struktur im long- und wide-Format. DataFrames können mehrere Datentypen enthalten und die Größe von DataFrames ist veränderlich. Unterstützung von alphanummerischen Spalten- und Indexbeschriftungen.<br>
<strong>Querverweis auf w-Pandas</strong></p>
<ul>
<li>dreidimensionale DataFrames sind mit einem Multiindex möglich –&gt; das widerspricht aber dem Konzept von Tidy Data</li>
</ul></li>
</ul>
<p>Für beide Module haben sich diese Kürzel etabliert:</p>
<div id="182a863b" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Deklarieren der Anzahl der Nachkommastellen</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.precision"</span>, <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tip-pypandas" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;15: Arbeiten mit NumPy und Pandas
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Ob Sie mit NumPy oder mit Pandas arbeiten, hängt von dem vorliegenden Datensatz und persönlichen Präferenzen ab.</p>
<p>Das Paket Pandas erlaubt es, Daten aus verschiedenen Quellen wie CSV-Dateien oder Excel-Tabellen und mit unterschiedlichen Datentypen in einen DataFrame zu laden. Anschließend können diese mit wenigen Befehlen untersucht und umstrukturiert werden. Komplexe Operationen wie das Umformen von Datensätzen, das Gruppieren und Aggregieren von Daten sowie das Filtern und Sortieren sind effizient möglich.</p>
<p>Bis auf wenige Ausnahmen sind Pandas und NumPy zueinander kompatibel. Es spricht nichts dagegen, Ihre Daten mit Pandas vorzubereiten und anschließend mit NumPy auszuwerten.</p>
</div>
</div>
</div>
<section id="datentypen" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="datentypen"><span class="header-section-number">5.1</span> Datentypen</h2>
<p>NumPy unterstützt folgende Datentypen:</p>
<table class="table">
<thead>
<tr class="header">
<th>Datentyp NumPy-Array</th>
<th>Datentyp in Python</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>int_</td>
<td>int</td>
</tr>
<tr class="even">
<td>double</td>
<td>float</td>
</tr>
<tr class="odd">
<td>cdouble</td>
<td>complex</td>
</tr>
<tr class="even">
<td>bytes_</td>
<td>bytes</td>
</tr>
<tr class="odd">
<td>str_</td>
<td>str</td>
</tr>
<tr class="even">
<td>bool_</td>
<td>bool</td>
</tr>
<tr class="odd">
<td>datetime64</td>
<td>datetime.datetime</td>
</tr>
<tr class="even">
<td>timedelta64</td>
<td>datetime.timedelta</td>
</tr>
</tbody>
</table>
<p><a href="https://numpy.org/devdocs/reference/arrays.scalars.html">Dokumentation NumPy</a></p>
<p>In den meisten Fällen verwendet das Modul Pandas die NumPy-Datentypen. Pandas führt aber auch einige zusätzliche Datentypen ein. Eine vollständige Liste finden Sie in der <a href="https://pandas.pydata.org/docs/reference/arrays.html">Pandas Dokumentation</a>. Die wichtigsten zusätzlichen Datentypen sind:</p>
<ul>
<li><p><a href="https://pandas.pydata.org/docs/user_guide/categorical.html">Kategorie</a> <code>dtype = 'category'</code></p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.html#pandas.Timestamp">Zeitzonenbewusstes Datumsformat</a> <code>dtype = 'datetime64[ns, US/Eastern]'</code></p></li>
</ul>
</section>
<section id="dateien-lesen-und-schreiben" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="dateien-lesen-und-schreiben"><span class="header-section-number">5.2</span> Dateien lesen und schreiben</h2>
<p>In den Werkzeugbausteinen NumPy und Pandas haben Sie die Funktionen zum Lesen und Schreiben von Dateien kennengelernt.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">NumPy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>In NumPy können Dateien mit der Funktion <code>np.loadtxt()</code> gelesen und mit der Funktion <code>np.savetxt()</code> geschrieben werden.</p>
<ul>
<li><p><code>np.loadtxt(fname = data.txt, delimiter = ";", skiprows= #Reihen)</code></p></li>
<li><p><code>np.savetxt(fname = dateipfad, X = daten, header = kommentar, fmt='%5.2f')</code></p></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>In Pandas werden Dateien mit einer Reihe spezialisierter Funktionen gelesen und geschrieben, die einem einheitlichen Schema folgen. Funktionen zum Lesen von Dateien werden in der Form <code>pd.read_csv</code> und Funktionen zum Schreiben in der Form <code>pd.to_csv</code> aufgerufen.</p>
<div class="border">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Format Type</th>
<th style="text-align: center;">Data Description</th>
<th style="text-align: center;">Reader</th>
<th style="text-align: center;">Writer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">text</td>
<td style="text-align: center;">CSV</td>
<td style="text-align: center;">read_csv</td>
<td style="text-align: center;">to_csv</td>
</tr>
<tr class="even">
<td style="text-align: center;">text</td>
<td style="text-align: center;">Fixed-Width Text File</td>
<td style="text-align: center;">read_fwf</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">text</td>
<td style="text-align: center;">JSON</td>
<td style="text-align: center;">read_json</td>
<td style="text-align: center;">to_json</td>
</tr>
<tr class="even">
<td style="text-align: center;">text</td>
<td style="text-align: center;">HTML</td>
<td style="text-align: center;">read_html</td>
<td style="text-align: center;">to_html</td>
</tr>
<tr class="odd">
<td style="text-align: center;">text</td>
<td style="text-align: center;">LaTeX</td>
<td style="text-align: center;">Styler.to_latex</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">text</td>
<td style="text-align: center;">XML</td>
<td style="text-align: center;">read_xml</td>
<td style="text-align: center;">to_xml</td>
</tr>
<tr class="odd">
<td style="text-align: center;">text</td>
<td style="text-align: center;">Local clipboard</td>
<td style="text-align: center;">read_clipboard</td>
<td style="text-align: center;">to_clipboard</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">MS Excel</td>
<td style="text-align: center;">read_excel</td>
<td style="text-align: center;">to_excel</td>
</tr>
<tr class="odd">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">OpenDocument</td>
<td style="text-align: center;">read_excel</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">HDF5 Format</td>
<td style="text-align: center;">read_hdf</td>
<td style="text-align: center;">to_hdf</td>
</tr>
<tr class="odd">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">Feather Format</td>
<td style="text-align: center;">read_feather</td>
<td style="text-align: center;">to_feather</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">Parquet Format</td>
<td style="text-align: center;">read_parquet</td>
<td style="text-align: center;">to_parquet</td>
</tr>
<tr class="odd">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">ORC Format</td>
<td style="text-align: center;">read_orc</td>
<td style="text-align: center;">to_orc</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">Stata</td>
<td style="text-align: center;">read_stata</td>
<td style="text-align: center;">to_stata</td>
</tr>
<tr class="odd">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">SAS</td>
<td style="text-align: center;">read_sas</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">SPSS</td>
<td style="text-align: center;">read_spss</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">binary</td>
<td style="text-align: center;">Python Pickle Format</td>
<td style="text-align: center;">read_pickle</td>
<td style="text-align: center;">to_pickle</td>
</tr>
<tr class="even">
<td style="text-align: center;">SQL</td>
<td style="text-align: center;">SQL</td>
<td style="text-align: center;">read_sql</td>
<td style="text-align: center;">to_sql</td>
</tr>
</tbody>
</table>
<p>(<a href="https://pandas.pydata.org/docs/user_guide/io.html">Pandas Dokumentation</a>)</p>
</div>
</div>
</div>
</div>
</section>
<section id="datentypen-erkennen-und-festlegen" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="datentypen-erkennen-und-festlegen"><span class="header-section-number">5.3</span> Datentypen erkennen und festlegen</h2>
<p>Der Datentyp bestimmt, wie bereits ausgeführt, den zulässigen Wertebereich einer Variablen, zulässige Operationen und die Ausführung von Operatoren und Funktionen in Python. Die Module NumPy und Pandas bieten eine Reihe von Funktionen, um den Datentyp von Variablen zu kontrollieren und festzulegen.</p>
<p><strong>ergänzen: Datumsformat Hinweis auf Zeitreihen <a href="#sec-zeitreihen" class="quarto-xref">Kapitel&nbsp;6</a></strong></p>
<section id="numpy-1" class="level3">
<h3 class="anchored" data-anchor-id="numpy-1">NumPy</h3>
<p>Mit NumPy kann der Datentyp eines Arrays beim Einlesen einer Datei mit dem Argument <code>dtype</code> festgelegt werden <code>np.loadtxt(fname = data.txt, dtype = 'float')</code>. Das Argument <code>dtype</code> akzeptiert die Angabe eines Datentyps, Schlüsselwörter oder Kürzel. Weiter Informationen erhalten Sie in der <a href="https://numpy.org/doc/stable/reference/arrays.dtypes.html">NumPy Dokumentation</a>.</p>
<table class="table">
<thead>
<tr class="header">
<th>Datentyp</th>
<th>Schlüsselwort</th>
<th>Kürzel</th>
<th>dtype</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Fließkommazahl</td>
<td>float</td>
<td>f8</td>
<td>float64</td>
</tr>
<tr class="even">
<td>Ganzzahl</td>
<td>int</td>
<td>i</td>
<td>int32</td>
</tr>
<tr class="odd">
<td>Wahrheitswert</td>
<td>bool</td>
<td>?</td>
<td>bool</td>
</tr>
<tr class="even">
<td>Datum</td>
<td>datetime64</td>
<td>M</td>
<td>datetime64</td>
</tr>
<tr class="odd">
<td>Zeichenkette</td>
<td>str</td>
<td>U</td>
<td>U + Ziffer zur Angabe der benötigten Bytes</td>
</tr>
</tbody>
</table>
<p>Der Datentyp eines Arrays kann mit dem Attribut <code>np.dtype</code> bestimmt werden. Der Datentyp eines Objekts kann mit der Methode <code>np.array = np.array.astype()</code> geändert werden.</p>
<p>Folgende Datei ist Ihnen aus dem w-NumPy bekannt.</p>
<div id="93297b22" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01.csv'</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>daten <span class="op">=</span> np.loadtxt(dateipfad)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Prüfen Sie den dtype der Datei und legen Sie eine Kopie des Objekts mit Datentyp Ganzzahl an. Wie kann überprüft werden, ob bei der Umwandlung in Ganzzahlen Nachkommastellen abgeschnitten wurden?</strong></p>
<div id="tip-numpydatentyp" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;16: Musterlösung Datentypumwandlung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="051aea61" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ausgabe des Datentyps</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten.dtype)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Umwandlung in Ganzzahl</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>daten_int <span class="op">=</span> daten.astype(<span class="st">'int'</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Prüfen auf Datenverlust</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>prüfsumme <span class="op">=</span> daten <span class="op">-</span> daten_int</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Differenz daten - daten_int: </span><span class="sc">{</span>pr<span class="sc">ü</span>fsumme<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>float64
Differenz daten - daten_int: 664.0</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="pandas-1" class="level3">
<h3 class="anchored" data-anchor-id="pandas-1">Pandas</h3>
<p>Das Modul Pandas ist auf den Umgang mit unterschiedlichen Datentypen spezialisiert. Den Funktionen zum Einlesen von Daten kann mit dem Argument <code>dtype</code> der Datentyp übergeben werden. Für mehrere Spalten ist dies in Form eines Dictionaries in der Form <code>{'Spaltenname': 'dtype'}</code> möglich.<br>
Das Atrribut zur Ausgabe des Datentyps heißt passenderweise <code>pd.DataFrame.dtypes</code> (angefügtes s beachten). Der Datentyp eines Pandas-Datenobjekts kann analog zu NumPy mit <code>pd.Series = pd.Series.astype()</code> geändert werden.</p>
<section id="zahnwachstum-bei-meerschweinchen" class="level4">
<h4 class="anchored" data-anchor-id="zahnwachstum-bei-meerschweinchen">Zahnwachstum bei Meerschweinchen</h4>
<p>In einer Gruppe von 60 Meerschweinchen (<strong>1. Spalte ohne Beschriftung</strong>) wurde die Länge der zahnbildenden Zellen (Odontoblasten) in Micron gemessen (<strong>len</strong>). Den Tieren wurde zuvor Vitamin C in Form von Ascorbinsäure (VC) oder Orangensaft (VC) verabreicht (<strong>supp</strong>). Die Meerschweinchen erhielten Dosen von 0.5, 1 oder 2 Milligramm Vitamin C pro Tag (<strong>dose</strong>). Die Messdaten sind in der Datei ToothGrowth.csv gespeichert (Crampton 1947.)</p>
<div class="border">
<p>Crampton, E. W. 1947. „THE GROWTH OF THE ODONTOBLASTS OF THE INCISOR TOOTH AS A CRITERION OF THE VITAMIN C INTAKE OF THE GUINEA PIG“. The Journal of Nutrition 33 (5): 491–504. <a href="https://doi.org/10.1093/jn/33.5.491" class="uri">https://doi.org/10.1093/jn/33.5.491</a></p>
</div>
<p>&nbsp;</p>
<p><strong>Lesen Sie die Datei wie folgt ein:</strong></p>
<ul>
<li><p>Die Spaltenbeschriftung der 1. Spalte soll mit der Beschriftung ‘ID’ ersetzt werden (ohne Anführungszeichen).</p></li>
<li><p>Die Spalten len und dose sollen mit geeigneten numerischen Datentypen, die Spalte supp als Kategorie eingelesen werden.</p></li>
</ul>
<div id="tip-meerschweinchen" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;17: Musterlösung Meerschweinchen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="fec8ff62" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"skript/01-daten/ToothGrowth.csv"</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>meerschweinchen <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> dateipfad, sep <span class="op">=</span> <span class="st">','</span>, header <span class="op">=</span> <span class="dv">0</span>, <span class="op">\</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  names <span class="op">=</span> [<span class="st">'ID'</span>, <span class="st">'len'</span>, <span class="st">'supp'</span>, <span class="st">'dose'</span>], dtype <span class="op">=</span> {<span class="st">'ID'</span>: <span class="st">'int'</span>, <span class="st">'len'</span>: <span class="st">'float'</span>, <span class="st">'dose'</span>: <span class="st">'float'</span>, <span class="st">'supp'</span>: <span class="st">'category'</span>})</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ausgabe jedes sechsten Werts</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>meerschweinchen.iloc[meerschweinchen.index <span class="op">%</span> <span class="dv">6</span> <span class="op">==</span> <span class="dv">0</span>]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">len</th>
<th data-quarto-table-cell-role="th">supp</th>
<th data-quarto-table-cell-role="th">dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>4.2</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>7</td>
<td>11.2</td>
<td>VC</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>13</td>
<td>15.2</td>
<td>VC</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>19</td>
<td>18.8</td>
<td>VC</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>25</td>
<td>26.4</td>
<td>VC</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>31</td>
<td>15.2</td>
<td>OJ</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>37</td>
<td>8.2</td>
<td>OJ</td>
<td>0.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>43</td>
<td>23.6</td>
<td>OJ</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>49</td>
<td>14.5</td>
<td>OJ</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">54</td>
<td>55</td>
<td>24.8</td>
<td>OJ</td>
<td>2.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="a2dd19d5" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.dtypes)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ID         int32
len      float64
supp    category
dose     float64
dtype: object</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="nützliche-funktionen-zur-beschreibung-von-datensätzen" class="level4">
<h4 class="anchored" data-anchor-id="nützliche-funktionen-zur-beschreibung-von-datensätzen">Nützliche Funktionen zur Beschreibung von Datensätzen</h4>
<p>Pandas bietet einige praktische Funktionen, um den Aufbau eines Datensatzes zu beschreiben.</p>
<p>Das Attribut <code>.columns</code> gibt die Spaltenbeschriftungen als Liste zurück. Ebenfalls ist darüber ein Schreibzugriff möglich.</p>
<div id="f678ddb3" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.columns)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>meerschweinchen.columns <span class="op">=</span> [<span class="st">'ID'</span>, <span class="st">'Länge'</span>, <span class="st">'Verabreichung'</span>, <span class="st">'Dosis'</span>]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.columns)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['ID', 'len', 'supp', 'dose'], dtype='object')
Index(['ID', 'Länge', 'Verabreichung', 'Dosis'], dtype='object')</code></pre>
</div>
</div>
<p>Die Methode <code>pd.DataFrame.describe()</code> erzeugt eine beschreibende Statistik für einen DataFrame. Standardmäßig werden alle numerischen Spalten berücksichtigt. Mit dem Argument <code>include</code> können die zu berücksichtigenden Spalten vorgegeben werden. <code>include = all</code> berücksichtigt alle Spalten, was nicht unbedingt sinnvoll ist. Alternativ kann eine Liste zu berücksichtigender Datentypen übergeben werden. Das Argument <code>exclude</code> schließt auf die gleiche Weise Datentypen von der Ausgabe aus.</p>
<div id="8b76a69f" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.describe(), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.describe(include <span class="op">=</span> <span class="st">'all'</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meerschweinchen.describe(include <span class="op">=</span> [<span class="st">'float'</span>]), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          ID  Länge  Dosis
count  60.00  60.00  60.00
mean   30.50  18.81   1.17
std    17.46   7.65   0.63
min     1.00   4.20   0.50
25%    15.75  13.07   0.50
50%    30.50  19.25   1.00
75%    45.25  25.27   2.00
max    60.00  33.90   2.00 

           ID  Länge Verabreichung  Dosis
count   60.00  60.00            60  60.00
unique    NaN    NaN             2    NaN
top       NaN    NaN            OJ    NaN
freq      NaN    NaN            30    NaN
mean    30.50  18.81           NaN   1.17
std     17.46   7.65           NaN   0.63
min      1.00   4.20           NaN   0.50
25%     15.75  13.07           NaN   0.50
50%     30.50  19.25           NaN   1.00
75%     45.25  25.27           NaN   2.00
max     60.00  33.90           NaN   2.00 

       Länge  Dosis
count  60.00  60.00
mean   18.81   1.17
std     7.65   0.63
min     4.20   0.50
25%    13.07   0.50
50%    19.25   1.00
75%    25.27   2.00
max    33.90   2.00 
</code></pre>
</div>
</div>
<p>Die Methode <code>pd.DataFrame.count()</code> zählt alle vorhandenen Werte in jeder Spalte oder mit <code>pd.DataFrame.count(axis = 'columns')</code> in jeder Zeile.</p>
<div id="1b2a7e60" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>meerschweinchen.count(axis <span class="op">=</span> <span class="st">'rows'</span>) <span class="co"># der Standardwert von axis ist 'rows'</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>ID               60
Länge            60
Verabreichung    60
Dosis            60
dtype: int64</code></pre>
</div>
</div>
<p>Die Methode <code>pd.DataFrame.info()</code> erzeugt eine Beschreibung des Datensatzes.</p>
<div id="dfc66485" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>meerschweinchen.info()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 60 entries, 0 to 59
Data columns (total 4 columns):
 #   Column         Non-Null Count  Dtype   
---  ------         --------------  -----   
 0   ID             60 non-null     int32   
 1   Länge          60 non-null     float64 
 2   Verabreichung  60 non-null     category
 3   Dosis          60 non-null     float64 
dtypes: category(1), float64(2), int32(1)
memory usage: 1.5 KB</code></pre>
</div>
</div>
<p>Die Methode <code>pd.unique()</code> listet alle einzigartigen Werte auf.</p>
<div id="0e23835d" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>meerschweinchen[<span class="st">'Dosis'</span>].unique()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>array([0.5, 1. , 2. ])</code></pre>
</div>
</div>
<div id="tip-pandasinfo" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;18: Nützliche Funktionen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Pandas bietet einige praktische Funktionen, um eine eingelesene Datei zu kontrollieren. Machen Sie sich die Verwendung von <code>pd.dtypes</code> oder <code>pd.DataFrame.info()</code> zur Angewohnheit.</p>
</div>
</div>
</div>
</section>
</section>
<section id="aufgabe-datentypen" class="level3">
<h3 class="anchored" data-anchor-id="aufgabe-datentypen">Aufgabe Datentypen</h3>
<p>Das britische Energieministerium veröffentlicht Daten zu den Industriestrompreisen in den Mitgliedsändern der Internationalen Energieagentur.<br>
<strong>Lesen Sie Tabellenblatt “5.3.1 (excl. taxes)” aus der Excel-Datei ‘aufgaben/01-daten/table_531.xlsx’ mit Pandas ein. Schauen Sie in der Dokumentation der Funktion [pd.read_excel(https://pandas.pydata.org/docs/reference/api/pandas.read_excel.html) nach, wie Sie das korrekte Tabellenblatt auswählen können. Stellen Sie sicher, dass alle Spalten mit einem numerischen Datentyp eingelesen werden.</strong></p>
<div class="border">
<p>Department for Energy Security &amp; Net Zero. 2024. Energy Prices International Comparisons. Industrial electricity prices in the IEA. <a href="https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/670121/table_531.xls" class="uri">https://www.gov.uk/government/uploads/system/uploads/attachment_data/file/670121/table_531.xls</a></p>
</div>
<div id="tip-taxes" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;19: Musterlösung 5.3.1 (excl. taxes)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Überspringen der führenden Zeilen mit dem Argument <code>header = 8</code>. Auswahl des Tabellenblatts mit <code>sheet_name = "5.3.1 (excl. taxes)"</code> und Kontrolle der erkannten Datentypen mit <code>taxes.dtypes</code></p>
<div id="f2033e8d" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'aufgaben/01-daten/table_531.xlsx'</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>taxes <span class="op">=</span> pd.read_excel(io <span class="op">=</span> dateipfad, sheet_name <span class="op">=</span> <span class="st">"5.3.1 (excl. taxes)"</span>, <span class="op">\</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  header <span class="op">=</span> <span class="dv">8</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>taxes.dtypes</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>Year                            int64
Austria                       float64
Belgium                       float64
Denmark                       float64
Finland                       float64
France                        float64
Germany                       float64
Greece                        float64
Ireland                       float64
Italy                         float64
Luxembourg                    float64
Netherlands                   float64
Portugal                      float64
Spain                         float64
Sweden                        float64
United Kingdom                float64
Australia                     float64
Canada                        float64
Czech Republic                float64
Hungary                       float64
Japan                         float64
Korea                         float64
New Zealand                   float64
Norway                        float64
Poland                        float64
Slovakia                      float64
Switzerland                   float64
Republic of Türkiye            object
USA                           float64
IEA median                    float64
UK relative to IEA median%    float64
UK relative to IEA rank         int64
UK relative to G7 rank          int64
dtype: object</code></pre>
</div>
</div>
<p>Werte in Spalte ‘Republic of Türkiye’ mit <code>pd.unique()</code> ansehen.</p>
<div id="11fb17b0" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>taxes[<span class="st">'Republic of Türkiye'</span>].unique()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>array(['..', 2.0436081749999997, 3.3248584439999993, 3.2947581129644483,
       3.5628243387317866, 3.998334312, 3.838962582401693,
       4.2138469457789975, 3.775503630575527, 3.2804905218375238,
       3.783413840344277, 4.139259596071514, 4.196890742949158,
       4.658509330911754, 5.552842625063031, 4.316920402166109,
       4.1586205264300675, 4.765321921741988, 4.060617948410105,
       3.9191433658651307, 4.223710389549368, 4.481407237836746,
       4.629981488840797, 5.2657882806931235, 5.109009847145703,
       4.585007793872617, 4.769921255774284, 4.419433670846949,
       4.428906151745361, 6.171573537217762, 7.192920543071899,
       7.962417550086158, 7.035941949054445, 7.622058781522502,
       7.644892388451444, 6.47006818181818, 5.968380462724936,
       6.379514692256784, 5.537541821623266, 5.248709303933227,
       6.9100519994521274, 6.670900808798327, 5.864171132090749,
       13.928251887312259, 11.123594768114717], dtype=object)</code></pre>
</div>
</div>
<p>Zeichenkette ‘..’ entfernen und Datentyp mit Methode <code>pd.astype('float64')</code> ändern.</p>
<ul>
<li><p>Variante 1: als fehlenden Wert beim Einlesen deklarieren.</p></li>
<li><p>Variante 2: Nach dem Einlesen Indexposition bestimmen und Wert ersetzen. Das verkettete Slicing <code>df["col"][row_indexer] = value</code> wird mit der Pandas Version 3.0 nicht mehr unterstützt und gibt deshalb eine Fehlermeldung aus. Künftig ist folgende Syntax zu verwenden: <code>df.loc[row_indexer, "col"] = value</code>.</p></li>
</ul>
<div id="00619643" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variante 1: '..' als fehlenden Wert deklarieren</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># taxes = pd.read_excel(io = dateipfad, sheet_name = "5.3.1 (excl. taxes)", \</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   header = 8, na_values = ['..'])</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variante 2: Index des Werts bestimmen und mit np.NaN überschreiben</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>indexposition <span class="op">=</span> taxes[<span class="st">'Republic of Türkiye'</span>] <span class="op">==</span> <span class="st">'..'</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>taxes.loc[indexposition, <span class="st">'Republic of Türkiye'</span>] <span class="op">=</span> np.NaN</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>taxes[<span class="st">'Republic of Türkiye'</span>] <span class="op">=</span> taxes[<span class="st">'Republic of Türkiye'</span>].astype(<span class="st">'float64'</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>taxes.dtypes</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>Year                            int64
Austria                       float64
Belgium                       float64
Denmark                       float64
Finland                       float64
France                        float64
Germany                       float64
Greece                        float64
Ireland                       float64
Italy                         float64
Luxembourg                    float64
Netherlands                   float64
Portugal                      float64
Spain                         float64
Sweden                        float64
United Kingdom                float64
Australia                     float64
Canada                        float64
Czech Republic                float64
Hungary                       float64
Japan                         float64
Korea                         float64
New Zealand                   float64
Norway                        float64
Poland                        float64
Slovakia                      float64
Switzerland                   float64
Republic of Türkiye           float64
USA                           float64
IEA median                    float64
UK relative to IEA median%    float64
UK relative to IEA rank         int64
UK relative to G7 rank          int64
dtype: object</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="umgang-mit-fehlenden-werten" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="umgang-mit-fehlenden-werten"><span class="header-section-number">5.4</span> Umgang mit fehlenden Werten</h2>
<p>Eine unerwartet als string oder object eingelesene Spalte weist häufig auf fehlende Werte hin, die durch Sonderzeichen gekennzeichnet sind. Die Module NumPy und Pandas bieten Funktionen, um fehlende Werte bereits beim Einlesen zu erkennen und umzuwandeln.</p>
<section id="numpy-2" class="level3">
<h3 class="anchored" data-anchor-id="numpy-2">NumPy</h3>
<p>Die NumPy-Funktion <code>np.loadtxt()</code> wird verwendet, um vollständige Datensätze einzulesen. Fehlende Werte im Datensatz können problematisch sein, da diese entweder zu Fehlermeldungen bezüglich des Datentyps führen oder übersprungen werden, sodass das NumPy-Array kürzer als der eingelesene Datensatz ist. Da NumPy-Arrays immer nur einen Datentyp und eine feste Länge haben, kann das bei der Durchführung von Operationen mit mehreren Arrays zu Fehlern führen.</p>
<p>Folgende Datei ist Ihnen aus dem w-NumPy bekannt.</p>
<div id="d08faad8" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01.csv'</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>daten_ohne_fehlende_werte <span class="op">=</span> np.loadtxt(dateipfad)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Daten:"</span>, daten_ohne_fehlende_werte)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_ohne_fehlende_werte.shape, <span class="st">"dtype:"</span>, daten_ohne_fehlende_werte.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daten: [20.1 20.1 20.1 ... 24.3 24.2 24.2]
Struktur: (1513,) dtype: float64</code></pre>
</div>
</div>
<p>Angenommen, Sie haben eine zweite Messung durchgeführt und möchten die Differenz beider Datensätze berechnen. In der zweiten Messung haben Sensorfehler zu fehlenden Werten geführt, die mit <code>--</code> markiert sind. Die Funktion <code>np.loadtxt()</code> kann jedoch mit fehlenden Werten nicht umgehen und gibt eine Fehlermeldung zurück.</p>
<div id="ff08fd10" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_double_hyphen.csv'</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  daten_double_hypen <span class="op">=</span> np.loadtxt(dateipfad)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Daten mit fehlenden Werten '--':"</span>, daten_double_hypen, <span class="st">"dtype:"</span>, daten_double_hypen.dtype) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Die Eingabe führt zu der Fehlermeldung:
 could not convert string '--' to float64 at row 1, column 1.</code></pre>
</div>
</div>
<section id="die-funktion-np.genfromtxt" class="level4">
<h4 class="anchored" data-anchor-id="die-funktion-np.genfromtxt">Die Funktion np.genfromtxt()</h4>
<p>Um Datensätze mit fehlenden Werten einzulesen, wird die Funktion <code>np.genfromtxt(fname, delimiter = None, missing_values = None, filling_values = None)</code> verwendet. Dieses durchläuft den Datensatz <code>fname</code> in zwei Schleifen, weshalb die Funktion langsamer als <code>np.loadtxt()</code> ist. Die erste Schleife teilt den Datensatz zeilenweise am optional übergebenen Trennzeichen <code>delimiter</code> in eine Zeichenkette auf. Die zweite Schleife konvertiert jede Zeichenkette in den passenden Datentyp. Mit den optionalen Argumenten <code>missing_values</code> und <code>filling_values</code> können der Funktion Zeichenfolgen übergeben werden, mit der fehlende Werte markiert sind bzw. ersetzt werden sollen. (<a href="https://numpy.org/doc/stable/user/basics.io.genfromtxt.html">NumPy Dokumentation</a>)</p>
<div id="f45e35a1" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_double_hyphen.csv'</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>daten_double_hypen <span class="op">=</span> np.genfromtxt(dateipfad, missing_values <span class="op">=</span> <span class="st">'--'</span>, filling_values <span class="op">=</span> np.nan)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Daten mit fehlenden Werten '--':"</span>, daten_double_hypen)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_double_hypen.shape, <span class="st">"dtype:"</span>, daten_double_hypen.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Daten mit fehlenden Werten '--': [20.1  nan 20.1 ... 24.3 24.2 24.2]
Struktur: (1513,) dtype: float64</code></pre>
</div>
</div>
<p>Durch die Umwandlung fehlender Werte in <code>NaN</code>, sind Operationen mit gleichlangen NumPy-Arrays möglich.</p>
<div id="eeee685d" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>daten_differenz <span class="op">=</span> daten_ohne_fehlende_werte <span class="op">-</span> daten_double_hypen</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(daten_differenz)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0. nan  0. ...  0.  0.  0.]</code></pre>
</div>
</div>
<p>Die Funktion <code>np.genfromtxt()</code> kann beliebige Zeichenketten als fehlenden Wert verarbeiten. Lediglich leere Zellen können problematisch sein, da deren Inhalt <code>'\n'</code> als Zeilentrenner verarbeitet wird.</p>
<div id="nte-npgenfromtxt" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;2: Leere Zellen mit np.genfromtxt()
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Enthält eine Datei leere Zellen, können diese nicht eingelesen werden, da diese automatisch übersprungen werden.</p>
<div id="840e6a45" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datei ohne Markierung fehlender Werte</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_empty_lines.csv'</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>daten_empty_lines <span class="op">=</span> np.genfromtxt(dateipfad, missing_values <span class="op">=</span> <span class="st">''</span>, filling_values <span class="op">=</span> np.nan) </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Daten mit fehlenden Werten '':"</span>, daten_empty_lines)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_empty_lines.shape, <span class="st">"dtype:"</span>, daten_empty_lines.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Daten mit fehlenden Werten '': [20.1 20.1 20.1 ... 24.3 24.2 24.2]
Struktur: (1511,) dtype: float64</code></pre>
</div>
</div>
<p>Das Array ist zwei Elemente kürzer. Die Subtraktion von einem längeren NumPy-Array scheitert mit einer Fehlemeldung.</p>
<div id="6ead643f" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> daten_ohne_fehlende_werte <span class="op">-</span> daten_empty_lines</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(result)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Die Eingabe führt zu der Fehlermeldung:
 operands could not be broadcast together with shapes (1513,) (1511,) </code></pre>
</div>
</div>
<p>In diesem Fall muss auf die Stringbearbeitung aus der Python-Basis zurückgegriffen werden. Die bearbeitete Liste kann wie gewohnt mit <code>np.genfromtxt()</code> eingelesen werden.</p>
<div id="6c6c27d8" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Einlesen über Datenobjekt</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>datenobjekt_empty_lines <span class="op">=</span> <span class="bu">open</span>(dateipfad, <span class="st">'r'</span>, encoding <span class="op">=</span> <span class="st">'utf-8'</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>daten_empty_lines <span class="op">=</span> datenobjekt_empty_lines.readlines()</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>datenobjekt_empty_lines.close()</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Das ausgelesene Datenobjekt (Ausschnitt):</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines[<span class="dv">0</span>:<span class="dv">10</span>])</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Stringbearbeitung mit replace('\n', '')</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(daten_empty_lines)):</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> daten_empty_lines[i] <span class="op">==</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>:</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    daten_empty_lines[i] <span class="op">=</span> <span class="st">'platzhalter'</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>    daten_empty_lines[i] <span class="op">=</span> daten_empty_lines[i].replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">''</span>)</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Nach der Stringbearbeitung (Ausschnitt):</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines[<span class="dv">0</span>:<span class="dv">10</span>])</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Einlesen mit np.genfromtxt</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>daten_empty_lines <span class="op">=</span> np.genfromtxt(daten_empty_lines, missing_values <span class="op">=</span> <span class="st">'platzhalter'</span>, filling_values <span class="op">=</span> np.nan)</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Daten mit fehlenden Werten '':"</span>, daten_empty_lines)</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_empty_lines.shape, <span class="st">"dtype:"</span>, daten_empty_lines.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Das ausgelesene Datenobjekt (Ausschnitt):
 ['# Temperatur in C\n', '20.1\n', '\n', '20.1\n', '20.1\n', '20.1\n', '\n', '20.1\n', '20.1\n', '20.1\n']

Nach der Stringbearbeitung (Ausschnitt):
 ['# Temperatur in C', '20.1', 'platzhalter', '20.1', '20.1', '20.1', 'platzhalter', '20.1', '20.1', '20.1']

Daten mit fehlenden Werten '': [20.1  nan 20.1 ... 24.3 24.2 24.2]
Struktur: (1513,) dtype: float64</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Besonders bei Dateien mit mehreren Spalten führen leere Zellen schnell zu Fehlern. Hier ist es erforderlich, den Zeichentrenner mit dem Argument <code>delimiter</code> zu spezifizieren. Aus der Dokumentation:<br>
“When spaces are used as delimiters, or when no delimiter has been given as input, there should not be any missing data between two fields.” (<a href="https://numpy.org/doc/stable/reference/generated/numpy.genfromtxt.html">NumPy Dokumentation</a>)</p>
<div id="nte-npgenfromtxt" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;3: Leere Zellen in mehreren Spalten mit np.genfromtxt()
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ohne Spezifikation des Arguments <code>delimiter</code> wird nur eine Spalte eingelesen, die ausschließlich <code>np.nan</code> enthält.</p>
<div id="5882a98b" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ohne Spezifikation von delimiter</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_missing_values_multi_column.csv'</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>daten_empty_lines2 <span class="op">=</span> np.genfromtxt(dateipfad, missing_values <span class="op">=</span> <span class="st">''</span>, filling_values <span class="op">=</span> np.nan, ndmin <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_empty_lines2.shape, <span class="st">"dtype:"</span>, daten_empty_lines2.dtype)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Die ersten drei Zeilen:</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines2[<span class="dv">0</span>:<span class="dv">3</span>])</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Struktur: (1513, 1) dtype: float64
Die ersten drei Zeilen:
 [[nan]
 [nan]
 [nan]]</code></pre>
</div>
</div>
<p>Wird das Argument <code>delimiter = ','</code> übergeben, wird die Datei korrekt eingelesen.</p>
<div id="1e24f3ec" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mit Spezifikation von delimiter</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>daten_empty_lines2 <span class="op">=</span> np.genfromtxt(dateipfad, delimiter <span class="op">=</span> <span class="st">','</span>, missing_values <span class="op">=</span> <span class="st">''</span>, filling_values <span class="op">=</span> np.nan, ndmin <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Struktur:"</span>, daten_empty_lines2.shape, <span class="st">"dtype:"</span>, daten_empty_lines2.dtype)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Daten mit fehlenden Werten '':</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines2)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Struktur: (1513, 2) dtype: float64

Daten mit fehlenden Werten '':
 [[20.1 20.1]
 [ nan  nan]
 [20.1 20.1]
 ...
 [24.3 24.3]
 [24.2 24.2]
 [24.2 24.2]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fehlende-werte-in-numpy-erzeugen-prüfen-finden-ersetzen-löschen" class="level4">
<h4 class="anchored" data-anchor-id="fehlende-werte-in-numpy-erzeugen-prüfen-finden-ersetzen-löschen">Fehlende Werte in NumPy erzeugen, prüfen, finden, ersetzen, löschen</h4>
<p>Das Modul NumPy bietet Funktionen, um mit fehlenden Werten zu arbeiten.</p>
<ul>
<li><p><code>np.nan</code> erzeugt einen fehlenden Wert.</p></li>
<li><p><code>np.isnan()</code> prüft auf einen fehlenden Wert und gibt einen Wahrheitswert bzw. ein NumPy-Array mit dtype bool zurück.</p></li>
<li><p><code>np.nonzero(np.isnan(array))</code> gibt ein Tuple zurück, das ein Array mit den Indexpositionen der Elemente mit dem Wert ‘NaN’ enthält. Auf das Array kann mit <code>np.nonzero(np.isnan(array))[0]</code> zugegriffen werden. Je nach Situation kann die Umwandlung in eine Liste nützlich sein <code>np.nonzero(np.isnan(array))[0].tolist()</code>.<br>
Eine ähnliche Funktion ist <code>np.argwhere(np.isnan(array))</code>, deren Ausgabe aber nicht für das Slicing mehrdimensionaler Arrays geeignet ist (siehe folgendes Beispiel).</p></li>
</ul>
<div id="nte-npargwhere" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;4: Die Funktion np.argwhere()
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Eine andere Funktion, um die Indexposition eines Werts zu bestimmen, ist die Funktion <code>np.argwhere()</code>. Der Aufruf der Funktion <code>np.argwhere(np.isnan(array))</code> gibt ein NumPy-Array mit den Indexposition Elemente mit dem Wert <code>NaN</code> zurück.</p>
<div id="4dfcea4b" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.array([[<span class="dv">1</span>, np.nan, np.nan], [<span class="dv">4</span>, <span class="dv">5</span>, np.nan]])</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(array)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>np.argwhere(np.isnan(array))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[ 1. nan nan]
 [ 4.  5. nan]]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>array([[0, 1],
       [0, 2],
       [1, 2]], dtype=int64)</code></pre>
</div>
</div>
<p>Das mit <code>np.argwhere()</code> erzeugte Array ist aber nicht geeignet, um Arraybereiche auszuwählen.</p>
<div id="619bf2d2" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  array[np.argwhere(np.isnan(array))]</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">IndexError</span> <span class="im">as</span> error:</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(array[np.argwhere(np.isnan(array))]) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Die Eingabe führt zu der Fehlermeldung:
 index 2 is out of bounds for axis 0 with size 2</code></pre>
</div>
</div>
<p>Zum Vergleich mit <code>np.nonzero()</code></p>
<div id="85527fb5" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  array[np.nonzero(np.isnan(array))]</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">IndexError</span> <span class="im">as</span> error:</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(array[np.nonzero(np.isnan(array))]) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[nan nan nan]</code></pre>
</div>
</div>
<div id="wrn-npargwhere" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;5: Die Funktion np.arghwhere()
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Die Auswahl von Array-Bereichen mit <code>np.argwhere()</code> funktioniert für eindimensionale Arrays.</p>
<div id="ab5ed6f5" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>array <span class="op">=</span> np.array([<span class="dv">1</span>, np.nan, np.nan, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  array[np.argwhere(np.isnan(array))]</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">IndexError</span> <span class="im">as</span> error:</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(array[np.argwhere(np.isnan(array))]) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[nan]
 [nan]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<ul>
<li><code>nan_to_num(x = array, nan = 0.0)</code> ersetzt im Array x <code>NaN</code> durch den Wert 0.0 oder durch den im Argument <code>nan</code> übergebenen Wert. (Hinweis: <code>nan_to_num()</code> ersetzt standardmäßig auch <code>np.inf</code> durch große positive sowie <code>-np.inf</code> durch große negative Zahlen.)<br>
Die Ersetzung eines bestimmten Werts ist auch mit einem logischen Vektor möglich (siehe folgendes Beispiel).</li>
</ul>
<div id="nte-vectorslicing" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;5: Wertzuweisung mit logischem Vektor
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Die Ersetzung eines bestimmten Werts ist auch durch die Auswahl bestimmter Array-Bereiche durch einen logischen Vektor möglich.</p>
<div id="9a5b9f2c" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, np.nan, <span class="dv">5</span>, <span class="dv">6</span>, np.nan])</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.isnan(a)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>a[b] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[False False False  True False False  True]
[1. 2. 3. 0. 5. 6. 0.]</code></pre>
</div>
</div>
<p>Dabei können mehrere Bedingungen mit der Funktion <code>np.logical_or(x1, x2)</code> als logisches ODER kombiniert werden.</p>
<div id="bcdff381" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, np.nan, <span class="dv">5</span>, <span class="dv">6</span>, np.nan])</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>bedingung1 <span class="op">=</span> np.isnan(a)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>bedingung2 <span class="op">=</span> a <span class="op">&gt;=</span> <span class="dv">5</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>bedingung <span class="op">=</span> np.logical_or(bedingung1, bedingung2)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>a[bedingung] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1. 2. 3. 0. 0. 0. 0.]</code></pre>
</div>
</div>
<p>Auch ein logisches UND ist möglich (aber in Verbindung mit np.NaN nicht sinnvoll). Der Operator * bewirkt das gleiche wie der logische Operator <code>and</code> oder die Funktion <code>np.logical_and(x1, x2)</code>.</p>
<div id="c48e2e2f" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, np.nan, <span class="dv">5</span>, <span class="dv">6</span>, np.nan])</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>bedingung1 <span class="op">=</span> a <span class="op">&lt;</span> <span class="dv">4</span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>bedingung2 <span class="op">=</span> a <span class="op">&gt;=</span> <span class="dv">1</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>bedingung <span class="op">=</span> bedingung1 <span class="op">*</span> bedingung2</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>a[bedingung] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(a)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0.  0.  0. nan  5.  6. nan]</code></pre>
</div>
</div>
</div>
</div>
</div>
<ul>
<li><code>np.delete(arr = array, obj)</code> gibt ein neues (kürzeres) Array ohne die im Parameter obj spezifizierten Array-Bereiche zurück. Alle Elemente mit dem Wert <code>NaN</code> werden so gelöscht: <code>np.delete(array, obj = np.nonzero(np.isnan(array)))</code></li>
</ul>
<p>NumPy wandelt <code>None</code> nicht automatisch in <code>NaN</code> um. NumPy kann den Datentyp des Objekts deshalb nicht bestimmen und gibt <code>dtype=object</code> aus:</p>
<div id="08d80a2f" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>np_array_with_none <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>, <span class="dv">4</span>])</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_array_with_none, np_array_with_none.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1 2 None 4] object</code></pre>
</div>
</div>
<p><strong>Aufgabe: Wie kann im Array np_array_with_none <code>None</code> durch <code>np.nan</code> ersetzt werden?</strong></p>
<div id="tip-numpynone" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;20: Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Eine logische Abfrage von <code>None</code> ist möglich. Auf diese Weise kann ein logisches Array erzeugt werden, das zur Auswahl der Indexpositionen verwendet wird, deren Werte ersetzt werden sollen.</p>
<div id="ad7e6399" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>np_array_with_none <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>, <span class="dv">4</span>])</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_array_with_none)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>np_array_with_nan <span class="op">=</span> np_array_with_none.copy()</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Array mit logischer Abfrage von None:</span><span class="ch">\n</span><span class="sc">{</span>np_array_with_none <span class="op">==</span> <span class="va">None</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>np_array_with_nan[np_array_with_none <span class="op">==</span> <span class="va">None</span>] <span class="op">=</span> np.nan</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Array mit None ersetzt durch NaN:</span><span class="ch">\n</span><span class="sc">{</span>np_array_with_nan<span class="sc">,</span> np_array_with_nan<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1 2 None 4]

Array mit logischer Abfrage von None:
[False False  True False]

Array mit None ersetzt durch NaN:
(array([1, 2, nan, 4], dtype=object), dtype('O'))</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="operationen-mit-fehlenden-werten" class="level4">
<h4 class="anchored" data-anchor-id="operationen-mit-fehlenden-werten">Operationen mit fehlenden Werten</h4>
<p>Operationen mit <code>NaN</code> ergeben immer <code>NaN</code>. Deshalb gibt es in NumPy viele Funktionen, die <code>NaN</code> automatisch ignorieren bzw. durch einen geeigneten Wert ersetzen. Diese sind bereits am Funktionsnamen erkennbar. Beispielsweise liefern <code>np.nansum()</code> und <code>np.nancumsum()</code> die Summe bzw. die kumulierte Summe eines Arrays. In der kumulierten Summe werden <code>NaN</code> durch das laufende Ergebnis ersetzt. Eine vollständige Liste der NumPy-Funktionen finden Sie in der <a href="https://numpy.org/doc/stable/reference/routines.html">Dokumentation</a>.</p>
<div id="779c134c" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Array mit NaN:</span><span class="ch">\n</span><span class="sc">{</span>np_array_with_nan<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Summe des Arrays:</span><span class="ch">\n</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(np_array_with_nan)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NaN-Summe des Arrays:</span><span class="ch">\n</span><span class="sc">{</span>np<span class="sc">.</span>nansum(np_array_with_nan)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"kumulierte Summe des Arrays:</span><span class="ch">\n</span><span class="sc">{</span>np<span class="sc">.</span>cumsum(np_array_with_nan)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"kumulierte NaN-Summe des Arrays:</span><span class="ch">\n</span><span class="sc">{</span>np<span class="sc">.</span>nancumsum(np_array_with_nan)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Array mit NaN:
[1 2 nan 4]

Summe des Arrays:
nan

NaN-Summe des Arrays:
7

kumulierte Summe des Arrays:
[1 3 nan nan]

kumulierte NaN-Summe des Arrays:
[1 3 3 7]
</code></pre>
</div>
</div>
</section>
</section>
<section id="pandas-2" class="level3">
<h3 class="anchored" data-anchor-id="pandas-2">Pandas</h3>
<p>Die Pandas-Funktionen zum Lesen von Dateien können mit fehlenden Werten umgehen. Standardmäßig werden folgende Werte als fehlende Werte erkannt:<br>
<code>['-1.#IND', '1.#QNAN', '1.#IND', '-1.#QNAN', '#N/A N/A', '#N/A', 'N/A', 'n/a', 'NA', '&lt;NA&gt;', '#NA', 'NULL', 'null', 'NaN', '-NaN', 'nan', '-nan', 'None', '']</code></p>
<p>Weitere Werte können mit dem Argument <code>na_values = []</code> als fehlende Werte definiert werden. Mit dem Argument <code>keep_default_na = False</code> kann festgelegt werden, dass ausschließlich die in <code>na_values = []</code> übergebenen Werte als fehlende Werte interpretiert werden sollen. Standardmäßig werden mit dem Argument <code>na_filter = True</code> auch leere Zellen als NA eingelesen. Vollständig leere Zeilen werden jedoch standardmäßig übersprungen. Dies kann mit dem Argument <code>skip_blank_lines = False</code> geändert werden. (<a href="https://pandas.pydata.org/docs/user_guide/io.html#io-navaluesconst">Pandas Dokumentation</a>)</p>
<p>Fehlende Werte können mit dem Argument <code>na_values = []</code> spezifiziert werden.</p>
<div id="64d89339" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_double_hyphen.csv'</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  daten_double_hypen <span class="op">=</span> pd.read_csv(dateipfad, na_values <span class="op">=</span> [<span class="st">'--'</span>])</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Daten mit fehlenden Werten '--':</span><span class="ch">\n</span><span class="st">"</span>, daten_double_hypen, daten_double_hypen.shape) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daten mit fehlenden Werten '--':
       # Temperatur in C
0                  20.1
1                   NaN
2                  20.1
3                  20.1
4                  20.1
...                 ...
1508               24.3
1509               24.3
1510               24.3
1511               24.2
1512               24.2

[1513 rows x 1 columns] (1513, 1)</code></pre>
</div>
</div>
<p>Mit dem Argument <code>skip_blank_lines = False</code> werden leere Zeilen ebenfalls eingelesen.</p>
<div id="d8f8e8c6" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_empty_lines.csv'</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  daten_empty_lines <span class="op">=</span> pd.read_csv(dateipfad, skip_blank_lines <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Daten mit fehlenden Werten '':</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines, daten_empty_lines.shape) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daten mit fehlenden Werten '':
       # Temperatur in C
0                  20.1
1                   NaN
2                  20.1
3                  20.1
4                  20.1
...                 ...
1508               24.3
1509               24.3
1510               24.3
1511               24.2
1512               24.2

[1513 rows x 1 columns] (1513, 1)</code></pre>
</div>
</div>
<p>Pandas verwendet abhängig vom Datentyp verschiedene Werte zur Kennzeichnung fehlender Werte.</p>
<ul>
<li><p><code>numpy.nan</code> für NumPy-Datentypen. Hierbei wird der Datentyp automatisch in <code>np.float64</code> oder <code>object</code> konvertiert.</p></li>
<li><p><code>pd.NA</code> für Zeichenketten und Ganzzahlen. Der Datentyp bleibt erhalten.</p></li>
</ul>
<p>Einlesen der Datei TC01_empty_lines.csv als string:</p>
<div id="09125180" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'skript/01-daten/TC01_empty_lines.csv'</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  daten_empty_lines <span class="op">=</span> pd.read_csv(dateipfad, skip_blank_lines <span class="op">=</span> <span class="va">False</span>, dtype <span class="op">=</span> <span class="st">'string'</span>)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Daten mit fehlenden Werten '':</span><span class="ch">\n</span><span class="st">"</span>, daten_empty_lines, daten_empty_lines.shape) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daten mit fehlenden Werten '':
      # Temperatur in C
0                 20.1
1                 &lt;NA&gt;
2                 20.1
3                 20.1
4                 20.1
...                ...
1508              24.3
1509              24.3
1510              24.3
1511              24.2
1512              24.2

[1513 rows x 1 columns] (1513, 1)</code></pre>
</div>
</div>
<p><code>NA</code> kann zwar auch als fehlender Wert für Gleitkommazahlen und andere NumPy Datentypen verwendet werden. Allerdings wird dafür ein Pandas-Datentyp benötigt (siehe das folgende Beispiel).</p>
<div id="nte-pdNA" class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beispiel&nbsp;6: pd.Series mit np.nan und pd.NA
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Eine pd.Series mit <code>np.nan</code> wird automatisch in <code>dtype: float64</code> umgewandelt:</p>
<div id="196685a4" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, np.nan])</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1.0
1    2.0
2    NaN
dtype: float64</code></pre>
</div>
</div>
<p>Eine pd.Series mit <code>pd.NA</code> wird als <code>dtype: object</code> eingelesen:</p>
<div id="28d501bb" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, pd.NA])</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0       1
1       2
2    &lt;NA&gt;
dtype: object</code></pre>
</div>
</div>
<p>Der <code>dtype</code> kann für eine Series mit <code>pd.NA</code> festgelegt werden:</p>
<div id="257231d5" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, pd.NA], dtype <span class="op">=</span> <span class="st">'Int32'</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0       1
1       2
2    &lt;NA&gt;
dtype: Int32</code></pre>
</div>
</div>
<p>Abhängig vom Datentyp kommt es auf den korrekten <code>dtype</code> (NumPy oder Pandas) an, erkennbar an der Groß- und Kleinschreibung. <code>pd.NA</code> mit Numpy-Fließkommazahl:</p>
<div id="cc2ca153" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, pd.NA], dtype <span class="op">=</span> <span class="st">'float64'</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Die Eingabe führt zu der Fehlermeldung:
 float() argument must be a string or a real number, not 'NAType'</code></pre>
</div>
</div>
<p><code>pd.NA</code> mit Pandas-Fließkommazahl:</p>
<div id="030c1cad" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, pd.NA], dtype <span class="op">=</span> <span class="st">'Float64'</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0     1.0
1     2.0
2    &lt;NA&gt;
dtype: Float64</code></pre>
</div>
</div>
<p><code>np.nan</code> mit Numpy-Fließkommazahl:</p>
<div id="b24ee376" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, np.nan], dtype <span class="op">=</span> <span class="st">'float64'</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    1.0
1    2.0
2    NaN
dtype: float64</code></pre>
</div>
</div>
<p><code>np.nan</code> mit Pandas-Fließkommazahl:</p>
<div id="02cb89e1" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  test <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, np.nan], dtype <span class="op">=</span> <span class="st">'Float64'</span>)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(test) </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0     1.0
1     2.0
2    &lt;NA&gt;
dtype: Float64</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<div id="wrn-logicpandas" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;6: Achtung Logik!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Die logische Abfrage fehlender Werte unterscheidet sich für <code>None</code>, <code>np.nan</code> und <code>pd.NA</code>.</p>
<div id="0bc98a8c" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>bool_values <span class="op">=</span> [<span class="va">None</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), pd.NA]</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    bool_value <span class="op">=</span> <span class="bu">bool</span>(element)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(error)</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Wahrheitswert von"</span>, element, <span class="st">"ist"</span>, bool_value)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wahrheitswert von None ist False
Wahrheitswert von nan ist True
boolean value of NA is ambiguous</code></pre>
</div>
</div>
<p>Dies gilt auch für die logische Identität.</p>
<div id="80838be8" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>bool_values <span class="op">=</span> [<span class="va">None</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), pd.NA]</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> element <span class="op">==</span> element</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(error)</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Identität von"</span>, element, <span class="st">"ist"</span>, result)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Identität von None ist True
Identität von nan ist False
Identität von &lt;NA&gt; ist &lt;NA&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>(<a href="https://pandas.pydata.org/docs/user_guide/missing_data.html">Pandas Dokumentation</a>)</p>
<section id="fehlende-werte-in-pandas-erzeugen-prüfen-finden-ersetzen-löschen" class="level4">
<h4 class="anchored" data-anchor-id="fehlende-werte-in-pandas-erzeugen-prüfen-finden-ersetzen-löschen">Fehlende Werte in Pandas erzeugen, prüfen, finden, ersetzen, löschen</h4>
<p>Das Modul Pandas wandelt <code>None</code> automatisch in <code>NaN</code> um. Das Modul Pandas bietet wie das Modul NumPy verschiedene Funktionen, um mit fehlenden Werten zu arbeiten.</p>
<ul>
<li><p><code>pd.NA</code> erzeugt einen fehlenden Wert (Groß- und Kleinschreibung beachten: <code>pd.na</code> funktioniert nicht)</p></li>
<li><p>Die Funktionen <code>pd.isnull()</code> und <code>pd.isna()</code> prüfen auf einen fehlenden Wert und geben einen Wahrheitswert bzw. ein NumPy-Array mit dtype bool zurück. Die Funktionen <code>pd.notna()</code> und <code>pd.notnull()</code> prüfen den umgekehrten Fall.</p></li>
<li><p>Die Methode <code>pd.isna().nonzero()</code> verwendet die NumPy-Funktion <code>np.nonzero</code> und gibt ein Array mit den Indexpositionen der Elemente mit fehlenden Werten zurück.</p></li>
<li><p><code>pd.Series.fillna(value = 0)</code> ersetzt fehlende Werte mit dem im Argument <code>value</code> übergebenen Wert. Die Methoden <code>pd.ffill()</code> und <code>pd.bfill()</code> ersetzen fehlende Werte mit dem letzten bzw. dem nächsten gültigen Wert. Die Methode <code>pd.Series.interpolate()</code> ersetzt fehlende Werte durch Interpolation, wofür ein Datentyp definiert sein muss (<code>dtype = object</code> funktioniert nicht). Standardmäßig wird linear interpoliert, es stehen aber verschiedene Methoden zur Verfügung (siehe <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.interpolate.html">Pandas Dokumentation</a>)</p></li>
<li><p>Die Methode <code>pd.Series.dropna()</code> gibt eine neue (kürzere) Series ohne fehlende Wert zurück.</p></li>
</ul>
</section>
<section id="operationen-mit-fehlenden-werten-1" class="level4">
<h4 class="anchored" data-anchor-id="operationen-mit-fehlenden-werten-1">Operationen mit fehlenden Werten</h4>
<p>Operationen mit <code>pd.NA</code> ergeben in der Regel <code>pd.NA</code>. Es gibt jedoch einige Ausnahmen:</p>
<div id="0e36b680" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.NA <span class="op">**</span> <span class="dv">0</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">1</span> <span class="op">**</span> pd.NA)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1
1</code></pre>
</div>
</div>
<p>Die Methode <code>pd.Series.sum()</code> behandelt <code>pd.NA</code> als 0, die Methode <code>pd.Series.prod()</code> als 1.</p>
<div id="677bcce9" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).<span class="bu">sum</span>())</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).prod())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
1</code></pre>
</div>
</div>
<p>Reduzierende Methoden wie <code>pd.Series.min()</code> oder <code>pd.Series.mean()</code> sowie zusammenfassende Methoden wie <code>pd.Series.cumsum()</code> oder <code>pd.Series.cumprod()</code> überspringen <code>pd.NA</code>.</p>
<div id="a4827966" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).<span class="bu">min</span>())</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).mean())</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).cumsum())</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Series([pd.NA]).cumprod())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>nan
nan
0    NaN
dtype: object
0    NaN
dtype: object</code></pre>
</div>
</div>
<p>Das Verhalten von Methoden wie <code>pd.Series.sum()</code> und von Methoden wie <code>pd.Series.min()</code> hat für Datenreihen einen vergleichbaren Effekt, produziert für einzelne Werte jedoch unterschiedliche Ergebnisse.</p>
<p>eventuell ergänzen: <strong>Cumulative methods like cumsum() and cumprod() ignore NA values by default preserve them in the result. This behavior can be changed with skipna</strong> (<a href="https://pandas.pydata.org/docs/user_guide/missing_data.html" class="uri">https://pandas.pydata.org/docs/user_guide/missing_data.html</a>)</p>
</section>
</section>
<section id="aufgabe-fehlende-werte" class="level3">
<h3 class="anchored" data-anchor-id="aufgabe-fehlende-werte">Aufgabe fehlende Werte</h3>
<p>Der Deutsche Wetterdienst misst deutschlandweit verschiedene Wetterdaten. In der Datei ‘produkt_st_stunde_20230831_20240630_01303.txt’ sind stündliche Stationsmessungen der Solarstrahlung in Essen-Bredeney gespeichert.</p>
<table class="table">
<thead>
<tr class="header">
<th>Spaltenname</th>
<th>Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STATIONS_ID</td>
<td>Stationsnummer</td>
</tr>
<tr class="even">
<td>QN_592</td>
<td>Qualitätsniveau der Daten</td>
</tr>
<tr class="odd">
<td>ATMO_LBERG</td>
<td>Stundensumme der atmosphärischen Gegenstrahlung</td>
</tr>
<tr class="even">
<td>FD_LBERG</td>
<td>Stundensumme der diffusen solaren Strahlung</td>
</tr>
<tr class="odd">
<td>FG_LBERG</td>
<td>Stundensumme der Globalstrahlung</td>
</tr>
<tr class="even">
<td>SD_LBERG</td>
<td>Stundensumme der Sonnenscheindauer</td>
</tr>
<tr class="odd">
<td>ZENIT</td>
<td>Zenitwinkel der Sonne 0 - 180 Grad</td>
</tr>
</tbody>
</table>
<div class="border">
<p>Deutscher Wetterdienst. 2024. Stündliche Stationsmessung der Solarstrahlung (global/diffus) und der atmosphärischen Gegenstrahlung für Deutschland. <a href="https://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/hourly/solar/stundenwerte_ST_01303_row.zip" class="uri">https://opendata.dwd.de/climate_environment/CDC/observations_germany/climate/hourly/solar/stundenwerte_ST_01303_row.zip</a> Die Spalten MESS_DATUM, MESS_DATUM_WOZ und eor wurden entfernt.</p>
</div>
<p>&nbsp;</p>
<p><strong>Bestimmen Sie die Kodierung fehlender Werte und ersetzen Sie diese durch <code>np.nan</code> bzw. <code>pd.NA</code>. Wie viele Werte wurden ersetzt?</strong></p>
<div id="tip-musterlösungfehlendewerte" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;21: Musterlösung fehlende Werte
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Mit der Methode <code>df.info()</code> ist erkennbar, dass der Datensatz vollständig ist.</p>
<div id="d7a0becf" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"aufgaben/01-daten/produkt_st_stunde_20230831_20240630_01303.txt"</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> pd.read_csv(dateipfad, sep <span class="op">=</span> <span class="st">";"</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>solar.info()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7296 entries, 0 to 7295
Data columns (total 7 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   STATIONS_ID  7296 non-null   int64  
 1   QN_592       7296 non-null   int64  
 2   ATMO_LBERG   7296 non-null   float64
 3   FD_LBERG     7296 non-null   float64
 4   FG_LBERG     7296 non-null   float64
 5   SD_LBERG     7296 non-null   int64  
 6   ZENIT        7296 non-null   float64
dtypes: float64(4), int64(3)
memory usage: 399.1 KB</code></pre>
</div>
</div>
<p>Mit der Methode <code>df.describe()</code> wird die deskriptive Statistik für numerische Spalten erstellt.</p>
<div id="eedd530b" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>solar.describe()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">STATIONS_ID</th>
<th data-quarto-table-cell-role="th">QN_592</th>
<th data-quarto-table-cell-role="th">ATMO_LBERG</th>
<th data-quarto-table-cell-role="th">FD_LBERG</th>
<th data-quarto-table-cell-role="th">FG_LBERG</th>
<th data-quarto-table-cell-role="th">SD_LBERG</th>
<th data-quarto-table-cell-role="th">ZENIT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7296.0</td>
<td>7296.0</td>
<td>7296.00</td>
<td>7296.00</td>
<td>7296.00</td>
<td>7296.00</td>
<td>7296.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1303.0</td>
<td>1.0</td>
<td>111.80</td>
<td>-31.23</td>
<td>-16.46</td>
<td>9.00</td>
<td>92.65</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.0</td>
<td>0.0</td>
<td>89.42</td>
<td>222.34</td>
<td>229.74</td>
<td>18.66</td>
<td>30.02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1303.0</td>
<td>1.0</td>
<td>-999.00</td>
<td>-999.00</td>
<td>-999.00</td>
<td>0.00</td>
<td>28.56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>1303.0</td>
<td>1.0</td>
<td>112.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>70.61</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1303.0</td>
<td>1.0</td>
<td>121.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>92.40</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1303.0</td>
<td>1.0</td>
<td>127.25</td>
<td>25.00</td>
<td>33.00</td>
<td>3.00</td>
<td>115.97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1303.0</td>
<td>1.0</td>
<td>150.00</td>
<td>182.00</td>
<td>348.00</td>
<td>60.00</td>
<td>151.44</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Drei Spalten weisen als minimalen Wert -999 auf, der inhaltlich nicht sinnvoll ist. Wie oft kommt der Wert -999 in den Spalten vor?</p>
<div id="9b05c5b7" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>counting_df <span class="op">=</span> solar[[<span class="st">'ATMO_LBERG'</span>, <span class="st">'FD_LBERG'</span>, <span class="st">'FG_LBERG'</span>]] <span class="op">==</span> <span class="op">-</span><span class="dv">999</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(counting_df.<span class="bu">sum</span>())</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Summe:</span><span class="ch">\t\t</span><span class="st"> "</span>, counting_df.<span class="bu">sum</span>().<span class="bu">sum</span>())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ATMO_LBERG     46
FD_LBERG      359
FG_LBERG      353
dtype: int64
Summe:        758</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-zeitreihen" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Zeitreihen</h1>
<!-- ###### INCLUDE ###### -->
<!-- ###### INCLUDE ###### -->
<!-- ###### INCLUDE ###### -->
<!-- ###### INCLUDE ###### -->
<p><strong>folgende Teilkapitel werden in den w-Python ausgelagert: Datums- und Zeitinformationen in Python, Alles ist relativ: die Epoche, Naive und bewusste Datetime-Objekte, Zeit, Zeitzonen, Kalender</strong><br>
<strong>Die Einführung in <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#overview">grundlegende Zeittypen</a> sollte in w-Pandas erfolgen.</strong></p>
<section id="datums--und-zeitinformationen-in-python" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="datums--und-zeitinformationen-in-python"><span class="header-section-number">6.1</span> Datums- und Zeitinformationen in Python</h2>
<p>Die Verarbeitung von Datums- und Zeitinformationen wird in Python durch verschiedene Module ermöglicht. Im Folgenden wird die Arbeit mit Zeitreihen mit den Modulen NumPy und Pandas weiter ausgeführt. Dennoch sollten Sie die hier aufgezählten Module kennen, da in der Dokumentation gelegentlich auf diese verwiesen wird.</p>
<ul>
<li><p>Das Modul time stellt Zeit- und Datumsoperationen mit Objekten vom Typ <code>struct_time</code> bereit. (<a href="https://docs.python.org/3/library/time.html">Dokumentation des Moduls time</a>)</p>
<ul>
<li><p>Das Modul datetime führt die Datentypen <code>datetime</code> und <code>timedelta</code>, zusätzliche Methoden für die Bearbeitung und die Ausgabe von Datums- und Zeitinformationen ein. Das Modul kann Jahreszahlen von 1 bis 9999 nach unserer Zeitrechnung im Gregorianischen Kalender verarbeiten. (<a href="https://docs.python.org/3/library/datetime.html#">Dokumentation des Moduls datetime</a>)</p></li>
<li><p>Das Modul calendar führt verschiedene Kalenderfunktionen ein und erweitert den verarbeitbaren Zeitraum. Basierend auf dem Gregorianischen Kalender reicht dieser in beide Richtungen ins Unendliche. (<a href="https://docs.python.org/3/library/calendar.html#module-calendar">Dokumentation des Moduls calendar</a>)</p></li>
<li><p>Das Modul pytz führt die IANA-Zeitzonendatenbank (Internet Assigned Numbers Authority) für Anwendungsprogramme und Betriebssysteme ein (auch Olsen-Datenbank genannt). Die IANA-Datenbank beinhaltet die Zeitzonen und Änderungen der Zeit seit 1970. (<a href="https://de.wikipedia.org/wiki/Zeitzonen-Datenbank">Wikipedia</a>) Das Modul pytz sorgt für eine korrekte Berechnung von Zeiten zum Ende der Zeitumstellung (Ende Sommerzeit) über Zeitzonen hinweg. (<a href="https://pythonhosted.org/pytz/">Dokumentation pytz</a>) <strong>Hinweis für mich: This library differs from the documented Python API for tzinfo implementations.</strong></p></li>
</ul></li>
<li><p>NumPy führt die Datentypen <code>datetime64</code> und <code>timedelta64</code> ein. Diese basieren auf dem Gregorianischen Kalender und reichen in beide Richtungen ins Unendliche. <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html" class="uri">https://numpy.org/doc/stable/reference/arrays.datetime.html</a></p></li>
<li><p>Pandas nutzt die NumPy-Datentypen <code>datetime64</code> und <code>timedelta64</code> und ergänzt zahlreiche Funktionen zur Verarbeitung von Datums- und Zeitinformationen aus anderen Paketen. <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html" class="uri">https://pandas.pydata.org/docs/user_guide/timeseries.html</a></p></li>
</ul>
<p>NumPy und Pandas können Datetime-Objekte anderer Module in <code>datetime64</code> umwandeln.</p>
<section id="alles-ist-relativ-die-epoche" class="level3">
<h3 class="anchored" data-anchor-id="alles-ist-relativ-die-epoche">Alles ist relativ: die Epoche</h3>
<p>Python speichert Zeit relativ zu einem zeitlichen Bezugspunkt, der Unix-Zeit, der sogenannten Epoche. Die Epoche kann wie folgt mit den verschiedenen Modulen ausgegeben werden.</p>
<div id="1e74653d" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time <span class="im">as</span> time</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(time.gmtime(<span class="dv">0</span>))</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="co"># datetime</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> datetime</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"datetime:"</span>, datetime.datetime.fromtimestamp(<span class="dv">0</span>))</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NumPy</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NumPy:"</span>, np.datetime64(<span class="dv">0</span>, <span class="st">'s'</span>))</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pandas:"</span>, pd.to_datetime(<span class="dv">0</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>time.struct_time(tm_year=1970, tm_mon=1, tm_mday=1, tm_hour=0, tm_min=0, tm_sec=0, tm_wday=3, tm_yday=1, tm_isdst=0)
datetime: 1970-01-01 01:00:00
NumPy: 1970-01-01T00:00:00
Pandas: 1970-01-01 00:00:00</code></pre>
</div>
</div>
<p><strong>Was fällt Ihnen in der Ausgabe von Datum und Zeit der Epoche auf?</strong><br>
(<em>Hinweis: <code>tm_isdst=0</code> gibt an, ob daylight saving time, also Sommerzeit, ist.</em>)</p>
<div id="tip-aware" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;22: Lösung Epoche
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Das Modul datetime verwendet die Zeitzone Ihres Computers und gibt deshalb den Zeitpunkt der Epoche zur ersten Stunde des Tages zurück (wenn auf Ihrem System die zentraleuropäische Zeit UTC+1 eingestellt ist). Um den gleichen Rückgabewert wie für die anderen Module zu erhalten, muss die Zeitzone angegeben werden.</p>
<div id="ba2f3e83" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.fromtimestamp(<span class="dv">0</span>))</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.fromtimestamp(<span class="dv">0</span>, tz <span class="op">=</span> datetime.timezone.utc))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1970-01-01 01:00:00
1970-01-01 00:00:00+00:00</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="naive-und-bewusste-datetime-objekte" class="level3">
<h3 class="anchored" data-anchor-id="naive-und-bewusste-datetime-objekte">Naive und bewusste Datetime-Objekte</h3>
<p>Datetime-Objekte werden abhängig davon, ob sie Informationen über Zeitzonen enthalten, als naiv (naive) oder als bewusst (aware) bezeichnet. Naiven Datetime-Objekten fehlt diese Information, bewusste Datetime-Objekte enthalten diese. Objekte der Module time, datetime und Pandas verfügen über ein Zeitzonenattribut, sind also bewusst. <code>np.datetime64</code> ist seit NumPy-Version 1.11.0 ein naiver Datentyp, unterstützt aber Zeitzonen aus Gründen der Rückwärtskompatibilität.</p>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Deprecated since version 1.11.0: NumPy does not store timezone information. For backwards compatibility, datetime64 still parses timezone offsets, which it handles by converting to UTC±00:00 (Zulu time). This behaviour is deprecated and will raise an error in the future.” <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">NumPy Dokumentation</a></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<div id="wrn-datetimetimezones" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;7: Zeitzonen mit dem Modul datetime
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Das Modul datetime unterstützt die Spezifikation von anderen Zeitzonen nicht (sondern nutzt die Angabe einer Zeitdifferenz, timedelta). Um eine andere Zeitzone anzugeben, wird das Modul pytz benötigt. Dabei gilt es, eine Besonderheit zu beachten.</p>
<div id="46dc62f7" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytz</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>moscow_tz <span class="op">=</span> pytz.timezone(<span class="st">'Europe/Moscow'</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.now(moscow_tz))</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Vorsicht mit der Zeitzonenangabe via Etc/UTC</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Der korrekte Zeitzonenversatz (zur Winterzeit)</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>moscow_tz <span class="op">=</span> pytz.timezone(<span class="st">'Etc/GMT+3'</span>)</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.now(moscow_tz))</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeitzonenversatz mit invertiertem Vorzeichen</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>moscow_tz <span class="op">=</span> pytz.timezone(<span class="st">'Etc/GMT-3'</span>)</span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(datetime.datetime.now(moscow_tz))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2024-11-13 19:45:58.094818+03:00
2024-11-13 13:45:58.094818-03:00
2024-11-13 19:45:58.094818+03:00</code></pre>
</div>
</div>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Das Spezialgebiet ‘Etc’ wird für einige administrative Zonen verwendet, insbesondere für ‘Etc/UTC’, die koordinierte Weltzeit. Für die Kompatibilität mit dem POSIX-Format haben die Zonen, welche mit ‘Etc/GMT’ beginnen, genau das gegenteilige Vorzeichen als man erwarten würde. In diesem Format haben alle Zonen westlich der GMT ein positives Vorzeichen und alle östlich davon ein negatives.” (<a href="https://de.wikipedia.org/wiki/Zeitzonen-Datenbank">Wikipedia</a>)</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<p>Alle verfügbaren Zeitzonen können Sie sich wie folgt ausgeben lassen (hier ohne Ausgabe).</p>
<div id="a8c17779" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zoneinfo <span class="im">import</span> available_timezones</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> timezone <span class="kw">in</span> <span class="bu">sorted</span>(available_timezones()):</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(timezone)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="zeit" class="level3">
<h3 class="anchored" data-anchor-id="zeit">Zeit</h3>
<p>NumPy nutzt die Internationale Atomzeit (abgekürzt TAI für französisch Temps Atomique International). Diese nimmt für jeden Kalendertag eine Länge von 86.400 Sekunden an, kennt also keine Schaltsekunde. Die Atomzeit bildet die Grundlage für die koordinierte Weltzeit UTC. UTC steht für Coordinated Universal Time (auch bekannt als Greenwich Mean Time). Das Kürzel UTC ist ein Kompromiss für die englische und die französische Sprache. Die koordinierte Weltzeit gleicht die Verlangsamung der Erdrotation (astronomisch gemessen als Universalzeit, Universal Time UT) durch Schaltsekunden aus, um die geringfügige Verlängerung eines Tages auzugleichen. Die TAI geht deshalb gegenüber der UTC vor. Seit 1972 unterscheiden sich beide Zeiten um eine ganzzahlige Anzahl von Sekunden. Aktuell (2024) geht die TAI 37 Sekunden gegenüber UTC vor. Eine Umwandlung in die koordinierte Weltzeit ist in NumPy bislang noch nicht umgesetzt. (<a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">Dokumentation NumPy</a>, <a href="https://de.wikipedia.org/wiki/Internationale_Atomzeit">Wikipedia</a>) (<strong>wie ist das in Pandas?! Der Absatz ist fast wörtlich übernommen.</strong>)</p>
<section id="zeitzonen" class="level4">
<h4 class="anchored" data-anchor-id="zeitzonen">Zeitzonen</h4>
<p><strong>ergänzen</strong> <a href="https://de.wikipedia.org/wiki/Zeitzone" class="uri">https://de.wikipedia.org/wiki/Zeitzone</a></p>
<p><strong>Können wir die mit Pandas plotten?</strong></p>
</section>
<section id="dailight-saving-time" class="level4">
<h4 class="anchored" data-anchor-id="dailight-saving-time">Dailight Saving Time</h4>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“DST is Daylight Saving Time, an adjustment of the timezone by (usually) one hour during part of the year. DST rules are magic (determined by local law) and can change from year to year. The C library has a table containing the local rules (often it is read from a system file for flexibility) and is the only source of True Wisdom in this respect.” (<a href="https://docs.python.org/3/library/time.html">Dokumentation time</a>)</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<p><strong>Können wir die Länder mit Zeitumstellung mit Pandas plotten?</strong></p>
</section>
</section>
<section id="kalender" class="level3">
<h3 class="anchored" data-anchor-id="kalender">Kalender</h3>
<p><strong>to do</strong></p>
<p>Die Module calendar, NumPy und Pandas verwenden den um die Zeit vor seiner Einführung 1582 erweiterten Gregorianische Kalender, den <a href="https://en.wikipedia.org/wiki/Proleptic_Gregorian_calendar">proleptischen Gregorianischer Kalender</a>. Während das Modul date nur die Jahre 1-9999 nach unserer Zeit unterstützt, erlaubt der Datentyp <code>datetime64</code> auch Jahre vor unserer Zeit in <a href="https://en.wikipedia.org/wiki/Astronomical_year_numbering">astronomischer Jahresnumerierung</a>. Das bedeutet, es gibt ein Jahr 0 (das erste Jahr vor unserer Zeit) und vorausgehende Jahre werden mit negativen Zahlen dargestellt (-1 ist das zweite Jahr vor unserer Zeit). [NumPy Dokumentation] (https://numpy.org/doc/stable/reference/arrays.datetime.html#datetime64-conventions-and-assumptions)</p>
<ul>
<li><p>Schaltjahre <strong>im w-Python kleines Programm schreiben lassen, dass auf Schaltjahre prüft</strong></p></li>
<li><p>Welche wichtigen Kalender gibt es (jüdischen Kalender, muslimischen Kalender, chinesischen Kalender)</p>
<ul>
<li>Mögliche Aufgabe: Kalender hin und her konvertieren, falls das relevant ist (in der Diss hatte ich den thailändischen (?!) Kalender)</li>
</ul></li>
</ul>
</section>
</section>
<section id="datum-und-zeit-in-numpy-und-pandas" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="datum-und-zeit-in-numpy-und-pandas"><span class="header-section-number">6.2</span> Datum und Zeit in NumPy und Pandas</h2>
<p>Die Module NumPy und Pandas nutzen den Datentyp <code>datetime64</code>, um Datums- und Zeitinformationen zu verarbeiten.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">NumPy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p><code>datetime64</code>-Objekte werden mit der Funktion <code>np.datetime64()</code> angelegt, der Datentyp wird in der Ausgabe von Python auch durch den Buchstaben M repräsentiert. <code>datetime64</code>-Objekte können auf zwei Arten angelegt werden:</p>
<ul>
<li>Eine Zeichenkette nach <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a> als Repräsentation eines Datums in der festgelegten Reihenfolge Jahr, Monat, Tag, Stunde, Minute, Sekunde, Millisekunde im Format <code>YYYY-MM-DD 12:00:00.000</code>. Als Zeichentrenner zwischen Datum und Uhrzeit sind ein Leerzeichen oder der Buchstabe T zulässig. Der Datentyp und die kleinste verwendete Einheit werden im Attribut <code>dtype</code> gespeichert.</li>
</ul>
<div id="1ab874f0" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="st">'2024'</span>), np.datetime64(<span class="st">'2024'</span>).dtype)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="st">'2024-10-31'</span>), np.datetime64(<span class="st">'2024-10-31'</span>).dtype)</span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="st">'2024-10-31T12:24:59.999'</span>), np.datetime64(<span class="st">'2024-10-31T12:24:59.999'</span>).dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2024 datetime64[Y]
2024-10-31 datetime64[D]
2024-10-31T12:24:59.999 datetime64[ms]</code></pre>
</div>
</div>
<ul>
<li>Als Zahl relativ zur Epoche und unter Angabe einer Zeiteinheit. Die verfügbaren Zeiteinheiten sind years (‘Y’), months (‘M’), weeks (‘W’), days (‘D’) sowie hours (‘h’), minutes (‘m’), seconds (‘s’), milliseconds (‘ms’) und weitere sekundenbasierte Einheiten bis zur Attosekunde (siehe <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html#datetime-units">NumPy Dokumentation</a>).</li>
</ul>
<div id="a68bfccc" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="dv">10</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'D'</span>), np.datetime64(<span class="dv">10</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'D'</span>).dtype)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'h'</span>), np.datetime64(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'h'</span>).dtype)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'s'</span>), np.datetime64(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, <span class="st">'s'</span>).dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1997-05-19 datetime64[D]
2084-01-29T16 datetime64[h]
2001-09-09T01:46:40 datetime64[s]</code></pre>
</div>
</div>
<p>Außerdem können Datetime-Formate anderer Module in <code>np.datetime64()</code> umgewandelt werden.</p>
<p>Beim Anlegen eines Arrays, kann die Zeiteinheit gewählt werden.</p>
<div id="c16da89b" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>my_array <span class="op">=</span> np.array([<span class="st">'2007-07-13'</span>, <span class="st">'2006-01-13'</span>, <span class="st">'2010-08-13'</span>], dtype <span class="op">=</span> <span class="st">'datetime64[s]'</span>)</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(my_array, my_array.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['2007-07-13T00:00:00' '2006-01-13T00:00:00' '2010-08-13T00:00:00'] datetime64[s]</code></pre>
</div>
</div>
<p>Der Datentyp <code>datetime64</code> ist mit den meisten NumPy-Funktionen kompatibel.</p>
<div id="017bd568" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>np.arange(<span class="st">'2005-02'</span>, <span class="st">'2005-03'</span>, dtype <span class="op">=</span> <span class="st">'datetime64[D]'</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>array(['2005-02-01', '2005-02-02', '2005-02-03', '2005-02-04',
       '2005-02-05', '2005-02-06', '2005-02-07', '2005-02-08',
       '2005-02-09', '2005-02-10', '2005-02-11', '2005-02-12',
       '2005-02-13', '2005-02-14', '2005-02-15', '2005-02-16',
       '2005-02-17', '2005-02-18', '2005-02-19', '2005-02-20',
       '2005-02-21', '2005-02-22', '2005-02-23', '2005-02-24',
       '2005-02-25', '2005-02-26', '2005-02-27', '2005-02-28'],
      dtype='datetime64[D]')</code></pre>
</div>
</div>
<p>(<a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">NumPy Dokumentation</a>)</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>In Pandas werden <code>datetime64</code>-Objekte mit den Funktionen <code>pd.to_datetime()</code> oder <code>pd.date_range()</code> angelegt.<br>
<em>Hinweis: Eine weitere Möglichkeit ist die Funktion <code>pd.Timestamp()</code>, die umfangreichere Möglichkeiten zur Erzeugung eines Zeitpunkts bietet, aber kein string-parsing unterstützt.</em></p>
<p><code>pd.to_datetime()</code> erzeugt Werte des Datentyps <code>datetime64[ns]</code> (mit <code>pd.to_datetime()</code> erzeugte Skalare werden als Timestamp (Zeitpunkt) ausgegeben, die kein Attribut <code>dtype</code> haben). Die Funktion <code>pd.to_datetime()</code> akzeptiert als Eingabewerte:</p>
<ul>
<li><p>datetime-Objekte anderer Module.</p></li>
<li><p>Zahlen und eine Zeiteinheit <code>pd.to_datetime(1, unit = None)</code> (Standard sind Nanosekunden). Das Argument <code>unit</code> nimmt die Werte ‘ns’, ‘ms’, ‘s’, ‘m’, ‘h’, ‘D’, ‘W’, ‘M’, ‘Y’ für Nanosekunde, Millisekunde, Sekunde, Minute, Stunde, Tag, Woche, Monat bzw. Jahr entgegen. Erzeugt wird ein Zeitpunkt relativ zur Epoche.</p></li>
</ul>
<div id="0f56e4e9" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="dv">1000</span>, unit <span class="op">=</span> <span class="st">'D'</span>))</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, unit <span class="op">=</span> <span class="st">'h'</span>))</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="dv">1000</span>, unit <span class="op">=</span> <span class="st">'s'</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1972-09-27 00:00:00
2084-01-29 16:00:00
2001-09-09 01:46:40</code></pre>
</div>
</div>
<ul>
<li>Zeichenketten, die ein Datum oder ein Datum mit Uhrzeit ausdrücken, formatiert nach <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a>.</li>
</ul>
<div id="03635c89" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="st">'2017'</span>))</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="st">'2017-01-01T00'</span>))</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="st">'2017-01-01 00:00:00'</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2017-01-01 00:00:00
2017-01-01 00:00:00
2017-01-01 00:00:00</code></pre>
</div>
</div>
<ul>
<li>Anders formatierte Zeichenketten mit dem Argument format = <code>"%d/%m/%Y"</code> (siehe <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">Dokumentation strftime zur string-Formatierung</a>).</li>
</ul>
<div id="b6d47e95" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="st">'Monday, 12. August `24'</span>, <span class="bu">format</span> <span class="op">=</span> <span class="st">"%A, </span><span class="sc">%d</span><span class="st">. %B `%y"</span>))</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(<span class="st">'Monday, 12. August 2024, 12:15 Uhr CET'</span>, <span class="bu">format</span> <span class="op">=</span> <span class="st">"%A, </span><span class="sc">%d</span><span class="st">. %B %Y, %H:%M Uhr %Z"</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2024-08-12 00:00:00
2024-08-12 12:15:00+02:00</code></pre>
</div>
</div>
<ul>
<li>Dictionary oder DataFrame.</li>
</ul>
<div id="90997014" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime({<span class="st">'year'</span>:[<span class="dv">2020</span>, <span class="dv">2024</span>], <span class="st">'month'</span>: [<span class="dv">1</span>, <span class="dv">11</span>], <span class="st">'day'</span>: [<span class="dv">1</span>, <span class="dv">21</span>]}), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.to_datetime(pd.DataFrame({<span class="st">'year'</span>:[<span class="dv">2020</span>, <span class="dv">2024</span>], <span class="st">'month'</span>: [<span class="dv">1</span>, <span class="dv">11</span>], <span class="st">'day'</span>: [<span class="dv">1</span>, <span class="dv">21</span>]})))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0   2020-01-01
1   2024-11-21
dtype: datetime64[ns] 

0   2020-01-01
1   2024-11-21
dtype: datetime64[ns]</code></pre>
</div>
</div>
<p>Die Funktion <code>pd.date_range()</code> erzeugt ein Array vom Typ <code>DatetimeIndex</code> mit dtype <code>datetime64</code>. Genau drei der folgenden vier Argumente sind für die Erzeugung erforderlich:</p>
<ul>
<li><p>start: Beginn der Reihe.</p></li>
<li><p>end: Ende der Reihe (inklusiv)</p></li>
<li><p>freq: Schrittweite (bspw. Jahr, Tag, Geschäftstag, Stunde oder Vielfache wie ‘6h’ - siehe <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html#timeseries-offset-aliases">Liste verfügbarer strings</a>)</p></li>
<li><p>periods: Anzahl der zu erzeugenden Werte.</p></li>
</ul>
<div id="dfc590f1" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(start <span class="op">=</span> <span class="st">'2017'</span>, end <span class="op">=</span> <span class="st">'2024'</span>, periods <span class="op">=</span> <span class="dv">3</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(start <span class="op">=</span> <span class="st">'2017'</span>, end <span class="op">=</span> <span class="st">'2024'</span>, freq <span class="op">=</span> <span class="st">'Y'</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.date_range(end <span class="op">=</span> <span class="st">'2024'</span>, freq <span class="op">=</span> <span class="st">'h'</span>, periods <span class="op">=</span> <span class="dv">3</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DatetimeIndex(['2017-01-01', '2020-07-02', '2024-01-01'], dtype='datetime64[ns]', freq=None) 

DatetimeIndex(['2017-12-31', '2018-12-31', '2019-12-31', '2020-12-31',
               '2021-12-31', '2022-12-31', '2023-12-31'],
              dtype='datetime64[ns]', freq='YE-DEC') 

DatetimeIndex(['2023-12-31 22:00:00', '2023-12-31 23:00:00',
               '2024-01-01 00:00:00'],
              dtype='datetime64[ns]', freq='h')</code></pre>
</div>
</div>
<p><em>Hinweis: Die Funktion <code>pd.date_range()</code> wird künftig das Kürzel ‘Y’ nicht mehr unterstützen. Stattdessen können die Kürzel ‘YS’ (Jahresbeginn) oder ‘YE’ (Jahresende) verwendet werden. Ebenso wird das Kürzel ‘M’ künftig durch ‘MS’ (Monatsstart), ‘ME’ (Monatsende) ersetzt.</em></p>
</div>
</div>
</div>
<p>Zeitdifferenzen werden über einen eigenen Datentyp dargestellt (siehe folgendes Beispiel).<br>
<strong>Notiz für mich: Anwendungsfall Zeitzonen verschieben unabhängig von einer Zeitzone (und ohne die Zeitzonensyntax)</strong></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-39-contents" aria-controls="callout-39" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zeitdifferenzen in NumPy und Pandas
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-39" class="callout-39-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">NumPy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Zeitdifferenzen werden mit dem Datentyp <code>timedelta64</code> abgebildet. Dieser wird wie <code>datetime64</code> durch Angabe einer Ganzzahl und einer Zeiteinheit angelegt.</p>
<div id="577dd610" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>np.timedelta64(<span class="dv">1</span>, <span class="st">'D'</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>numpy.timedelta64(1,'D')</code></pre>
</div>
</div>
<p>Objekte der Typen <code>datetime64</code> und <code>timedelta64</code> ermöglichen es, Operationen mit Datum und Zeit durchzuführen (weitere Beispiele in der <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html#datetime-and-timedelta-arithmetic">NumPy-Dokumentation</a>).</p>
<div id="33c66eaa" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="st">'today'</span>) <span class="op">-</span> np.datetime64(<span class="st">'2000-01-01'</span>, <span class="st">'D'</span>))</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.datetime64(<span class="st">'now'</span>) <span class="op">-</span> np.datetime64(<span class="st">'2000-01-01'</span>, <span class="st">'h'</span>))</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">Eine einfache Zeitverschiebung:"</span>, np.datetime64(<span class="st">'now'</span>) <span class="op">-</span> np.timedelta64(<span class="dv">1</span>, <span class="st">'h'</span>))</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wie viele Tage hat die Woche?"</span>, np.timedelta64(<span class="dv">1</span>,<span class="st">'W'</span>) <span class="op">/</span> np.timedelta64(<span class="dv">1</span>,<span class="st">'D'</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9083 days
784831558 seconds


Eine einfache Zeitverschiebung: 2024-11-13T15:45:58
Wie viele Tage hat die Woche? 7.0</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>Zeitdifferenzen können zum einen wie in NumPy durch Angabe einer Ganzzahl und einer Zeiteinheit angelegt werden. Außerdem ist die Übergabe mit Argumenten möglich (zulässige Argumente sind: weeks, days, hours, minutes, seconds, milliseconds, microseconds, nanoseconds).</p>
<div id="49d0c804" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>pd.Timedelta(<span class="dv">1</span>, <span class="st">'D'</span>)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>pd.Timedelta(days <span class="op">=</span> <span class="dv">1</span>, hours <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<pre><code>Timedelta('1 days 01:00:00')</code></pre>
</div>
</div>
<p><strong>Wichtig:</strong> Anders als in NumPy werden Zeitdifferenzen in Monaten und Jahren nicht mehr von Pandas unterstützt.</p>
<div id="66747acf" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>( pd.Timedelta(<span class="dv">1</span>, <span class="st">'Y'</span>))</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(error)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>( pd.Timedelta(<span class="dv">1</span>, <span class="st">'Y'</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units 'M', 'Y', and 'y' are no longer supported, as they do not represent unambiguous timedelta values durations.</code></pre>
</div>
</div>
<p>Zum anderen können Zeitdifferenzen mit einer Zeichenkette erzeugt werden.</p>
<div id="1af04b75" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Timedelta(<span class="st">'10sec'</span>))</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Timedelta(<span class="st">'10min'</span>))</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Timedelta(<span class="st">'10hours'</span>))</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Timedelta(<span class="st">'10days'</span>))</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.Timedelta(<span class="st">'10w'</span>))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 days 00:00:10
0 days 00:10:00
0 days 10:00:00
10 days 00:00:00
70 days 00:00:00</code></pre>
</div>
</div>
<p>Mit Hilfe einer Zeitdifferenz können Zeitreihen leicht verschoben werden.</p>
<div id="b7bb0f5a" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>pd.date_range(start <span class="op">=</span> <span class="st">'2024-01-01T00:00'</span>, end <span class="op">=</span> <span class="st">'2024-01-01T02:00'</span>, freq <span class="op">=</span> <span class="st">'15min'</span>) <span class="op">+</span> pd.Timedelta(<span class="st">'30min'</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>DatetimeIndex(['2024-01-01 00:30:00', '2024-01-01 00:45:00',
               '2024-01-01 01:00:00', '2024-01-01 01:15:00',
               '2024-01-01 01:30:00', '2024-01-01 01:45:00',
               '2024-01-01 02:00:00', '2024-01-01 02:15:00',
               '2024-01-01 02:30:00'],
              dtype='datetime64[ns]', freq='15min')</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p><strong>Wie alt sind Sie in Tagen? Wie alt in Sekunden? Rechnen Sie mit NumPy oder Pandas.</strong></p>
<div id="tip-alter" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-38-contents" aria-controls="callout-38" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;24: Tipp Pandas und Musterlösung Alter
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-38" class="callout-38-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Für eine elegante Lösung in Pandas schauen Sie sich die verfügbaren Methoden und Attribute von Timedelta-Objekten an.</p>
<pre class="raw"><code>dir(pd.Timedelta(0))</code></pre>
<div id="tip-loesungalter" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;23: Musterlösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ersetzen sie in der Lösung die Zeichenkette ‘YYYY-MM-DD’ bzw., wenn Sie die Uhrzeit Ihrer Geburt kennen, die Zeichenkette ‘YYYY-MM-DDTHH:MM’ durch ihren Geburtstag.</p>
<section id="numpy-5" class="level4">
<h4 class="anchored" data-anchor-id="numpy-5">NumPy</h4>
<p>In NumPy können die Schlüsselwörter <code>np.datetime64('today')</code> und <code>np.datetime64('now')</code> verwendet werden. Die Ausgabe ist in Tagen bzw. in Sekunden aufgelöst.</p>
<pre class="raw"><code>print(np.datetime64('today') - np.datetime64('YYYY-MM-DD', 'D'))
print(np.datetime64('now') - np.datetime64('YYYY-MM-DDTHH:MM', 's'))</code></pre>
</section>
<section id="pandas-5" class="level4">
<h4 class="anchored" data-anchor-id="pandas-5">Pandas</h4>
<p>In Pandas werden die Schlüsselwörter <code>pd.to_datetime('today')</code> und <code>pd.to_datetime('now')</code> in Nanosekunden aufgelöst.</p>
<pre class="raw"><code>(pd.to_datetime('today') - pd.to_datetime('YYYY-MM-DD')).days
(pd.to_datetime('now') - pd.to_datetime('YYYY-MM-DDTHH:MM')).total_seconds()</code></pre>
</section>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="zeitreihen-einlesen" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="zeitreihen-einlesen"><span class="header-section-number">6.3</span> Zeitreihen einlesen</h2>
<p>Insbesondere das Modul Pandas bietet effiziente Möglichkeiten, um Datumsformate korrekt einzulesen. Im Folgenden wird das Einlesen von Zeitreihen mit NumPy und Pandas anhand von Strommarktdaten demonstriert. In <a href="#sec-übungenzeitreihen" class="quarto-xref">Kapitel&nbsp;6.5</a> stehen verschiedene Übungsaufgaben zur Verfügung.</p>
<p>Die Bundesnetzagentur veröffentlicht verschiedene Strommarktdaten, darunter die Großhandelspreise. Die Strommarktdaten der Bundesnetzagentur müssen manuell auf <a href="https://www.smard.de/home/downloadcenter/download-marktdaten/">https://www.smard.de/</a> heruntergeladen werden. In diesem Skript werden Daten für das Jahr 2023 benutzt.</p>
<div style="font-size: 90%;">
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Daten</th>
<th>Dateiname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Großhandelspreise 2023</td>
<td>Gro_handelspreise_202301010000_202401010000_Stunde.csv</td>
</tr>
<tr class="even">
<td>Großhandelspreise 2023 (Englisch)</td>
<td>Day-ahead_prices_202301010000_202401010000_Hour.csv</td>
</tr>
</tbody>
</table>
</div>
<div id="wrn-SMARD" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-40-contents" aria-controls="callout-40" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;8: SMARD Daten herunterladen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-40" class="callout-40-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>

</div>
<div class="quarto-layout-panel" data-layout="[[50, 50], [50, 50], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Beim der Auswahl des Zeitraums auf Akzeptieren klicken.</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Daten in Originalauflösung auswählen und auf Download klicken.</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/smard-accept.png" class="img-fluid figure-img"></p>
<figcaption>&nbsp;</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/smard-day-ahead-prices.png" class="img-fluid figure-img"></p>
<figcaption>&nbsp;</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p>Das Datumsformat der Dateien ist abhängig von der auf der Internetseite eingestellten Sprache (Deutsch/English).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">NumPy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>Der Versuch, die Datei mit <code>np.loadtxt()</code> einzulesen, führt zu verschiedenen Fehlermeldungen (Datentyp ist nicht numerisch, Spaltenzahl kann nicht ermittelt werden). Diesen wird durch Spezifizierung des Datentyps <code>dtype = str</code> und der Beschränkung auf die erste Zeile <code>max_rows = 1</code> begegnet.</p>
<div id="a7c7373f" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"skript/01-daten/Gro_handelspreise_202301010000_202401010000_Stunde.csv"</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> np.loadtxt(fname <span class="op">=</span> dateipfad, dtype <span class="op">=</span> <span class="st">'str'</span>, max_rows <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>preise</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>array(['ï»¿Datum', 'von;Datum', 'bis;Deutschland/Luxemburg', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;âˆ…', 'Anrainer', 'DE/LU', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Belgien', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;DÃ¤nemark', '1', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;DÃ¤nemark', '2', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Frankreich', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Niederlande', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Norwegen', '2', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Ã–sterreich', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Polen', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Schweden', '4', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Schweiz', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Tschechien', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;DE/AT/LU', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Italien', '(Nord)', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Slowenien', '[â‚¬/MWh]',
       'OriginalauflÃ¶sungen;Ungarn', '[â‚¬/MWh]', 'OriginalauflÃ¶sungen'],
      dtype='&lt;U32')</code></pre>
</div>
</div>
<p>Auf diese Weise kann die erste Zeile eingelesen und das Semikolon als Zeichentrenner identifiziert werden. Außerdem sind Fehler mit der Zeichenkodierung auffällig. Deshalb werden der Zeichentrenner mit <code>delimiter = ';'</code> und die Kodierung der Datei mit `encoding = ‘UTF-8’ übergeben.</p>
<div id="18718981" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"skript/01-daten/Gro_handelspreise_202301010000_202401010000_Stunde.csv"</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> np.loadtxt(fname <span class="op">=</span> dateipfad, dtype <span class="op">=</span> <span class="st">'str'</span>, max_rows <span class="op">=</span> <span class="dv">1</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8'</span>)</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>preise</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>array(['\ufeffDatum von', 'Datum bis',
       'Deutschland/Luxemburg [€/MWh] Originalauflösungen',
       '∅ Anrainer DE/LU [€/MWh] Originalauflösungen',
       'Belgien [€/MWh] Originalauflösungen',
       'Dänemark 1 [€/MWh] Originalauflösungen',
       'Dänemark 2 [€/MWh] Originalauflösungen',
       'Frankreich [€/MWh] Originalauflösungen',
       'Niederlande [€/MWh] Originalauflösungen',
       'Norwegen 2 [€/MWh] Originalauflösungen',
       'Österreich [€/MWh] Originalauflösungen',
       'Polen [€/MWh] Originalauflösungen',
       'Schweden 4 [€/MWh] Originalauflösungen',
       'Schweiz [€/MWh] Originalauflösungen',
       'Tschechien [€/MWh] Originalauflösungen',
       'DE/AT/LU [€/MWh] Originalauflösungen',
       'Italien (Nord) [€/MWh] Originalauflösungen',
       'Slowenien [€/MWh] Originalauflösungen',
       'Ungarn [€/MWh] Originalauflösungen'], dtype='&lt;U49')</code></pre>
</div>
</div>
<p>Es verbleibt die Zeichenkette “\ufeff” am Beginn des Arrays. Diese kennzeichnet die <a href="https://de.wikipedia.org/wiki/Byte-Reihenfolge">Byte-Reihenfolge</a> der Datei. Diese kann mit der Übergabe der Kodierung <code>encoding = 'UTF-8-sig'</code> übersprungen werden (<a href="https://stackoverflow.com/a/72466627">Mark Tolonen auf stackoverflow.com</a>, <a href="https://docs.python.org/3/library/codecs.html">Python Dokumentation</a>). Auf diese Weise wird die erste Zeile korrekt eingelesen, sodass die Anzahl der einzulesenden Zeilen mit <code>max_rows = 2</code> erweitert werden kann, um die Datentypen zu identifizieren.</p>
<div id="2fa0e3a9" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> np.loadtxt(fname <span class="op">=</span> dateipfad, dtype <span class="op">=</span> <span class="st">'str'</span>, max_rows <span class="op">=</span> <span class="dv">2</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8-sig'</span>)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>preise</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>array([['Datum von', 'Datum bis',
        'Deutschland/Luxemburg [€/MWh] Originalauflösungen',
        '∅ Anrainer DE/LU [€/MWh] Originalauflösungen',
        'Belgien [€/MWh] Originalauflösungen',
        'Dänemark 1 [€/MWh] Originalauflösungen',
        'Dänemark 2 [€/MWh] Originalauflösungen',
        'Frankreich [€/MWh] Originalauflösungen',
        'Niederlande [€/MWh] Originalauflösungen',
        'Norwegen 2 [€/MWh] Originalauflösungen',
        'Österreich [€/MWh] Originalauflösungen',
        'Polen [€/MWh] Originalauflösungen',
        'Schweden 4 [€/MWh] Originalauflösungen',
        'Schweiz [€/MWh] Originalauflösungen',
        'Tschechien [€/MWh] Originalauflösungen',
        'DE/AT/LU [€/MWh] Originalauflösungen',
        'Italien (Nord) [€/MWh] Originalauflösungen',
        'Slowenien [€/MWh] Originalauflösungen',
        'Ungarn [€/MWh] Originalauflösungen'],
       ['01.01.2023 00:00', '01.01.2023 01:00', '-5,17', '13,85',
        '-4,39', '2,01', '2,01', '0,00', '-3,61', '119,32', '12,06',
        '18,09', '2,01', '0,03', '4,84', '-', '195,90', '13,31', '19,76']],
      dtype='&lt;U49')</code></pre>
</div>
</div>
<p>Die ersten beiden Spalten enthalten Datums- und Zeitinformationen, die folgenden numerische Werte, wobei eine Spalte mit ‘-’ kodierte fehlende Werte enthält. Als Dezimaltrennzeichen wird das Komma verwendet. Da NumPy-Arrays immer nur einen Datentyp enthalten können, muss der Datensatz entsprechend aufgeteilt werden. Für die viertletzte Spalte ist zu prüfen, ob diese ausschließlich fehlende Werte enthält.</p>
<p>Zunächst wird der Datensatz vollständig als string eingelesen, die Spaltenbeschriftungen werden mit <code>skiprows = 1</code> übersprungen.</p>
<div id="74993175" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> np.loadtxt(fname <span class="op">=</span> dateipfad, dtype <span class="op">=</span> <span class="st">'str'</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8-sig'</span>, skiprows <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Anschließend werden im ersten Schritt die Datumsspalten isoliert. NumPy unterstützt keine String-Formatierung, die Zeitstempel müssen deshalb manuell von ‘01.01.2023 00:00’ in die Formatierung nach ISO 8601 ‘YYYY-MM-DDThh:mm’ konvertiert werden.</p>
<div id="c6022087" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datumsspalten isolieren</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>preise_date <span class="op">=</span> preise[ : , <span class="dv">0</span>:<span class="dv">2</span>]</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeichenkette manuell ins Format ISO 8601 bringen</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Spalte 0</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="co">### neues Array anlegen</span></span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>preise_datumvon <span class="op">=</span> np.array([], dtype <span class="op">=</span> <span class="st">'datetime64'</span>)</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> preise_date[ : , <span class="dv">0</span>]:</span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># string umstellen</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  neues_element <span class="op">=</span> element[<span class="dv">6</span>:<span class="dv">10</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">3</span>:<span class="dv">5</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">0</span>:<span class="dv">2</span>] <span class="op">+</span> <span class="st">'T'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">11</span>:<span class="dv">13</span>] <span class="op">+</span>  <span class="st">':'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">14</span>:]</span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in datetime64 konvertieren</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>  neues_element <span class="op">=</span> np.datetime64(neues_element)</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># anhängen</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>  preise_datumvon <span class="op">=</span> np.append(preise_datumvon, neues_element)</span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a><span class="co">## Spalte 1</span></span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a><span class="co">### neues Array anlegen</span></span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>preise_datumbis <span class="op">=</span> np.array([], dtype <span class="op">=</span> <span class="st">'datetime64'</span>)</span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> preise_date[ : , <span class="dv">1</span>]:</span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-30"><a href="#cb221-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># string umstellen</span></span>
<span id="cb221-31"><a href="#cb221-31" aria-hidden="true" tabindex="-1"></a>  neues_element <span class="op">=</span> element[<span class="dv">6</span>:<span class="dv">10</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-32"><a href="#cb221-32" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">3</span>:<span class="dv">5</span>] <span class="op">+</span> <span class="st">'-'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-33"><a href="#cb221-33" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">0</span>:<span class="dv">2</span>] <span class="op">+</span> <span class="st">'T'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-34"><a href="#cb221-34" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">11</span>:<span class="dv">13</span>] <span class="op">+</span>  <span class="st">':'</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb221-35"><a href="#cb221-35" aria-hidden="true" tabindex="-1"></a>  element[<span class="dv">14</span>:]</span>
<span id="cb221-36"><a href="#cb221-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-37"><a href="#cb221-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in datetime64 konvertieren</span></span>
<span id="cb221-38"><a href="#cb221-38" aria-hidden="true" tabindex="-1"></a>  neues_element <span class="op">=</span> np.datetime64(neues_element)</span>
<span id="cb221-39"><a href="#cb221-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-40"><a href="#cb221-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># anhängen</span></span>
<span id="cb221-41"><a href="#cb221-41" aria-hidden="true" tabindex="-1"></a>  preise_datumbis <span class="op">=</span> np.append(preise_datumbis, neues_element)</span>
<span id="cb221-42"><a href="#cb221-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-43"><a href="#cb221-43" aria-hidden="true" tabindex="-1"></a><span class="co"># die letzten 4 Elemente angucken</span></span>
<span id="cb221-44"><a href="#cb221-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise_datumvon[<span class="op">-</span><span class="dv">4</span>:], preise_datumvon.dtype)</span>
<span id="cb221-45"><a href="#cb221-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise_datumbis[<span class="op">-</span><span class="dv">4</span>:], preise_datumbis.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['2023-12-31T20:00' '2023-12-31T21:00' '2023-12-31T22:00'
 '2023-12-31T23:00'] datetime64[m]
['2023-12-31T21:00' '2023-12-31T22:00' '2023-12-31T23:00'
 '2024-01-01T00:00'] datetime64[m]</code></pre>
</div>
</div>
<p>Im zweiten Schritt wird geprüft, ob die viertletzte Spalte ausschließlich fehlende Werte enthält. Die Position der Spalte ist zwar bekannt, wird aber dennoch mit der Funktion <code>np.argwhere()</code> ermittelt. Mit der Funktion <code>len(np.unique())</code> werden die einzigartigen Werte abgezählt.</p>
<div id="c56b3a85" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numerische Spalten isolieren</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>preise_numeric <span class="op">=</span> preise[ : , <span class="dv">2</span>:]</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Position der Spalte mit fehlendem Wert '-' in der nullten Zeile finden</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>position <span class="op">=</span> np.argwhere(preise_numeric[<span class="dv">0</span>, : ] <span class="op">==</span> <span class="st">'-'</span>)</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Spaltenindex:"</span>, position)</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prüfen, welche Werte in der Spalte vorkommen</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Anzahl einzigartiger Werte:"</span>, <span class="bu">len</span>(np.unique(preise_numeric[:, position])))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spaltenindex: [[13]]
Anzahl einzigartiger Werte: 1</code></pre>
</div>
</div>
<p>Da die viertletzte Spalte ausschließlich das Zeichen ‘-’ enthält, kann die Spalte entfernt werden. Anschließend kann der Datentyp als Fließkommazahl deklariert werden. Dazu ist es erforderlich, mit <code>np.char.replace(preise_numeric, ',', '.')</code> das Dezimaltrennzeichen Komma durch den Punkt zu ersetzen. Die Spaltennamen müssen separat gespeichert werden.</p>
<div id="1a205e47" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spalte mit fehlenden Werten entfernen</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>preise_numeric <span class="op">=</span> np.delete(arr <span class="op">=</span> preise_numeric, obj <span class="op">=</span> position, axis <span class="op">=</span> <span class="dv">1</span>) <span class="co"># axis 1 = columns</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Dezimaltrennzeichen ersetzen</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>preise_numeric <span class="op">=</span> np.char.replace(preise_numeric, <span class="st">','</span>, <span class="st">'.'</span>)</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>preise_numeric <span class="op">=</span> preise_numeric.astype(<span class="st">'float64'</span>)</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen speichern</span></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>preise_numeric_colnames <span class="op">=</span> np.loadtxt(fname <span class="op">=</span> dateipfad, dtype <span class="op">=</span> <span class="st">'str'</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, encoding <span class="op">=</span> <span class="st">'UTF-8-sig'</span>, max_rows <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>preise_numeric_colnames <span class="op">=</span> preise_numeric_colnames[<span class="dv">2</span>:] <span class="co"># Datumsspalten entfernen</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>preise_numeric_colnames <span class="op">=</span> np.delete(arr <span class="op">=</span> preise_numeric_colnames, obj <span class="op">=</span> position)</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise_numeric_colnames, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise_numeric[<span class="dv">0</span>:<span class="dv">2</span>, :], preise_numeric.dtype)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Deutschland/Luxemburg [€/MWh] Originalauflösungen'
 '∅ Anrainer DE/LU [€/MWh] Originalauflösungen'
 'Belgien [€/MWh] Originalauflösungen'
 'Dänemark 1 [€/MWh] Originalauflösungen'
 'Dänemark 2 [€/MWh] Originalauflösungen'
 'Frankreich [€/MWh] Originalauflösungen'
 'Niederlande [€/MWh] Originalauflösungen'
 'Norwegen 2 [€/MWh] Originalauflösungen'
 'Österreich [€/MWh] Originalauflösungen'
 'Polen [€/MWh] Originalauflösungen'
 'Schweden 4 [€/MWh] Originalauflösungen'
 'Schweiz [€/MWh] Originalauflösungen'
 'Tschechien [€/MWh] Originalauflösungen'
 'Italien (Nord) [€/MWh] Originalauflösungen'
 'Slowenien [€/MWh] Originalauflösungen'
 'Ungarn [€/MWh] Originalauflösungen'] 

[[-5.1700e+00  1.3850e+01 -4.3900e+00  2.0100e+00  2.0100e+00  0.0000e+00
  -3.6100e+00  1.1932e+02  1.2060e+01  1.8090e+01  2.0100e+00  3.0000e-02
   4.8400e+00  1.9590e+02  1.3310e+01  1.9760e+01]
 [-1.0700e+00  9.7900e+00 -1.7500e+00  1.3800e+00  1.3800e+00 -1.0000e-01
  -1.4600e+00  1.0883e+02 -1.0000e-01  5.7500e+00  1.3800e+00 -7.2500e+00
  -3.5000e-01  1.9109e+02 -7.0000e-02  1.9000e-01]] float64</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Zunächst wird die Datei der Großhandelspreise mit der Funktion <code>pd.read_csv()</code> eingelesen und der Erfolg durch Aufruf der Funktionen <code>pd.info()</code> kontrolliert.</p>
<div id="2ab79e6b" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"skript/01-daten/Gro_handelspreise_202301010000_202401010000_Stunde.csv"</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> dateipfad)</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise.info())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 8760 entries, ('01.01.2023 00:00;01.01.2023 01:00;-5', '17;13', '85;-4', '39;2', '01;2', '01;0', '00;-3', '61;119', '32;12', '06;18', '09;2', '01;0', '03;4', '84;-;195', '90;13', '31;19') to ('31.12.2023 23:00;01.01.2024 00:00;2', '44;19', '26;3', '17;26', '87;26', '87;3', '64;3', '17;59', '31;9', '35;35', '70;26', '87;9', '51;7', '44;-;106', '12;11', '02;14')
Data columns (total 1 columns):
 #   Column                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Non-Null Count  Dtype
---  ------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          --------------  -----
 0   Datum von;Datum bis;Deutschland/Luxemburg [€/MWh] Originalauflösungen;∅ Anrainer DE/LU [€/MWh] Originalauflösungen;Belgien [€/MWh] Originalauflösungen;Dänemark 1 [€/MWh] Originalauflösungen;Dänemark 2 [€/MWh] Originalauflösungen;Frankreich [€/MWh] Originalauflösungen;Niederlande [€/MWh] Originalauflösungen;Norwegen 2 [€/MWh] Originalauflösungen;Österreich [€/MWh] Originalauflösungen;Polen [€/MWh] Originalauflösungen;Schweden 4 [€/MWh] Originalauflösungen;Schweiz [€/MWh] Originalauflösungen;Tschechien [€/MWh] Originalauflösungen;DE/AT/LU [€/MWh] Originalauflösungen;Italien (Nord) [€/MWh] Originalauflösungen;Slowenien [€/MWh] Originalauflösungen;Ungarn [€/MWh] Originalauflösungen  8760 non-null   int64
dtypes: int64(1)
memory usage: 4.3+ MB
None</code></pre>
</div>
</div>
<p>Es wird nur eine Spalte erkannt, da im Datensatz das Semikolon als Zeichentrenner verwendet wird, das nun mit dem Argument <code>sep = ';'</code> übergeben wird (Standardwert ist das Komma). Durch Aufruf der Funktionen <code>pd.info()</code> und <code>pd.head()</code> wird der Erfolg kontrolliert.</p>
<div id="56b264c2" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">"skript/01-daten/Gro_handelspreise_202301010000_202401010000_Stunde.csv"</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> dateipfad, sep <span class="op">=</span> <span class="st">';'</span>)</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise.info())</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>preise.head()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8760 entries, 0 to 8759
Data columns (total 19 columns):
 #   Column                                             Non-Null Count  Dtype 
---  ------                                             --------------  ----- 
 0   Datum von                                          8760 non-null   object
 1   Datum bis                                          8760 non-null   object
 2   Deutschland/Luxemburg [€/MWh] Originalauflösungen  8760 non-null   object
 3   ∅ Anrainer DE/LU [€/MWh] Originalauflösungen       8760 non-null   object
 4   Belgien [€/MWh] Originalauflösungen                8760 non-null   object
 5   Dänemark 1 [€/MWh] Originalauflösungen             8760 non-null   object
 6   Dänemark 2 [€/MWh] Originalauflösungen             8760 non-null   object
 7   Frankreich [€/MWh] Originalauflösungen             8760 non-null   object
 8   Niederlande [€/MWh] Originalauflösungen            8760 non-null   object
 9   Norwegen 2 [€/MWh] Originalauflösungen             8760 non-null   object
 10  Österreich [€/MWh] Originalauflösungen             8760 non-null   object
 11  Polen [€/MWh] Originalauflösungen                  8760 non-null   object
 12  Schweden 4 [€/MWh] Originalauflösungen             8760 non-null   object
 13  Schweiz [€/MWh] Originalauflösungen                8760 non-null   object
 14  Tschechien [€/MWh] Originalauflösungen             8760 non-null   object
 15  DE/AT/LU [€/MWh] Originalauflösungen               8760 non-null   object
 16  Italien (Nord) [€/MWh] Originalauflösungen         8760 non-null   object
 17  Slowenien [€/MWh] Originalauflösungen              8760 non-null   object
 18  Ungarn [€/MWh] Originalauflösungen                 8760 non-null   object
dtypes: object(19)
memory usage: 1.3+ MB
None</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Datum von</th>
<th data-quarto-table-cell-role="th">Datum bis</th>
<th data-quarto-table-cell-role="th">Deutschland/Luxemburg [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">∅ Anrainer DE/LU [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Belgien [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Dänemark 1 [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Dänemark 2 [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Frankreich [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Niederlande [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Norwegen 2 [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Österreich [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Polen [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Schweden 4 [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Schweiz [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Tschechien [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">DE/AT/LU [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Italien (Nord) [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Slowenien [€/MWh] Originalauflösungen</th>
<th data-quarto-table-cell-role="th">Ungarn [€/MWh] Originalauflösungen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01.01.2023 00:00</td>
<td>01.01.2023 01:00</td>
<td>-5,17</td>
<td>13,85</td>
<td>-4,39</td>
<td>2,01</td>
<td>2,01</td>
<td>0,00</td>
<td>-3,61</td>
<td>119,32</td>
<td>12,06</td>
<td>18,09</td>
<td>2,01</td>
<td>0,03</td>
<td>4,84</td>
<td>-</td>
<td>195,90</td>
<td>13,31</td>
<td>19,76</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01.01.2023 01:00</td>
<td>01.01.2023 02:00</td>
<td>-1,07</td>
<td>9,79</td>
<td>-1,75</td>
<td>1,38</td>
<td>1,38</td>
<td>-0,10</td>
<td>-1,46</td>
<td>108,83</td>
<td>-0,10</td>
<td>5,75</td>
<td>1,38</td>
<td>-7,25</td>
<td>-0,35</td>
<td>-</td>
<td>191,09</td>
<td>-0,07</td>
<td>0,19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01.01.2023 02:00</td>
<td>01.01.2023 03:00</td>
<td>-1,47</td>
<td>8,91</td>
<td>-1,46</td>
<td>0,09</td>
<td>0,09</td>
<td>-1,33</td>
<td>-1,52</td>
<td>102,39</td>
<td>-0,66</td>
<td>5,27</td>
<td>0,09</td>
<td>-3,99</td>
<td>-0,97</td>
<td>-</td>
<td>187,95</td>
<td>-0,47</td>
<td>0,07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01.01.2023 03:00</td>
<td>01.01.2023 04:00</td>
<td>-5,08</td>
<td>6,58</td>
<td>-5,27</td>
<td>0,08</td>
<td>0,08</td>
<td>-4,08</td>
<td>-5,00</td>
<td>92,36</td>
<td>-1,99</td>
<td>5,74</td>
<td>0,08</td>
<td>-7,71</td>
<td>-1,93</td>
<td>-</td>
<td>187,82</td>
<td>-1,56</td>
<td>0,01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01.01.2023 04:00</td>
<td>01.01.2023 05:00</td>
<td>-4,49</td>
<td>5,42</td>
<td>-4,41</td>
<td>0,05</td>
<td>0,05</td>
<td>-4,16</td>
<td>-4,60</td>
<td>82,66</td>
<td>-2,42</td>
<td>5,22</td>
<td>0,05</td>
<td>-9,71</td>
<td>-3,07</td>
<td>-</td>
<td>187,74</td>
<td>-1,94</td>
<td>-0,77</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>In der Ausgabe ist am Datentyp object erkennbar, dass für keine Spalte der Datentyp erkannt wurde. In der Darstellung der ersten Zeilen des Datensatzes ist das Komma als Dezimaltrennzeichen zu sehen, der Standardwert der Funktion <code>pd.read_csv()</code> ist aber der Punkt. Nach Übergabe des Dezimaltrennzeichens sollten die numerischen Spalten korrekt erkannt werden.</p>
<div id="52639689" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> dateipfad, sep <span class="op">=</span> <span class="st">';'</span>, decimal <span class="op">=</span> <span class="st">','</span>)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise.info())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8760 entries, 0 to 8759
Data columns (total 19 columns):
 #   Column                                             Non-Null Count  Dtype  
---  ------                                             --------------  -----  
 0   Datum von                                          8760 non-null   object 
 1   Datum bis                                          8760 non-null   object 
 2   Deutschland/Luxemburg [€/MWh] Originalauflösungen  8760 non-null   float64
 3   ∅ Anrainer DE/LU [€/MWh] Originalauflösungen       8760 non-null   float64
 4   Belgien [€/MWh] Originalauflösungen                8760 non-null   float64
 5   Dänemark 1 [€/MWh] Originalauflösungen             8760 non-null   float64
 6   Dänemark 2 [€/MWh] Originalauflösungen             8760 non-null   float64
 7   Frankreich [€/MWh] Originalauflösungen             8760 non-null   float64
 8   Niederlande [€/MWh] Originalauflösungen            8760 non-null   float64
 9   Norwegen 2 [€/MWh] Originalauflösungen             8760 non-null   float64
 10  Österreich [€/MWh] Originalauflösungen             8760 non-null   float64
 11  Polen [€/MWh] Originalauflösungen                  8760 non-null   float64
 12  Schweden 4 [€/MWh] Originalauflösungen             8760 non-null   float64
 13  Schweiz [€/MWh] Originalauflösungen                8760 non-null   float64
 14  Tschechien [€/MWh] Originalauflösungen             8760 non-null   float64
 15  DE/AT/LU [€/MWh] Originalauflösungen               8760 non-null   object 
 16  Italien (Nord) [€/MWh] Originalauflösungen         8760 non-null   float64
 17  Slowenien [€/MWh] Originalauflösungen              8760 non-null   float64
 18  Ungarn [€/MWh] Originalauflösungen                 8760 non-null   float64
dtypes: float64(16), object(3)
memory usage: 1.3+ MB
None</code></pre>
</div>
</div>
<p>Der Datentyp der Spalte DE/AT/LU [€/MWh] Originalauflösungen wird nicht als float64 erkannt. In der Ausgabe ist zu sehen, dass wenigstens in den ersten Zeilen fehlende Werte durch ‘-’ markiert sind. Mittels der Methode <code>.describe()</code> kann überprüft werden, ob die Spalte überhaupt numerische Werte enthält.</p>
<div id="24086ee9" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>preise[<span class="st">'DE/AT/LU [€/MWh] Originalauflösungen'</span>].describe()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>count     8760
unique       1
top          -
freq      8760
Name: DE/AT/LU [€/MWh] Originalauflösungen, dtype: object</code></pre>
</div>
</div>
<p>Da dies nicht der Fall ist, kann die Spalte entfernt werden. Anschließend können die ersten beiden Spalten mit der Funktion ‘pd.to_datetime()’ in ein Datumsformat konvertiert werden. Eine Zelle enthält Zeichenketten im Schema ‘01.01.2023 00:00’. Mit Hilfe der <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">strftime-Dokumentation</a> kann der Funktion das Datumsformat übergeben werden.</p>
<div id="16d2fa5a" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>preise.drop(labels <span class="op">=</span> <span class="st">'DE/AT/LU [€/MWh] Originalauflösungen'</span>, axis <span class="op">=</span> <span class="st">'columns'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Datumsspalten konvertieren</span></span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>preise[<span class="st">'Datum von'</span>] <span class="op">=</span> pd.to_datetime(preise[<span class="st">'Datum von'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M"</span>)</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>preise[<span class="st">'Datum bis'</span>] <span class="op">=</span> pd.to_datetime(preise[<span class="st">'Datum bis'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M"</span>)</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise.info())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8760 entries, 0 to 8759
Data columns (total 18 columns):
 #   Column                                             Non-Null Count  Dtype         
---  ------                                             --------------  -----         
 0   Datum von                                          8760 non-null   datetime64[ns]
 1   Datum bis                                          8760 non-null   datetime64[ns]
 2   Deutschland/Luxemburg [€/MWh] Originalauflösungen  8760 non-null   float64       
 3   ∅ Anrainer DE/LU [€/MWh] Originalauflösungen       8760 non-null   float64       
 4   Belgien [€/MWh] Originalauflösungen                8760 non-null   float64       
 5   Dänemark 1 [€/MWh] Originalauflösungen             8760 non-null   float64       
 6   Dänemark 2 [€/MWh] Originalauflösungen             8760 non-null   float64       
 7   Frankreich [€/MWh] Originalauflösungen             8760 non-null   float64       
 8   Niederlande [€/MWh] Originalauflösungen            8760 non-null   float64       
 9   Norwegen 2 [€/MWh] Originalauflösungen             8760 non-null   float64       
 10  Österreich [€/MWh] Originalauflösungen             8760 non-null   float64       
 11  Polen [€/MWh] Originalauflösungen                  8760 non-null   float64       
 12  Schweden 4 [€/MWh] Originalauflösungen             8760 non-null   float64       
 13  Schweiz [€/MWh] Originalauflösungen                8760 non-null   float64       
 14  Tschechien [€/MWh] Originalauflösungen             8760 non-null   float64       
 15  Italien (Nord) [€/MWh] Originalauflösungen         8760 non-null   float64       
 16  Slowenien [€/MWh] Originalauflösungen              8760 non-null   float64       
 17  Ungarn [€/MWh] Originalauflösungen                 8760 non-null   float64       
dtypes: datetime64[ns](2), float64(16)
memory usage: 1.2 MB
None</code></pre>
</div>
</div>
<p>Wenn der innere Aufbau einer Datei bekannt ist, können die notwendigen Parameter auch direkt beim Einlesen mit <code>pd.read_csv</code> übergeben werden (Argumente <code>usecols</code>, <code>parse_dates</code> und <code>date_format</code>).</p>
<div id="238f3f3a" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>preise <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> dateipfad, sep <span class="op">=</span> <span class="st">';'</span>, decimal <span class="op">=</span> <span class="st">','</span>,</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>                     usecols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">15</span>)) <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">16</span>, <span class="dv">19</span>)), <span class="co"># Auswahl der einzulesenden Spalten</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>                     parse_dates <span class="op">=</span> [<span class="st">'Datum von'</span>, <span class="st">'Datum bis'</span>], date_format <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M"</span>) <span class="co"># Formatierung des Datums</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(preise.info())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 8760 entries, 0 to 8759
Data columns (total 18 columns):
 #   Column                                             Non-Null Count  Dtype         
---  ------                                             --------------  -----         
 0   Datum von                                          8760 non-null   datetime64[ns]
 1   Datum bis                                          8760 non-null   datetime64[ns]
 2   Deutschland/Luxemburg [€/MWh] Originalauflösungen  8760 non-null   float64       
 3   ∅ Anrainer DE/LU [€/MWh] Originalauflösungen       8760 non-null   float64       
 4   Belgien [€/MWh] Originalauflösungen                8760 non-null   float64       
 5   Dänemark 1 [€/MWh] Originalauflösungen             8760 non-null   float64       
 6   Dänemark 2 [€/MWh] Originalauflösungen             8760 non-null   float64       
 7   Frankreich [€/MWh] Originalauflösungen             8760 non-null   float64       
 8   Niederlande [€/MWh] Originalauflösungen            8760 non-null   float64       
 9   Norwegen 2 [€/MWh] Originalauflösungen             8760 non-null   float64       
 10  Österreich [€/MWh] Originalauflösungen             8760 non-null   float64       
 11  Polen [€/MWh] Originalauflösungen                  8760 non-null   float64       
 12  Schweden 4 [€/MWh] Originalauflösungen             8760 non-null   float64       
 13  Schweiz [€/MWh] Originalauflösungen                8760 non-null   float64       
 14  Tschechien [€/MWh] Originalauflösungen             8760 non-null   float64       
 15  Italien (Nord) [€/MWh] Originalauflösungen         8760 non-null   float64       
 16  Slowenien [€/MWh] Originalauflösungen              8760 non-null   float64       
 17  Ungarn [€/MWh] Originalauflösungen                 8760 non-null   float64       
dtypes: datetime64[ns](2), float64(16)
memory usage: 1.2 MB
None</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="zugriff-auf-zeitreihen" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="zugriff-auf-zeitreihen"><span class="header-section-number">6.4</span> Zugriff auf Zeitreihen</h2>
<p>Die Module NumPy und Pandas bieten zahlreiche Möglichkeiten, um auf Zeitreihen zuzugreifen. Angenommen, wir interessieren uns für die durchschnittlichen Strompreise an Werktagen und am Wochenende. <strong>eventl. wieder mit panel-tabset für NumPy und Pandas</strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">NumPy</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Pandas</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p><strong>to do</strong></p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<p>Pandas bietet zahlreiche Attribute und Methoden, um Informationen aus <code>datetime64</code>-Objekten auszulesen. Eine Übersicht aller verfügbaren Attribute und Methoden liefert <code>dir(pd.to_datetime(0))</code>.</p>
<div id="4ad89082" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attribute</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jahr:"</span>, pd.to_datetime(<span class="dv">0</span>).year)</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Monat:"</span>, pd.to_datetime(<span class="dv">0</span>).month)</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tag:"</span>, pd.to_datetime(<span class="dv">0</span>).day)</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Stunde:"</span>, pd.to_datetime(<span class="dv">0</span>).hour)</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Minute:"</span>, pd.to_datetime(<span class="dv">0</span>).minute)</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sekunde:"</span>, pd.to_datetime(<span class="dv">0</span>).second)</span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tag des Jahres:"</span>, pd.to_datetime(<span class="dv">0</span>).dayofyear)</span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wochentag:"</span>, pd.to_datetime(<span class="dv">0</span>).dayofweek)</span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tage im Monat:"</span>, pd.to_datetime(<span class="dv">0</span>).days_in_month)</span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Schaltjahr:"</span>, pd.to_datetime(<span class="dv">0</span>).is_leap_year)</span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-13"><a href="#cb239-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Methoden</span></span>
<span id="cb239-14"><a href="#cb239-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Datum:"</span>, pd.to_datetime(<span class="dv">0</span>).date())</span>
<span id="cb239-15"><a href="#cb239-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Zeit:"</span>, pd.to_datetime(<span class="dv">0</span>).time())</span>
<span id="cb239-16"><a href="#cb239-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wochentag (0-6):"</span>, pd.to_datetime(<span class="dv">0</span>).weekday())</span>
<span id="cb239-17"><a href="#cb239-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Monatsname:"</span>,  pd.to_datetime(<span class="dv">0</span>).month_name())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Jahr: 1970
Monat: 1
Tag: 1
Stunde: 0
Minute: 0
Sekunde: 0
Tag des Jahres: 1
Wochentag: 3
Tage im Monat: 31
Schaltjahr: False

Datum: 1970-01-01
Zeit: 00:00:00
Wochentag (0-6): 3
Monatsname: January</code></pre>
</div>
</div>
<p>Für <code>pd.Series</code> erfolgt der Zugriff über den .dt-Operator (siehe <a href="https://pandas.pydata.org/docs/user_guide/basics.html#basics-dt-accessors">.dt accessor</a>). Der Zugriff auf verschiedene Informationen über ein Attribut (ohne Klammern) oder über eine Methode (mit Klammern) unterscheidet sich jedoch teilweise (siehe folgendes Beispiel).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-41-contents" aria-controls="callout-41" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Der dt-Operator
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-41" class="callout-41-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="cbeba6aa" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Attribute</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Datum:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.date) <span class="co"># Unterschied</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Zeit:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.time) <span class="co"># Unterschied</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Jahr"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.year)</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Monat"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.month)</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tag"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.day)</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Stunde"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.hour)</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Minute"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.minute)</span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sekunde"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.second)</span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Tag des Jahres"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.dayofyear)</span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wochentag:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.dayofweek)</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Wochentag:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.weekday) <span class="co"># Unterschied</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tage im Monat:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.days_in_month)</span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Schaltjahr:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.is_leap_year)</span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Methoden</span></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Name des Monats:"</span>, pd.Series(pd.to_datetime(<span class="dv">0</span>)).dt.month_name())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Datum: 0    1970-01-01
dtype: object
Zeit: 0    00:00:00
dtype: object
Jahr 0    1970
dtype: int32
Monat 0    1
dtype: int32
Tag 0    1
dtype: int32
Stunde 0    0
dtype: int32
Minute 0    0
dtype: int32
Sekunde 0    0
dtype: int32

Tag des Jahres 0    1
dtype: int32
Wochentag: 0    3
dtype: int32
Wochentag: 0    3
dtype: int32
Tage im Monat: 0    31
dtype: int32
Schaltjahr: 0    False
dtype: bool

Name des Monats: 0    January
dtype: object</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>Vergleichen Sie den durchschnittlichen Strompreis im Gebiet Deutschland/Luxemburg an Werktagen (Montag - Freitag) mit dem durchschnittlichen Strompreis am Wochenende.</strong></p>
<div id="tip-Durchschnittspreis" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-42-contents" aria-controls="callout-42" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;25: Musterlösung Strompreisvergleich
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-42" class="callout-42-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="0ad803a4" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Zugriff mit .dt für pd.Series</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Werktage und Wochenende unterscheiden</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>werktags <span class="op">=</span> preise[<span class="st">'Datum von'</span>].dt.weekday.isin(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">5</span>)))</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>wochenende <span class="op">=</span> preise[<span class="st">'Datum von'</span>].dt.weekday.isin(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">7</span>)))</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(werktags.head())</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wochenende.head())</span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preise vergleichen</span></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a>preis_werktags <span class="op">=</span> preise.loc[werktags, <span class="st">'Deutschland/Luxemburg [€/MWh] Originalauflösungen'</span>].mean()</span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>preis_wochenende <span class="op">=</span> preise.loc[wochenende, <span class="st">'Deutschland/Luxemburg [€/MWh] Originalauflösungen'</span>].mean()</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Durchschnittspreis werktags: </span><span class="sc">{</span>preis_werktags<span class="sc">:.2f}</span><span class="ss"> [€/MWh]</span><span class="ch">\n</span><span class="ss">Durchschnittspreis am Wochenende: </span><span class="sc">{</span>preis_wochenende<span class="sc">:.2f}</span><span class="ss"> [€/MWh]"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0    False
1    False
2    False
3    False
4    False
Name: Datum von, dtype: bool
0    True
1    True
2    True
3    True
4    True
Name: Datum von, dtype: bool

Durchschnittspreis werktags: 103.18 [€/MWh]
Durchschnittspreis am Wochenende: 75.34 [€/MWh]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-übungenzeitreihen" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="sec-übungenzeitreihen"><span class="header-section-number">6.5</span> Übungen: Zeitreihen einlesen</h2>
<p>Die folgenden Übungen trainieren die Anwendung der in diesem Kapitel vorgestellten Werkzeuge und können mit NumPy oder mit Pandas gelöst werden.</p>
<section id="leicht-englisches-datumsformat-einlesen" class="level4">
<h4 class="anchored" data-anchor-id="leicht-englisches-datumsformat-einlesen">Leicht: Englisches Datumsformat einlesen</h4>
<p><strong>Aufgabe: Lesen Sie die Datei ‘Day-ahead_prices_202301010000_202401010000_Hour.csv’ so ein, dass die Datentypen korrekt erkannt werden. (Hinweise zur Datei siehe <a href="#wrn-SMARD" class="quarto-xref">Hinweis&nbsp;8</a>, siehe <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior">Dokumentation strftime zur string-Formatierung</a>)</strong></p>
<p><strong>Die Musterlösung kann Marc machen. Dateipfad: “aufgaben/01-daten/Day-ahead_prices_202301010000_202401010000_Hour.csv”</strong></p>
<div id="tip-strompreise" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-43-contents" aria-controls="callout-43" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;26: Musterlösung Strompreise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-43" class="callout-43-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
</section>
<section id="mittel-strommarktdaten-österreich" class="level4">
<h4 class="anchored" data-anchor-id="mittel-strommarktdaten-österreich">Mittel: Strommarktdaten Österreich</h4>
<p>Die Austrian Power Grid AG (APG) veröffentlicht Strommarktdaten unter <a href="https://markttransparenz.apg.at/de/markt/Markttransparenz/erzeugung/Erzeugung-pro-Typ">https://markttransparenz.apg.at/</a>. Unter dem Link können Erzeugungsdaten für das Jahr 2023 heruntergeladen werden.</p>
<div id="wrn-Strommarkt-Austria" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-44-contents" aria-controls="callout-44" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;9: Markttranzparenzdaten Österreich herunterladen
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-44" class="callout-44-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Nach der Auswahl des Zeitraums auf Exportieren klicken, dann erscheint die Schaltfläche Download.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="aufgaben/00-bilder/APG-erzeugungsdaten-2023-de.png" class="img-fluid figure-img"></p>
<figcaption>&nbsp;</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="aufgaben/00-bilder/english/APG-generation-data-2023-en.png" class="img-fluid figure-img"></p>
<figcaption>&nbsp;</figcaption>
</figure>
</div>
<p>Das Datumsformat der Dateien ist abhängig von der auf der Internetseite eingestellten Sprache (Deutsch/English).</p>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Diesem Skript ist folgende Datei angefügt.</p>
<div style="font-size: 90%;">
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Daten</th>
<th>Dateiname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Realisierte Stromerzeugung 2023</td>
<td>AGPT_2022-12-31T23_00_00Z_2023-12-31T23_00_00Z_15M_de_2024-06-10T09_32_38Z.csv</td>
</tr>
</tbody>
</table>
</div>
<p>In dem Datensatz wird durch die Umstellung von Sommer- auf Winterzeit am letzten Sonntag im Oktober die Stunde 2 Uhr morgens doppelt eingetragen (dafür fehlt eine Stunde bei der Umstellung von Winter- auf Sommerzeit am letzten Sonntag im März). Die doppelte Stunde wird im Datensatz mit 2A bzw. 2B gekennzeichnet. (Mitteilung Austrian Power Grid AG vom 13.08.2024)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="skript/00-bilder/erzeugung-aut-zeitumstellung.png" class="img-fluid figure-img"></p>
<figcaption>Zeitumstellung im österreichischen Datensatz</figcaption>
</figure>
</div>
<p><strong>Lesen Sie die Datei so ein, dass die Spalten mit Datums- und Zeitinformationen als datetime erkannt werden. Lösen Sie die Zeitumstellung so auf, dass jeder Tag 24 Stunden hat.</strong></p>
<ul>
<li><p>Stringmanipulation wie in ‘österreichische Datei einlesen.py’ –&gt; dann gibt es die Stunde 02 am 29.10. doppelt.</p></li>
<li><p>Indexposition der doppelten Stunde herausfinden sowie welche Stunde dafür fehlt. –&gt; müsste im März sein können wir uns angucken mit 3 Masken</p>
<ul>
<li><p>month = März (3)</p></li>
<li><p>dayofweek = Sonntag (6)</p></li>
<li><p>pd.Series.dt.hour Die Stunde liegt nicht in der list(range(1, 25)).</p></li>
</ul></li>
<li><p>Dann müssen alle Zeiten bis dahin um eine Stunde verschoben werden - timedelta64</p></li>
</ul>
<p>dateipfad = “aufgaben\01-daten_2022-12-31T23_00_00Z_2023-12-31T23_00_00Z_15M_de_2024-06-10T09_32_38Z.csv”</p>
<div id="tip-Austria" class="callout callout-style-default callout-tip callout-titled" title="Musterlösung Strommarktdaten Österreich">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-45-contents" aria-controls="callout-45" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;27: Musterlösung Strommarktdaten Österreich
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-45" class="callout-45-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Datei einlesen und String-Manipulation</strong></p>
<p>Zunächst wird die Datei eingelesen. Damit die Datumsspalten korrekt eingelesen werden können, werden die Zeichenfolgen “2A” und “2B” mit der Methode <code>str.replace()</code> durch “02” ersetzt. Dadurch wird eine Dublette im Datensatz erzeugt.</p>
<div id="393f5c2e" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>erzeugung_austria <span class="op">=</span> pd.read_csv(filepath_or_buffer <span class="op">=</span> <span class="st">"aufgaben/01-daten/AGPT_2022-12-31T23_00_00Z_2023-12-31T23_00_00Z_15M_de_2024-06-10T09_32_38Z.csv"</span>,</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>                                sep <span class="op">=</span> <span class="st">";"</span>, decimal <span class="op">=</span> <span class="st">","</span>, thousands <span class="op">=</span> <span class="st">"."</span>)</span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="co"># string replace &amp; als Datum einlesen</span></span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Spalte Zeit von [CET/CEST]</span></span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>] <span class="op">=</span> erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>].<span class="bu">str</span>.replace(pat <span class="op">=</span> <span class="st">'2A'</span>, repl <span class="op">=</span> <span class="st">'02'</span>)</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>] <span class="op">=</span> erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>].<span class="bu">str</span>.replace(pat <span class="op">=</span> <span class="st">'2B'</span>, repl <span class="op">=</span> <span class="st">'02'</span>)</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>] <span class="op">=</span> pd.to_datetime(erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M:%S"</span>)</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Spalte Zeit bis [CET/CEST]</span></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>] <span class="op">=</span> erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>].<span class="bu">str</span>.replace(pat <span class="op">=</span> <span class="st">'2A'</span>, repl <span class="op">=</span> <span class="st">'02'</span>)</span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>] <span class="op">=</span> erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>].<span class="bu">str</span>.replace(pat <span class="op">=</span> <span class="st">'2B'</span>, repl <span class="op">=</span> <span class="st">'02'</span>)</span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>] <span class="op">=</span> pd.to_datetime(erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M:%S"</span>)</span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(erzeugung_austria.info())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 35040 entries, 0 to 35039
Data columns (total 15 columns):
 #   Column                        Non-Null Count  Dtype         
---  ------                        --------------  -----         
 0   Zeit von [CET/CEST]           35040 non-null  datetime64[ns]
 1   Zeit bis [CET/CEST]           35040 non-null  datetime64[ns]
 2   Wind [MW]                     35040 non-null  float64       
 3   Solar [MW]                    35040 non-null  float64       
 4   Biomasse [MW]                 35040 non-null  float64       
 5   Gas [MW]                      35040 non-null  float64       
 6   Kohle [MW]                    35040 non-null  float64       
 7   Öl [MW]                       35040 non-null  float64       
 8   Geothermie [MW]               35040 non-null  float64       
 9   Pumpspeicher [MW]             35040 non-null  float64       
 10  Lauf- und Schwellwasser [MW]  35040 non-null  float64       
 11  Speicher [MW]                 35040 non-null  float64       
 12  Sonstige Erneuerbare [MW]     35040 non-null  float64       
 13  Müll [MW]                     35040 non-null  float64       
 14  Andere [MW]                   35040 non-null  float64       
dtypes: datetime64[ns](2), float64(13)
memory usage: 4.0 MB
None</code></pre>
</div>
</div>
<p><strong>Indexpositionen der doppelten und der fehlenden Stunde bestimmen</strong></p>
<p>Im nächsten Schritt werden die Indexposition der doppelten und der fehlenden Stunde bestimmt. Dazu wird ein neues Objekt angelegt, das auf den Speicherbereich der Datumsspalten zugreift (was nicht zwingend erforderlich ist). Die Position der doppelten Stunde wird mit der Methode <code>pd.Series.duplicated()</code> bestimmt, die einen logischen Vektor zurückgibt. Dieser wird zum Slicing und der Ausgabe der Indexposition verwendet. Durch die Subtraktion von 4 wird der Index der ersten Stunde ausgegeben (der Datensatz ist auf Viertelstundenbasis).</p>
<p><em>doppelte Stunde</em></p>
<div id="65b1ebb7" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># neues Objekt anlegen</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>austria_dates <span class="op">=</span> erzeugung_austria[[<span class="st">'Zeit von [CET/CEST]'</span>, <span class="st">'Zeit bis [CET/CEST]'</span>]].copy()</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Indexposition der doppelten Stunde bestimmen</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit von</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>position_doppelte_stunde_von <span class="op">=</span> austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>][austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>].duplicated()].index <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Die doppelte Stunde (Zeit von):</span><span class="ch">\n</span><span class="sc">{</span>austria_dates<span class="sc">.</span>loc[position_doppelte_stunde_von, <span class="st">'Zeit von [CET/CEST]'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">steht an Indexposition</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>position_doppelte_stunde_von<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die nächste Stunde lautet:</span><span class="ch">\n</span><span class="sc">{</span>austria_dates<span class="sc">.</span>loc[position_doppelte_stunde_von <span class="op">+</span> <span class="dv">4</span>, <span class="st">'Zeit von [CET/CEST]'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="ch">\n\n</span><span class="ss">Beide Stunden sind identisch."</span>)</span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a><span class="co">### Ende der Verschiebung in Spalte Zeit von</span></span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>ende_verschiebung_von <span class="op">=</span> position_doppelte_stunde_von[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Zeitverschiebung in der Spalte Zeit von endet bei Indexposition: </span><span class="sc">{</span>ende_verschiebung_von<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit bis</span></span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>position_doppelte_stunde_bis <span class="op">=</span> austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>][austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>].duplicated()].index <span class="op">-</span> <span class="dv">4</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n\n</span><span class="ss">Die doppelte Stunde (Zeit bis):</span><span class="ch">\n</span><span class="sc">{</span>austria_dates<span class="sc">.</span>loc[position_doppelte_stunde_bis, <span class="st">'Zeit bis [CET/CEST]'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">steht an Indexposition</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>position_doppelte_stunde_bis<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die nächste Stunde lautet:</span><span class="ch">\n</span><span class="sc">{</span>austria_dates<span class="sc">.</span>loc[position_doppelte_stunde_bis <span class="op">+</span> <span class="dv">4</span>, <span class="st">'Zeit bis [CET/CEST]'</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb247-21"><a href="#cb247-21" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="ch">\n\n</span><span class="ss">Beide Stunden sind identisch."</span>)</span>
<span id="cb247-22"><a href="#cb247-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-23"><a href="#cb247-23" aria-hidden="true" tabindex="-1"></a><span class="co">### Ende der Verschiebung in Spalte Zeit bis</span></span>
<span id="cb247-24"><a href="#cb247-24" aria-hidden="true" tabindex="-1"></a>ende_verschiebung_bis <span class="op">=</span> position_doppelte_stunde_bis[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb247-25"><a href="#cb247-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Zeitverschiebung in der Spalte Zeit bis endet bei Indexposition: </span><span class="sc">{</span>ende_verschiebung_bis<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Die doppelte Stunde (Zeit von):
28900   2023-10-29 02:00:00
28901   2023-10-29 02:15:00
28902   2023-10-29 02:30:00
28903   2023-10-29 02:45:00
Name: Zeit von [CET/CEST], dtype: datetime64[ns]
steht an Indexposition
 Index([28900, 28901, 28902, 28903], dtype='int64')

Die nächste Stunde lautet:
28904   2023-10-29 02:00:00
28905   2023-10-29 02:15:00
28906   2023-10-29 02:30:00
28907   2023-10-29 02:45:00
Name: Zeit von [CET/CEST], dtype: datetime64[ns]

Beide Stunden sind identisch.

Die Zeitverschiebung in der Spalte Zeit von endet bei Indexposition: 28903


Die doppelte Stunde (Zeit bis):
28899   2023-10-29 02:00:00
28900   2023-10-29 02:15:00
28901   2023-10-29 02:30:00
28902   2023-10-29 02:45:00
Name: Zeit bis [CET/CEST], dtype: datetime64[ns]
steht an Indexposition
 Index([28899, 28900, 28901, 28902], dtype='int64')

Die nächste Stunde lautet:
28903   2023-10-29 02:00:00
28904   2023-10-29 02:15:00
28905   2023-10-29 02:30:00
28906   2023-10-29 02:45:00
Name: Zeit bis [CET/CEST], dtype: datetime64[ns]

Beide Stunden sind identisch.

Die Zeitverschiebung in der Spalte Zeit bis endet bei Indexposition: 28902</code></pre>
</div>
</div>
<p><em>fehlende Stunde</em></p>
<p>Die Sommerzeit beginnt am letzen Sonntag im März. Die Stunde liegt nicht in range(0, 24). Diese Bedingung kann in vier Schritten kontrolliert werden:</p>
<ul>
<li><p>Monat März: <code>march = pd.Series[pd.Series.dt.month == 3]</code></p></li>
<li><p>Sonntage im März: <code>sundays = march[march.dt.dayofweek == 6]</code></p></li>
<li><p>letzter Sonntag im März: Die letzten 23*4 Einträge sind der letzte Sonntag des Monats (23 weil eine Stunde fehlt).<br>
<code>last_sunday = sundays[-23*4:]</code></p></li>
<li><p>fehlende Stunde: <code>np.argwhere(np.invert(pd.Series(range(0,24)).isin(last_sunday.dt.hour)))</code></p></li>
</ul>
<div id="80ecb7c2" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Indexposition der fehlenden Stunde bestimmen</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit von</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="co">### Monat März</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>maske_märz_von <span class="op">=</span> austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>].dt.month <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>austria_dates_march_von <span class="op">=</span> austria_dates.loc[maske_märz_von, <span class="st">'Zeit von [CET/CEST]'</span>]</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Monat März (Zeit von):</span><span class="ch">\n</span><span class="sc">{</span>austria_dates_march_von<span class="sc">.</span>head<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)<span class="op">;</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a><span class="co">### letzter Sonntag</span></span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>maske_sonntag_von <span class="op">=</span> (austria_dates_march_von.dt.dayofweek <span class="op">==</span> <span class="dv">6</span>)</span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>letzter_sonntag_von <span class="op">=</span> (austria_dates_march_von[maske_sonntag_von]) [<span class="op">-</span><span class="dv">23</span><span class="op">*</span><span class="dv">4</span> :]</span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der letzte Sonntag im März:</span><span class="ch">\n</span><span class="sc">{</span>letzter_sonntag_von<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a><span class="co">### fehlende Stunde</span></span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(letzter_sonntag_von.dt.hour)</span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>fehlende_stunde_von <span class="op">=</span> np.argwhere(np.invert(pd.Series(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">24</span>)).isin(letzter_sonntag_von.dt.hour))).item() </span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Es fehlt die Stunde:</span><span class="ch">\n</span><span class="sc">{</span>fehlende_stunde_von<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(letzter_sonntag_von[letzter_sonntag_von.dt.hour <span class="op">==</span> (fehlende_stunde_von <span class="op">-</span> <span class="dv">1</span>)], letzter_sonntag_von[letzter_sonntag_von.dt.hour <span class="op">==</span> (fehlende_stunde_von <span class="op">+</span> <span class="dv">1</span>)], sep <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a><span class="co">### Beginn der Verschiebung in Spalte Zeit von</span></span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a>beginn_verschiebung_von <span class="op">=</span> letzter_sonntag_von[letzter_sonntag_von.dt.hour <span class="op">==</span> (fehlende_stunde_von <span class="op">+</span> <span class="dv">1</span>)].index[<span class="dv">0</span>]</span>
<span id="cb249-21"><a href="#cb249-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-22"><a href="#cb249-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Zeitverschiebung in der Spalte Zeit von beginnt bei Indexposition: </span><span class="sc">{</span>beginn_verschiebung_von<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span>
<span id="cb249-23"><a href="#cb249-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-24"><a href="#cb249-24" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit bis</span></span>
<span id="cb249-25"><a href="#cb249-25" aria-hidden="true" tabindex="-1"></a><span class="co">### Monat März</span></span>
<span id="cb249-26"><a href="#cb249-26" aria-hidden="true" tabindex="-1"></a>maske_märz_bis <span class="op">=</span> austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>].dt.month <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb249-27"><a href="#cb249-27" aria-hidden="true" tabindex="-1"></a>austria_dates_march_bis <span class="op">=</span> austria_dates.loc[maske_märz_bis, <span class="st">'Zeit bis [CET/CEST]'</span>]</span>
<span id="cb249-28"><a href="#cb249-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Monat März (Zeit bis):</span><span class="ch">\n</span><span class="sc">{</span>austria_dates_march_bis<span class="sc">.</span>head<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)<span class="op">;</span></span>
<span id="cb249-29"><a href="#cb249-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-30"><a href="#cb249-30" aria-hidden="true" tabindex="-1"></a><span class="co">### letzter Sonntag</span></span>
<span id="cb249-31"><a href="#cb249-31" aria-hidden="true" tabindex="-1"></a>maske_sonntag_bis <span class="op">=</span> (austria_dates_march_bis.dt.dayofweek <span class="op">==</span> <span class="dv">6</span>)</span>
<span id="cb249-32"><a href="#cb249-32" aria-hidden="true" tabindex="-1"></a>letzter_sonntag_bis <span class="op">=</span> (austria_dates_march_bis[maske_sonntag_bis]) [<span class="op">-</span><span class="dv">23</span><span class="op">*</span><span class="dv">4</span> :]</span>
<span id="cb249-33"><a href="#cb249-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der letzte Sonntag im März:</span><span class="ch">\n</span><span class="sc">{</span>letzter_sonntag_bis<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb249-34"><a href="#cb249-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-35"><a href="#cb249-35" aria-hidden="true" tabindex="-1"></a><span class="co">### fehlende Stunde</span></span>
<span id="cb249-36"><a href="#cb249-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(letzter_sonntag_bis.dt.hour)</span>
<span id="cb249-37"><a href="#cb249-37" aria-hidden="true" tabindex="-1"></a>fehlende_stunde_bis <span class="op">=</span> np.argwhere(np.invert(pd.Series(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">24</span>)).isin(letzter_sonntag_bis.dt.hour))).item() </span>
<span id="cb249-38"><a href="#cb249-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Es fehlt die Stunde:</span><span class="ch">\n</span><span class="sc">{</span>fehlende_stunde_bis<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb249-39"><a href="#cb249-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(letzter_sonntag_bis[letzter_sonntag_bis.dt.hour <span class="op">==</span> (fehlende_stunde_bis <span class="op">-</span> <span class="dv">1</span>)], letzter_sonntag_bis[letzter_sonntag_bis.dt.hour <span class="op">==</span> (fehlende_stunde_bis <span class="op">+</span> <span class="dv">1</span>)], sep <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb249-40"><a href="#cb249-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-41"><a href="#cb249-41" aria-hidden="true" tabindex="-1"></a><span class="co">### Beginn der Verschiebung in Spalte Zeit bis</span></span>
<span id="cb249-42"><a href="#cb249-42" aria-hidden="true" tabindex="-1"></a>beginn_verschiebung_bis <span class="op">=</span> letzter_sonntag_bis[letzter_sonntag_bis.dt.hour <span class="op">==</span> (fehlende_stunde_bis <span class="op">+</span> <span class="dv">1</span>)].index[<span class="dv">0</span>]</span>
<span id="cb249-43"><a href="#cb249-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-44"><a href="#cb249-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Die Zeitverschiebung in der Spalte Zeit bis beginnt bei Indexposition: </span><span class="sc">{</span>beginn_verschiebung_bis<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Der Monat März (Zeit von):
&lt;bound method NDFrame.head of 5664   2023-03-01 00:00:00
5665   2023-03-01 00:15:00
5666   2023-03-01 00:30:00
5667   2023-03-01 00:45:00
5668   2023-03-01 01:00:00
               ...        
8631   2023-03-31 22:45:00
8632   2023-03-31 23:00:00
8633   2023-03-31 23:15:00
8634   2023-03-31 23:30:00
8635   2023-03-31 23:45:00
Name: Zeit von [CET/CEST], Length: 2972, dtype: datetime64[ns]&gt;

Der letzte Sonntag im März:
8064   2023-03-26 00:00:00
8065   2023-03-26 00:15:00
8066   2023-03-26 00:30:00
8067   2023-03-26 00:45:00
8068   2023-03-26 01:00:00
               ...        
8151   2023-03-26 22:45:00
8152   2023-03-26 23:00:00
8153   2023-03-26 23:15:00
8154   2023-03-26 23:30:00
8155   2023-03-26 23:45:00
Name: Zeit von [CET/CEST], Length: 92, dtype: datetime64[ns]

8064     0
8065     0
8066     0
8067     0
8068     1
        ..
8151    22
8152    23
8153    23
8154    23
8155    23
Name: Zeit von [CET/CEST], Length: 92, dtype: int32

Es fehlt die Stunde:
2

8068   2023-03-26 01:00:00
8069   2023-03-26 01:15:00
8070   2023-03-26 01:30:00
8071   2023-03-26 01:45:00
Name: Zeit von [CET/CEST], dtype: datetime64[ns]
8072   2023-03-26 03:00:00
8073   2023-03-26 03:15:00
8074   2023-03-26 03:30:00
8075   2023-03-26 03:45:00
Name: Zeit von [CET/CEST], dtype: datetime64[ns]

Die Zeitverschiebung in der Spalte Zeit von beginnt bei Indexposition: 8072


Der Monat März (Zeit bis):
&lt;bound method NDFrame.head of 5663   2023-03-01 00:00:00
5664   2023-03-01 00:15:00
5665   2023-03-01 00:30:00
5666   2023-03-01 00:45:00
5667   2023-03-01 01:00:00
               ...        
8630   2023-03-31 22:45:00
8631   2023-03-31 23:00:00
8632   2023-03-31 23:15:00
8633   2023-03-31 23:30:00
8634   2023-03-31 23:45:00
Name: Zeit bis [CET/CEST], Length: 2972, dtype: datetime64[ns]&gt;

Der letzte Sonntag im März:
8063   2023-03-26 00:00:00
8064   2023-03-26 00:15:00
8065   2023-03-26 00:30:00
8066   2023-03-26 00:45:00
8067   2023-03-26 01:00:00
               ...        
8150   2023-03-26 22:45:00
8151   2023-03-26 23:00:00
8152   2023-03-26 23:15:00
8153   2023-03-26 23:30:00
8154   2023-03-26 23:45:00
Name: Zeit bis [CET/CEST], Length: 92, dtype: datetime64[ns]

8063     0
8064     0
8065     0
8066     0
8067     1
        ..
8150    22
8151    23
8152    23
8153    23
8154    23
Name: Zeit bis [CET/CEST], Length: 92, dtype: int32

Es fehlt die Stunde:
2

8067   2023-03-26 01:00:00
8068   2023-03-26 01:15:00
8069   2023-03-26 01:30:00
8070   2023-03-26 01:45:00
Name: Zeit bis [CET/CEST], dtype: datetime64[ns]
8071   2023-03-26 03:00:00
8072   2023-03-26 03:15:00
8073   2023-03-26 03:30:00
8074   2023-03-26 03:45:00
Name: Zeit bis [CET/CEST], dtype: datetime64[ns]

Die Zeitverschiebung in der Spalte Zeit bis beginnt bei Indexposition: 8071</code></pre>
</div>
</div>
<p>Mit den gespeicherten Indexpositionen können die betreffenden Zeitstempel verschoben werden:</p>
<ul>
<li><p>Spalte Zeit von: 8072 (Objekt beginn_verschiebung_von) bis 28903 (Objekt ende_verschiebung_von)</p></li>
<li><p>Spalte Zeit bis: 8071 (Objekt beginn_verschiebung_bis) bis 28902 (Objekt ende_verschiebung_bis)</p></li>
</ul>
<p>Für das Slicing wird die Methode <code>pd.Series.iloc[]</code> verwendet, die exklusiv indexiert, d.&nbsp;h. die Endpositionen müssen um 1 erhöht werden. Durch Subtraktion von pd.Timedelta(1, unit = ‘h’) wird die Zeitverschiebung aus dem Datensatz entfernt.</p>
<div id="2f535038" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeitverschiebung korrigieren</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit von</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>].iloc[beginn_verschiebung_von : ende_verschiebung_von <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>].iloc[beginn_verschiebung_von : ende_verschiebung_von <span class="op">+</span> <span class="dv">1</span>].subtract(pd.Timedelta(<span class="dv">1</span>, unit <span class="op">=</span> <span class="st">'h'</span>))</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>] <span class="op">=</span> austria_dates[<span class="st">'Zeit von [CET/CEST]'</span>]</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Zeit bis</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>].iloc[beginn_verschiebung_bis : ende_verschiebung_bis <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>].iloc[beginn_verschiebung_bis : ende_verschiebung_bis <span class="op">+</span> <span class="dv">1</span>].subtract(pd.Timedelta(<span class="dv">1</span>, unit <span class="op">=</span> <span class="st">'h'</span>))</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>] <span class="op">=</span> austria_dates[<span class="st">'Zeit bis [CET/CEST]'</span>]</span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrolle</span></span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Kontrolle im Datensatz +/- eine Viertelstunde</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Die Spalte Zeit von"</span>)</span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(erzeugung_austria[<span class="st">'Zeit von [CET/CEST]'</span>].iloc[beginn_verschiebung_von <span class="op">-</span><span class="dv">1</span> : ende_verschiebung_von <span class="op">+</span> <span class="dv">2</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Die Spalte Zeit bis"</span>)</span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(erzeugung_austria[<span class="st">'Zeit bis [CET/CEST]'</span>].iloc[beginn_verschiebung_bis <span class="op">-</span><span class="dv">1</span> : ende_verschiebung_bis <span class="op">+</span> <span class="dv">2</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kontrolle im Datensatz +/- eine Viertelstunde

Die Spalte Zeit von
8071    2023-03-26 01:45:00
8072    2023-03-26 02:00:00
8073    2023-03-26 02:15:00
8074    2023-03-26 02:30:00
8075    2023-03-26 02:45:00
                ...        
28900   2023-10-29 01:00:00
28901   2023-10-29 01:15:00
28902   2023-10-29 01:30:00
28903   2023-10-29 01:45:00
28904   2023-10-29 02:00:00
Name: Zeit von [CET/CEST], Length: 20834, dtype: datetime64[ns] 

Die Spalte Zeit bis
8070    2023-03-26 01:45:00
8071    2023-03-26 02:00:00
8072    2023-03-26 02:15:00
8073    2023-03-26 02:30:00
8074    2023-03-26 02:45:00
                ...        
28899   2023-10-29 01:00:00
28900   2023-10-29 01:15:00
28901   2023-10-29 01:30:00
28902   2023-10-29 01:45:00
28903   2023-10-29 02:00:00
Name: Zeit bis [CET/CEST], Length: 20834, dtype: datetime64[ns] 
</code></pre>
</div>
</div>
<p>Zum Abschluss ein Hinweis:</p>
<pre><code>pd.date_range(start = "2023-01-01T00:00", end = "2023-12-31T23:45", freq = '15min')
pd.date_range(start = "2023-01-01T00:00", end = "2023-12-31T23:45", freq = '15min')</code></pre>
<p><strong>Ergänzen: Man hätte den Zeitindex auch einfach mit pd.daterange() generieren können. Dann muss man sich darum kümmern, wie kontrolliert wird, dass die Zeitstempel in den korrekten Zeilen eingetragen werden.</strong></p>
</div>
</div>
</div>
</section>
<section id="schwer-cape-ratio---ein-datensatz-voller-tücken" class="level4">
<h4 class="anchored" data-anchor-id="schwer-cape-ratio---ein-datensatz-voller-tücken">Schwer: CAPE Ratio - ein Datensatz voller Tücken</h4>
<p>Der Nobelpreisgewinner für Wirtschaftswissenschaften von 2013 Robert Shiller pflegt einen Datensatz mit monatlichen Kursdaten des amerikanischen Aktienindexes S&amp;P500 und weiteren Wirtschaftsindikatoren zur Berechnung des inflationsbereinigten Kurs-Gewinn-Verhältnisses (CAPE Ratio). Der Datensatz ist auf der <a href="https://shillerdata.com/">Webseite</a> von Robert Shiller verfügbar (<a href="https://img1.wsimg.com/blobby/go/e5e77e0b-59d1-44d9-ab25-4763ac982e53/downloads/ie_data.xls?ver=1712069253887">Direktlink zur XLS-Datei</a>). <strong>Lesen Sie den Datensatz ein.</strong></p>
<div style="font-size: 90%;">
<table class="table">
<thead>
<tr class="header">
<th>Daten</th>
<th>Dateiname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>monatliche Kursdaten S&amp;P500</td>
<td>shiller_data.xls</td>
</tr>
</tbody>
</table>
</div>
<div id="tip-shiller-data1" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-49-contents" aria-controls="callout-49" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;30: Hinweise und Musterlösung Shiller data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-49" class="callout-49-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Schauen Sie sich den Datensatz zunächst mit einem Tabellenkalkulationsprogramm an. Bemerkenswerte Auffälligkeiten sind:</p>
<ul>
<li><p>Metadaten in den Zeilen 2 und 3, in denen teilweise auch Spaltenbeschriftungen eingetragen sind, sowie am Ende des Datensatzes,</p></li>
<li><p>mehrzeilige Spaltenbeschriftungen,</p></li>
<li><p>Leerspalten P und N,</p></li>
<li><p>Kennzeichnung fehlender Werte durch ‘NA’ und leere Zellen ’’ sowie</p></li>
<li><p>abweichende Formatierung des Monats Oktober in der Spalte Date ‘YYYY-M’.</p></li>
</ul>
<div id="tip-shiller-data2" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-48-contents" aria-controls="callout-48" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;29: Lösungshilfe
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-48" class="callout-48-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Aufgrund der zahlreichen Auffälligkeiten ist es hilfreich, die Daten und die Kopfzeilen getrennt einzulesen. Den korrekten Zeilenindex können Sie entweder der ersten Betrachtung mit einem Tabellenkalkulationsprogramm entnehmen oder indem Sie einfach die ersten 10 oder 20 Zeilen des Datensatzes in Python einlesen. Dadurch können die Daten einfacher überblickt und mit Methoden der String-Bearbeitung manipuliert werden. In der Praxis ist es einfacher, die Spaltenbeschriftungen manuell mit dem Argument <code>names = Sequence of column labels to apply</code> einzutragen bzw. dies mit Hilfe eines Tabellenkalkulationsprogramms zu erledigen.</p>
<p>Außerdem empfiehlt es sich, schrittweise vorzugehen und für jedes Problem eine separate Lösung, mit Ausschnitten des Datensatzes bzw. mit dafür generierten Testdaten, zu entwickeln.</p>
<div id="tip-shiller-data3" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-47-contents" aria-controls="callout-47" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp&nbsp;28: Vollständige Musterlösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-47" class="callout-47-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Zum Einlesen wird die Funktion <code>pd.read_excel()</code> verwendet. Mit dem Argument <code>sheet_name</code> kann das Tabellenblatt Data ausgewählt werden. Über die Methode pd.head(n = 10) kann der Zeilenindex bestimmt werden, an dem der Tabellenkopf endet und die Daten beginnen. Es handelt sich um die achte Zeile, die in Python den Zeilenindex 7 hat.</p>
<p><strong>Kopf einlesen</strong></p>
<div id="6b7dceee" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'aufgaben/01-daten/shiller_data.xls'</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>shiller <span class="op">=</span> pd.read_excel(io <span class="op">=</span> dateipfad, sheet_name <span class="op">=</span> <span class="st">'Data'</span>)</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a><span class="co"># manuell Ende des Kopfs und Beginn der Daten identifizieren (auskommentiert)</span></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(shiller.head(n = 10), "\n")</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Kopf einlesen</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>shiller_head <span class="op">=</span> pd.read_excel(io <span class="op">=</span> dateipfad, sheet_name <span class="op">=</span> <span class="st">'Data'</span>, skiprows <span class="op">=</span> <span class="dv">1</span>, nrows <span class="op">=</span> <span class="dv">7</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_head, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_head.info()) <span class="co"># die leeren Spalten werden als numerisch erkannt</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                  0      1         2   \
0  Stock Market Data Used in "Irrational Exuberan...    NaN       NaN   
1                                 Robert J. Shiller     NaN       NaN   
2                                                NaN    NaN       NaN   
3                                                NaN    NaN       NaN   
4                                                NaN    S&amp;P       NaN   
5                                                NaN  Comp.  Dividend   
6                                               Date      P         D   

         3           4         5          6      7         8       9   ...  \
0       NaN         NaN       NaN        NaN    NaN       NaN     NaN  ...   
1       NaN         NaN       NaN        NaN    NaN       NaN     NaN  ...   
2       NaN         NaN       NaN        NaN    NaN       NaN     NaN  ...   
3       NaN    Consumer       NaN        NaN    NaN       NaN    Real  ...   
4       NaN       Price       NaN       Long    NaN       NaN   Total  ...   
5  Earnings       Index    Date     Interest   Real      Real  Return  ...   
6         E         CPI  Fraction  Rate GS10  Price  Dividend   Price  ...   

           12  13                  14  15      16       17       18  \
0  Cyclically NaN         Cyclically  NaN     NaN      NaN      NaN   
1    Adjusted NaN            Adjusted NaN     NaN      NaN      NaN   
2       Price NaN  Total Return Price NaN     NaN      NaN      NaN   
3    Earnings NaN            Earnings NaN     NaN  Monthly     Real   
4       Ratio NaN               Ratio NaN  Excess    Total    Total   
5    P/E10 or NaN         TR P/E10 or NaN    CAPE     Bond     Bond   
6        CAPE NaN             TR CAPE NaN   Yield  Returns  Returns   

                 19                 20                  21  
0               NaN                NaN                 NaN  
1               NaN                NaN                 NaN  
2               NaN                NaN                 NaN  
3               NaN                NaN                 NaN  
4           10 Year            10 Year        Real 10 Year  
5  Annualized Stock  Annualized Bonds   Excess Annualized   
6       Real Return        Real Return             Returns  

[7 rows x 22 columns] 

&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7 entries, 0 to 6
Data columns (total 22 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   0       3 non-null      object 
 1   1       3 non-null      object 
 2   2       2 non-null      object 
 3   3       2 non-null      object 
 4   4       4 non-null      object 
 5   5       2 non-null      object 
 6   6       3 non-null      object 
 7   7       2 non-null      object 
 8   8       2 non-null      object 
 9   9       4 non-null      object 
 10  10      2 non-null      object 
 11  11      4 non-null      object 
 12  12      7 non-null      object 
 13  13      0 non-null      float64
 14  14      7 non-null      object 
 15  15      0 non-null      float64
 16  16      3 non-null      object 
 17  17      4 non-null      object 
 18  18      4 non-null      object 
 19  19      3 non-null      object 
 20  20      3 non-null      object 
 21  21      3 non-null      object 
dtypes: float64(2), object(20)
memory usage: 1.3+ KB
None</code></pre>
</div>
</div>
<p><strong>Spaltenbeschriftungen isolieren</strong><br>
Anschließend kann der Kopf weiter bearbeitet werden, um die Spaltenbeschriftungen zu isolieren. Dafür gibt es verschiedene Möglichkeiten. Weitere Alternativen zur folgenden Variante finden Sie im nachfolgenden Beispiel. Spaltenweise erfolgt die Verkettung der Zeichenketten mit der Methode <code>pd.Series.str.cat()</code>, die nur für <code>pd.Series</code> verfügbar ist (weshalb mit einer Schleife die Spalten einzeln durchlaufen werden) und nur mit dem Datentyp ‘string’ verfügbar ist, was durch die Methode <code>astype('string')</code> sichergestellt wird.</p>
<p>Anschließend werden nicht zur Spaltenbeschriftung gehörende Zeichenketten mit der Methode <code>str.replace()</code> entfernt. Dabei erweist sich das Argument <code>regex = True</code> als nützlich.</p>
<div id="e6ed0e54" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltenbeschriftung mit Schleife erzeugen</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> pd.Series()</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> shiller_head:</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>  shiller_column_labels <span class="op">=</span> pd.concat([shiller_column_labels, pd.Series(shiller_head[column].astype(<span class="st">'string'</span>).<span class="bu">str</span>.cat())])</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeichenketten säubern</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a><span class="co">## erste Zelle entfernen Stock Market Data Used in "Irrational Exuberan...</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.astype(<span class="st">'str'</span>).replace(shiller_head.loc[<span class="dv">0</span>, <span class="dv">0</span>], <span class="st">''</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="co">## 'Robert J. Shiller' entfernen </span></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.astype(<span class="st">'str'</span>).replace(shiller_head.loc[<span class="dv">1</span>, <span class="dv">0</span>], <span class="st">''</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Leerzeichen entfernen</span></span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a><span class="co">## regex = True um Leerzeichen innerhalb von Strings zu entfernen</span></span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.astype(<span class="st">'str'</span>).replace(<span class="st">' '</span>, <span class="st">''</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a><span class="co">## sehr lange strings ersetzen</span></span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.astype(<span class="st">'str'</span>).replace(<span class="st">'CyclicallyAdjustedPriceEarningsRatioP/E10or'</span>, <span class="st">''</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.astype(<span class="st">'str'</span>).replace(<span class="st">'CyclicallyAdjustedTotalReturnPriceEarningsRatioTRP/E10or'</span>, <span class="st">''</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a><span class="co">## Index zurücksetzen</span></span>
<span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a>shiller_column_labels.reset_index(inplace <span class="op">=</span> <span class="va">True</span>, drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_column_labels)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0                                  Date
1                             S&amp;PComp.P
2                             DividendD
3                             EarningsE
4                 ConsumerPriceIndexCPI
5                          DateFraction
6                  LongInterestRateGS10
7                             RealPrice
8                          RealDividend
9                  RealTotalReturnPrice
10                         RealEarnings
11                 RealTRScaledEarnings
12                                 CAPE
13                                     
14                               TRCAPE
15                                     
16                      ExcessCAPEYield
17              MonthlyTotalBondReturns
18                 RealTotalBondReturns
19      10YearAnnualizedStockRealReturn
20      10YearAnnualizedBondsRealReturn
21    Real10YearExcessAnnualizedReturns
dtype: object</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-46-contents" aria-controls="callout-46" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Alternative Vorgehensweisen zur String-Manipulation des Dateikopfs
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-46" class="callout-46-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="verwendung-des-numpy-datentyps-str" class="level4">
<h4 class="anchored" data-anchor-id="verwendung-des-numpy-datentyps-str">Verwendung des NumPy-Datentyps ‘str’</h4>
<p>Die Angabe von dtype = ‘str’ führt zur Verwendung des NumPy-Datentyps string (dtype = ‘str’), der veränderlich (mutable) ist. Nur damit funktioniert die Verkettung von Strings mit der Methode <code>PD.df.sum()</code>.</p>
<div id="0cbe6be0" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Der NumPy-Datentyp string ist veränderlich</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>my_array <span class="op">=</span> np.array([[<span class="st">'1'</span>, <span class="st">'2'</span>], [<span class="st">'3'</span>, <span class="st">'4'</span>]])</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>my_array[<span class="dv">0</span>] <span class="op">=</span> [<span class="st">'a'</span>, <span class="st">'b'</span>]</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>my_array</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<pre><code>array([['a', 'b'],
       ['3', '4']], dtype='&lt;U1')</code></pre>
</div>
</div>
<p>Mit den Pandas-Datentypen ‘string’ und ‘object’ funktioniert das gezeigte Vorgehen nicht. Denn Pandas nutzt den Python-Datentyp ‘string’, der unveränderlich ist. Das bedeutet, es gibt keine Methoden, die eine angelegte Zeichenkette verändern können. Stattdessen geben Methoden wie str.replace() neue strings zurück.</p>
<pre class="raw"><code>## mit NumPy-Datentyp string
shiller_head = pd.read_excel(io = dateipfad, sheet_name = 'Data', skiprows = 1, nrows = 7, header = None)

# Kopf mit NumPy-Datentyp string mit pd.sum() verketten
# print(shiller_head.astype('str').sum(skipna = True, axis = 0))

## Bereinigung des Datensatzes
### nan entfernen
shiller_head = shiller_head.astype('str').replace('nan', '')

### erste Zelle entfernen Stock Market Data Used in "Irrational Exuberan...
shiller_head = shiller_head.astype('str').replace(shiller_head.loc[0, 0], '')

### 'Robert J. Shiller' entfernen 
shiller_head = shiller_head.astype('str').replace(shiller_head.loc[1, 0], '')

### Leerzeichen entfernen
### regex = True um Leerzeichen innerhalb von Strings zu entfernen
shiller_head = shiller_head.astype('str').replace(' ', '', regex = True)

### sehr lange strings ersetzen
shiller_head = shiller_head.astype('str').replace('CyclicallyAdjustedPriceEarningsRatioP/E10or', '', regex = True)
shiller_head = shiller_head.astype('str').replace('CyclicallyAdjustedTotalReturnPriceEarningsRatioTRP/E10or', '', regex = True)

### spaltenweise Zeilen verketten
shiller_head = shiller_head.astype('str').sum(skipna = True, axis = 0)

print("\nzusammengeführte Spaltennamen\n", shiller_head)</code></pre>
</section>
<section id="verwendung-von-df.agg-oder-df.apply" class="level4">
<h4 class="anchored" data-anchor-id="verwendung-von-df.agg-oder-df.apply">Verwendung von DF.agg() oder DF.apply()</h4>
<p>Die Pandas-Methode <code>DF.agg()</code> aggregiert einen DataFrame zeilen- oder spaltenweise durch eine spezifizierbare Funktion. Die Pandas-Methode wendet eine Funktion zeilen- oder spaltenweise auf einen DataFrame <code>DF.apply()</code> an. Die Methoden machen also das selbe. Details zur Verwendung des <a href="https://docs.python.org/3/reference/expressions.html#lambda">Lambda-Ausdrucks</a> und der Methode <code>join</code> aus der <a href="https://www.w3schools.com/python/ref_string_join.asp">Pythonbasis</a> finden Sie in den angegebenen Links.</p>
<pre class="raw"><code>shiller_head = pd.read_excel(io = dateipfad, sheet_name = 'Data', skiprows = 1, nrows = 7, header = None)
# DF.agg()
print(shiller_head.agg(lambda x: ''.join(x.astype(str))))

# DF.apply
print(shiller_head.apply(lambda x: ''.join(x.astype(str))))</code></pre>
</section>
</div>
</div>
</div>
<p><strong>Daten einlesen</strong></p>
<p>Beim Einlesen der Daten wird der Kopf kontrolliert sowie mit der Methode <code>.tail()</code> das Ende der Datenreihe bestimmt, an dem weitere Metadaten vermerkt sind. Diese Metadaten werden anschließend mit dem Argument <code>skipfooter = 1</code> übersprungen.</p>
<div id="a0b14ff7" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>dateipfad <span class="op">=</span> <span class="st">'aufgaben/01-daten/shiller_data.xls'</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten einlesen</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>shiller_data <span class="op">=</span> pd.read_excel(io <span class="op">=</span> dateipfad, sheet_name <span class="op">=</span> <span class="st">'Data'</span>, skiprows <span class="op">=</span> <span class="dv">8</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.head(n <span class="op">=</span> <span class="dv">2</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>shiller_data.tail(n <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0     1     2    3      4        5     6       7     8       9   ...  \
0  1871.01  4.44  0.26  0.4  12.46  1871.04  5.32  111.06  6.50  111.06  ...   
1  1871.02   4.5  0.26  0.4  12.84  1871.12  5.32  109.22  6.31  109.75  ...   

   12  13  14  15  16   17    18    19    20    21  
0 NaN NaN NaN NaN NaN  1.0  1.00  0.13  0.09  0.04  
1 NaN NaN NaN NaN NaN  1.0  0.97  0.13  0.09  0.04  

[2 rows x 22 columns] 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="138">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
<th data-quarto-table-cell-role="th">14</th>
<th data-quarto-table-cell-role="th">15</th>
<th data-quarto-table-cell-role="th">16</th>
<th data-quarto-table-cell-role="th">17</th>
<th data-quarto-table-cell-role="th">18</th>
<th data-quarto-table-cell-role="th">19</th>
<th data-quarto-table-cell-role="th">20</th>
<th data-quarto-table-cell-role="th">21</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1836</td>
<td>2024.01</td>
<td>4815.61</td>
<td>70.48</td>
<td>NaN</td>
<td>308.42</td>
<td>2024.04</td>
<td>4.06</td>
<td>4867.78</td>
<td>71.24</td>
<td>3.22e+06</td>
<td>...</td>
<td>32.05</td>
<td>NaN</td>
<td>34.62</td>
<td>NaN</td>
<td>0.02</td>
<td>0.99</td>
<td>39.84</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1837</td>
<td>2024.02</td>
<td>5011.96</td>
<td>70.65</td>
<td>NaN</td>
<td>310.33</td>
<td>2024.12</td>
<td>4.21</td>
<td>5035.09</td>
<td>70.98</td>
<td>3.34e+06</td>
<td>...</td>
<td>33.11</td>
<td>NaN</td>
<td>35.79</td>
<td>NaN</td>
<td>0.02</td>
<td>1.00</td>
<td>39.25</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1838</td>
<td>2024.03</td>
<td>5170.57</td>
<td>70.82</td>
<td>NaN</td>
<td>311.28</td>
<td>2024.21</td>
<td>4.21</td>
<td>5178.50</td>
<td>70.93</td>
<td>3.43e+06</td>
<td>...</td>
<td>34.02</td>
<td>NaN</td>
<td>36.79</td>
<td>NaN</td>
<td>0.02</td>
<td>1.00</td>
<td>39.27</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1839</td>
<td>2024.04</td>
<td>5243.77</td>
<td>NaN</td>
<td>NaN</td>
<td>311.76</td>
<td>2024.29</td>
<td>4.2</td>
<td>5243.77</td>
<td>NaN</td>
<td>3.48e+06</td>
<td>...</td>
<td>34.41</td>
<td>NaN</td>
<td>37.18</td>
<td>NaN</td>
<td>0.01</td>
<td>NaN</td>
<td>39.37</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1840</td>
<td>NaN</td>
<td>Apr price is Apr 1st close</td>
<td>NaN</td>
<td>NaN</td>
<td>Mar/Apr CPI estimated</td>
<td>NaN</td>
<td>Apr GS10 is Mar 29th value</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Nachdem die Metadaten entfernt wurden, werden die erkannten Datentypen mit der Methode <code>.info()</code> kontrolliert.</p>
<div id="81687651" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>shiller_data <span class="op">=</span> pd.read_excel(io <span class="op">=</span> dateipfad, sheet_name <span class="op">=</span> <span class="st">'Data'</span>, skiprows <span class="op">=</span> <span class="dv">8</span>, header <span class="op">=</span> <span class="va">None</span>, skipfooter <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.head(n <span class="op">=</span> <span class="dv">2</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.tail(n <span class="op">=</span> <span class="dv">2</span>))</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Datentypen bestimmen</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>shiller_data.info()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0     1     2    3      4        5     6       7     8       9   ...  \
0  1871.01  4.44  0.26  0.4  12.46  1871.04  5.32  111.06  6.50  111.06  ...   
1  1871.02  4.50  0.26  0.4  12.84  1871.12  5.32  109.22  6.31  109.75  ...   

   12  13  14  15  16   17    18    19    20    21  
0 NaN NaN NaN NaN NaN  1.0  1.00  0.13  0.09  0.04  
1 NaN NaN NaN NaN NaN  1.0  0.97  0.13  0.09  0.04  

[2 rows x 22 columns] 

           0        1      2   3       4        5     6        7      8   \
1838  2024.03  5170.57  70.82 NaN  311.28  2024.21  4.21  5178.50  70.93   
1839  2024.04  5243.77    NaN NaN  311.76  2024.29  4.20  5243.77    NaN   

            9   ...     12  13     14  15    16   17     18  19  20  21  
1838  3.43e+06  ...  34.02 NaN  36.79 NaN  0.02  1.0  39.27 NaN NaN NaN  
1839  3.48e+06  ...  34.41 NaN  37.18 NaN  0.01  NaN  39.37 NaN NaN NaN  

[2 rows x 22 columns]
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1840 entries, 0 to 1839
Data columns (total 22 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   0       1840 non-null   float64
 1   1       1840 non-null   float64
 2   2       1839 non-null   float64
 3   3       1836 non-null   float64
 4   4       1840 non-null   float64
 5   5       1840 non-null   float64
 6   6       1840 non-null   float64
 7   7       1840 non-null   float64
 8   8       1839 non-null   float64
 9   9       1840 non-null   float64
 10  10      1836 non-null   float64
 11  11      1836 non-null   float64
 12  12      1720 non-null   float64
 13  13      0 non-null      float64
 14  14      1720 non-null   float64
 15  15      0 non-null      float64
 16  16      1720 non-null   float64
 17  17      1839 non-null   float64
 18  18      1840 non-null   float64
 19  19      1720 non-null   float64
 20  20      1720 non-null   float64
 21  21      1720 non-null   float64
dtypes: float64(22)
memory usage: 316.4 KB</code></pre>
</div>
</div>
<p><strong>Kopf und Daten zusammenführen</strong></p>
<p>Die Spalten mit dem Index 13 (Spalte N) und 15 (Spalte P) sind leer, diese werden aus dem Kopf und den Daten entfernt. Alle Spalten werden als Fließkommazahl erkannt. Das bedeutet, die Prozentzeichen in den Spalten mit den Indizes 16 und 19 bis 21 (Q, T:V) wurden durch eine Division durch 100 verarbeitet. Mit Ausnahme der Spalte Date wurde somit alle Datentypen korrekt erkannt.</p>
<div id="04964b9e" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # leere Spalten entfernen</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>shiller_column_labels <span class="op">=</span> shiller_column_labels.drop(labels <span class="op">=</span> [<span class="dv">13</span>, <span class="dv">15</span>])</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>shiller_data <span class="op">=</span> shiller_data.drop(labels <span class="op">=</span> [<span class="dv">13</span>, <span class="dv">15</span>], axis <span class="op">=</span> <span class="st">'columns'</span>)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Spaltennamen eintragen</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>shiller_data.columns <span class="op">=</span> shiller_column_labels</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>shiller_data.info()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1840 entries, 0 to 1839
Data columns (total 20 columns):
 #   Column                             Non-Null Count  Dtype  
---  ------                             --------------  -----  
 0   Date                               1840 non-null   float64
 1   S&amp;PComp.P                          1840 non-null   float64
 2   DividendD                          1839 non-null   float64
 3   EarningsE                          1836 non-null   float64
 4   ConsumerPriceIndexCPI              1840 non-null   float64
 5   DateFraction                       1840 non-null   float64
 6   LongInterestRateGS10               1840 non-null   float64
 7   RealPrice                          1840 non-null   float64
 8   RealDividend                       1839 non-null   float64
 9   RealTotalReturnPrice               1840 non-null   float64
 10  RealEarnings                       1836 non-null   float64
 11  RealTRScaledEarnings               1836 non-null   float64
 12  CAPE                               1720 non-null   float64
 13  TRCAPE                             1720 non-null   float64
 14  ExcessCAPEYield                    1720 non-null   float64
 15  MonthlyTotalBondReturns            1839 non-null   float64
 16  RealTotalBondReturns               1840 non-null   float64
 17  10YearAnnualizedStockRealReturn    1720 non-null   float64
 18  10YearAnnualizedBondsRealReturn    1720 non-null   float64
 19  Real10YearExcessAnnualizedReturns  1720 non-null   float64
dtypes: float64(20)
memory usage: 287.6 KB</code></pre>
</div>
</div>
<p><strong>Datumsformat korrigieren</strong></p>
<p>Im nächsten Schritt wird das Datumsformat korrigiert. Die Spalte Date enthält Zeichenketten im Format ‘YYYY,MM’. Eine Ausnahme ist der Monat Oktober, der im Format ‘YYYY.M’ kodiert ist. In der Ausgabe mit <code>print()</code> ist dies nicht zu sehen, da die Darstellung von 2 Dezimalstellen mit dem Befehl <code>pd.set_option("display.precision", 2)</code> eingestellt wurde. Die unterschiedliche Länge der Zeichketten kann mit dem Befehl <code>shiller_data.loc[0:12, 'Date'].astype('str').str.len()</code> verdeutlicht werden.</p>
<div id="9ce07207" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>], <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>  pd.to_datetime(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y.%m"</span>)</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> error:</span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(error, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>  pd.to_datetime(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y.%m"</span>)</span>
<span id="cb268-9"><a href="#cb268-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-10"><a href="#cb268-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>].astype(<span class="st">'str'</span>).<span class="bu">str</span>.<span class="bu">len</span>(), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0     1871.01
1     1871.02
2     1871.03
3     1871.04
4     1871.05
5     1871.06
6     1871.07
7     1871.08
8     1871.09
9     1871.10
10    1871.11
11    1871.12
12    1872.01
Name: Date, dtype: float64 

time data "1871" doesn't match format "%Y.%m", at position 0. You might want to try:
    - passing `format` if your strings have a consistent format;
    - passing `format='ISO8601'` if your strings are all ISO8601 but not necessarily in exactly the same format;
    - passing `format='mixed'`, and the format will be inferred for each element individually. You might want to use `dayfirst` alongside this. 

0     7
1     7
2     7
3     7
4     7
5     7
6     7
7     7
8     7
9     6
10    7
11    7
12    7
Name: Date, dtype: int64 
</code></pre>
</div>
</div>
<p>Der Datentyp der Spalte ‘Date’ wird als String deklariert. Mit einer Maske werden die Zeichenketten mit Länge 6 bestimmt. An die Zeichenketten mit der Länge 6 wird eine 0 angehängt, um das Datumsformat anzugleichen. Anschließend wird die Spalte mit der Funktion <code>pd.to_datetime(format = "%Y.%m")</code> als datetime eingelesen.</p>
<div id="6db946d3" class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datentyp Spalte Date als String setzen </span></span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="co"># führt zu einer Fehlermeldung:</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>shiller_data[<span class="st">'Date'</span>] <span class="op">=</span> shiller_data[<span class="st">'Date'</span>].astype(<span class="st">'str'</span>)<span class="op">;</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>maske <span class="op">=</span> shiller_data[<span class="st">'Date'</span>].<span class="bu">str</span>.<span class="bu">len</span>() <span class="op">==</span> <span class="dv">6</span></span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>shiller_data.loc[maske, <span class="st">'Date'</span>] <span class="op">=</span> shiller_data.loc[maske, <span class="st">'Date'</span>] <span class="op">+</span> <span class="st">'0'</span></span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ausgabe Länge Zeichenkette</span></span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>].<span class="bu">str</span>.<span class="bu">len</span>())</span>
<span id="cb270-10"><a href="#cb270-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shiller_data.loc[<span class="dv">0</span>:<span class="dv">12</span>, <span class="st">'Date'</span>])</span>
<span id="cb270-11"><a href="#cb270-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-12"><a href="#cb270-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Datentyp Spalte Date als datetime setzen</span></span>
<span id="cb270-13"><a href="#cb270-13" aria-hidden="true" tabindex="-1"></a>shiller_data[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(shiller_data[<span class="st">'Date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y.%m"</span>)<span class="op">;</span></span>
<span id="cb270-14"><a href="#cb270-14" aria-hidden="true" tabindex="-1"></a>shiller_data.info()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0     7
1     7
2     7
3     7
4     7
5     7
6     7
7     7
8     7
9     7
10    7
11    7
12    7
Name: Date, dtype: int64
0     1871.01
1     1871.02
2     1871.03
3     1871.04
4     1871.05
5     1871.06
6     1871.07
7     1871.08
8     1871.09
9     1871.10
10    1871.11
11    1871.12
12    1872.01
Name: Date, dtype: object
&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1840 entries, 0 to 1839
Data columns (total 20 columns):
 #   Column                             Non-Null Count  Dtype         
---  ------                             --------------  -----         
 0   Date                               1840 non-null   datetime64[ns]
 1   S&amp;PComp.P                          1840 non-null   float64       
 2   DividendD                          1839 non-null   float64       
 3   EarningsE                          1836 non-null   float64       
 4   ConsumerPriceIndexCPI              1840 non-null   float64       
 5   DateFraction                       1840 non-null   float64       
 6   LongInterestRateGS10               1840 non-null   float64       
 7   RealPrice                          1840 non-null   float64       
 8   RealDividend                       1839 non-null   float64       
 9   RealTotalReturnPrice               1840 non-null   float64       
 10  RealEarnings                       1836 non-null   float64       
 11  RealTRScaledEarnings               1836 non-null   float64       
 12  CAPE                               1720 non-null   float64       
 13  TRCAPE                             1720 non-null   float64       
 14  ExcessCAPEYield                    1720 non-null   float64       
 15  MonthlyTotalBondReturns            1839 non-null   float64       
 16  RealTotalBondReturns               1840 non-null   float64       
 17  10YearAnnualizedStockRealReturn    1720 non-null   float64       
 18  10YearAnnualizedBondsRealReturn    1720 non-null   float64       
 19  Real10YearExcessAnnualizedReturns  1720 non-null   float64       
dtypes: datetime64[ns](1), float64(19)
memory usage: 287.6 KB</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="zeitzonen-in-numpy-und-pandas" class="level3">
<h3 class="anchored" data-anchor-id="zeitzonen-in-numpy-und-pandas">Zeitzonen in NumPy und Pandas</h3>
<section id="zeitzonen-mit-numpy-verwalten" class="level4">
<h4 class="anchored" data-anchor-id="zeitzonen-mit-numpy-verwalten">Zeitzonen mit NumPy verwalten</h4>
<p>–&gt; NumPy unterstützt das gar nicht, es reicht zu zeigen, wie es eingelesen wird. <strong>hier bräuchten wir britische, portugisische oder osteuropäische Daten, um einen Zeitversatz zu demonstrieren</strong></p>
<p><code>datetime64[ns, tz]</code></p>
</section>
<section id="zeitzonen-mit-pandas-verwalten" class="level4">
<h4 class="anchored" data-anchor-id="zeitzonen-mit-pandas-verwalten">Zeitzonen mit Pandas verwalten</h4>
<p>http://pandas.pydata.org/pandas-docs/dev/user_guide/timeseries.html#time-zone-handling</p>
<p>datetime and time objects have an optional time zone information attribute, tzinfo, that can be set to an instance of a subclass of the abstract tzinfo class. (https://docs.python.org/3/library/datetime.html#) <strong>Das kann doch nicht so kompliziert sein?! Die Dokumentation des Moduls ist auch interessant. Es löst einige Probleme mit dem Ende der Sommerzeitumstellung. <a href="https://pythonhosted.org/pytz/" class="uri">https://pythonhosted.org/pytz/</a></strong></p>
</section>
<section id="grobe-planung-a-analyse-von-zeitdaten" class="level4 border">
<h4 class="anchored" data-anchor-id="grobe-planung-a-analyse-von-zeitdaten">Grobe Planung a-Analyse von Zeitdaten</h4>
<ul>
<li><p>pandas, matplotlib, scikit-learn?</p></li>
<li><p>Datenvorbereitung und -bereinigung: Umgang mit fehlenden Werten und Ausreißern</p></li>
<li><p>Trends und Saisonalität</p></li>
<li><p>Autokorrelation?</p></li>
<li><p>Modellierung und Vorhersagen</p></li>
<li><p>Evaluierung von Vorhersagen</p></li>
</ul>
</section>
<p>Welches Datum ist heute? Das hängt vom Kalender ab: Gregorianischer Kalender in Europa, jüdischer Kalender in Israel, islamischer Kalender, Suriyakati-Kalender in Thailand (hatte ich in der Diss), Astronomische Zählweise (NumPy)</p>
<p>Unterschied NumPy und Python wird hier erklärt: https://numpy.org/doc/stable/reference/arrays.datetime.html</p>
<p>naive und aware time (aware kennt Zeitzonen, naive nicht): https://numpy.org/doc/stable/reference/arrays.datetime.html#datetime64-conventions-and-assumptions</p>
<p><strong>Fehlersuche und -bereinigung: Kalender prüfen</strong></p>
<p><strong>Mit Pandas und/oder NumPy SMARD-Datensätze einlesen, die gibt es in Deutsch und Englisch mit entsprechendem Datumsformat - siehe Material</strong></p>
</section>
</section>
<section id="fehlende-werte-in-zeitreihen" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="fehlende-werte-in-zeitreihen"><span class="header-section-number">6.6</span> fehlende Werte in Zeitreihen</h2>
<p>NumPy und Pandas unterstützen <code>NaT</code> für <code>np.datetime64</code>, <code>np.timedelta64</code></p>
<ul>
<li><p>NumPy: <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html" class="uri">https://numpy.org/doc/stable/reference/arrays.datetime.html</a><br>
<code>NAT</code>, in any combination of lowercase/uppercase letters, for a “Not A Time”</p></li>
<li><p>Pandas: <a href="https://pandas.pydata.org/docs/user_guide/missing_data.html" class="uri">https://pandas.pydata.org/docs/user_guide/missing_data.html</a></p></li>
</ul>
<div id="wrn-logicNaT" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-50-contents" aria-controls="callout-50" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;10: Achtung Logik!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-50" class="callout-50-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Die logische Abfrage fehlender Werte unterscheidet sich für <code>None</code>, <code>np.nan</code> und <code>pd.NA</code> und <code>pd.NaT</code>.</p>
<div id="8b562457" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>bool_values <span class="op">=</span> [<span class="va">None</span>, <span class="bu">float</span>(<span class="st">'NaN'</span>), pd.NA, pd.NaT]</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>    bool_value <span class="op">=</span> <span class="bu">bool</span>(element)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(error)</span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Wahrheitswert von"</span>, element, <span class="st">"ist"</span>, bool_value)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wahrheitswert von None ist False
Wahrheitswert von nan ist True
boolean value of NA is ambiguous
Wahrheitswert von NaT ist True</code></pre>
</div>
</div>
<p>Dies gilt auch für die logische Identität.</p>
<div id="09984010" class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> element <span class="kw">in</span> bool_values:</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> element <span class="op">==</span> element</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(error)</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb274-7"><a href="#cb274-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Identität von"</span>, element, <span class="st">"ist"</span>, result)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Identität von None ist True
Identität von nan ist False
Identität von &lt;NA&gt; ist &lt;NA&gt;
Identität von NaT ist False</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="zugriff-auf-mehrere-lokale-dateien-modul-glob" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Zugriff auf mehrere lokale Dateien: Modul glob</h1>
<p>Das Modul glob</p>
</section>
<section id="datensätze-organisieren" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Datensätze organisieren</h1>
<p>In diesem Abschnitt werden typische Herausforderungen beim Einlesen strukturierter Datensätze behandelt und Werkzeuge aus den Modulen NumPy und Pandas vorgestellen, um Probleme zu identifizieren und zu beheben. Dazu wird einführend mit tidy data ein grundlegendes Konzept zur Organisation von Datensätzen vorgestellt.</p>
<section id="sec-tidydata" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-tidydata"><span class="header-section-number">8.1</span> Tidy data</h2>
<p><strong>Konzept als Einführung gedacht: Was ist überhaupt das Ziel des Einlesens? (ist aber inkompatibel mit dem Multiindex in Python [und den fehlenden Spaltenbeschriftungen in Numpy])</strong></p>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[5, 90, 5]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Tidy datasets are all alike, but every messy dataset is messy in its own way.” <span class="citation" data-cites="R-for-Data-Science">(<a href="#ref-R-for-Data-Science" role="doc-biblioref">Wickham, Çetinkaya-Rundel, und Grolemund 2023, Kap. 5</a> Data tidying)</span></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<p>Tidy data ist ein System von Hadley Wickham, das dabei hilft, Datensätze in ein aufgeräumtes (tidy) Format zu bringen. Das Aufräumen von Datensätzen ist eine vorbereitende Tätigkeit mit dem Ziel, während der eigentlichen Datenanlyse möglichst wenig Zeit für das Umformen von Datenstrukturen aufwenden zu müssen. Dadurch soll ein größerer Fokus auf den inhaltlichen Aspekt der Datenanalyse ermöglicht werden. <span class="citation" data-cites="R-for-Data-Science">(<a href="#ref-R-for-Data-Science" role="doc-biblioref">Wickham, Çetinkaya-Rundel, und Grolemund 2023, Kap. 5</a> Data tidying)</span></p>
<div id="imp-tidy-data" class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definition&nbsp;2: tidy data
</div>
</div>
<div class="callout-body-container callout-body">
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[[5, 90, 5], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“Das System tidy data besteht aus drei Regeln:</p>
<ol type="1">
<li><p>Jede Variable ist eine Spalte; jede Spalte ist eine Variabe.</p></li>
<li><p>Jede Beobachtung ist eine Zeile; jede Zeile ist eine Beobachtung.</p></li>
<li><p>Jeder Wert ist eine Zelle; jede Zelle ist ein einzelner Wert.”</p></li>
</ol>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p><span class="citation" data-cites="R-for-Data-Science">(<a href="#ref-R-for-Data-Science" role="doc-biblioref">Wickham, Çetinkaya-Rundel, und Grolemund 2023, Kap. 5</a> Data tidying)</span></p>
</div>
</div>
</div>
</div>
</div>
<p>Tidy data bezieht sich auf zweidimensionale Datensätze, bietet aber auch darüber hinaus eine Orientierung, um unterschiedlich aufgebaute Datensätze strukturiert einzulesen und für die Datenanalyse vorzubereiten. Tidy data ist kein strikt zu befolgendes Regelwerk. Es ist völlig in Ordnung, eine andere Struktur zu wählen, Wenn die Datenanalyse damit leichter durchgeführt werden kann.</p>
<p><strong>Hinweis: <code>dtype=object</code> erscheint immer, wenn der Datentyp nicht zugeordnet werden kann. type(object) ist etwas anderes als object.dtype. Erstes bestimmt den Objekttyp, zum Beispiel Liste oder Numpy-Array. Zweiteres bestimmt den Datentyp (Ganzzahl, String). Ich glaube, <code>dtype=object</code> ist eine Liste von Zeigern auf Objekte im Speicher. Dazu habe ich aber nur eine <a href="https://stackoverflow.com/a/29877845">Erklärung auf Stackoverflow</a> gefunden, aber nichts in der Dokumentation.</strong></p>
</section>
</section>
<section id="räumliche-daten" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Räumliche Daten</h1>
<p>netCDF mit eigenem Namensschema: dimensions (Name, Datentyp und Länge der Variablen), data variables (die eigentlichen Datensätze), attributes (Informationen über die Daten).</p>
</section>
<section id="strategien-der-fehlersuche-und-bereinigung" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Strategien der Fehlersuche und Bereinigung</h1>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[[5, 90, 5], [1], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>“everybody I know has war stories about cleaning up lousy datasets”<br>
Nicholas J. Cox</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p>Cox, Nicholas J. 2004: Exploratory Data Mining and Data Cleaning. Book Review 9. In: Journal of Statistical Software 2004, Volume 11. <a href="https://www.jstatsoft.org/article/view/v011b09/30" class="uri">https://www.jstatsoft.org/article/view/v011b09/30</a></p>
</div>
</div>
</div>
<section id="werte-plausibilisieren" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="werte-plausibilisieren"><span class="header-section-number">10.1</span> Werte plausibilisieren</h2>
<ol type="1">
<li><p>zulässigen Wertebereich prüfen</p></li>
<li><p>zulässige Werte auf Konsistenz mit fachlicher, ggf. Alltagserfahrung prüfen Ein Beispiel für Alltagserfahrung: <a href="https://www.youtube.com/watch?v=FcxiSwZcPvw" class="uri">https://www.youtube.com/watch?v=FcxiSwZcPvw</a> (Anzahl Schuhe usw.)</p></li>
</ol>
</section>
</section>
<section id="sec-spezialformate" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Spezialformate</h1>
<section id="hdf-netcdf" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="hdf-netcdf"><span class="header-section-number">11.1</span> HDF, netCDF</h2>
<p>https://stackoverflow.com/questions/28170623/how-to-read-hdf5-files-in-python</p>
</section>
<section id="maskierte-arrays" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="maskierte-arrays"><span class="header-section-number">11.2</span> Maskierte Arrays</h2>
<p>Maskierte Arrays (masked arrays) werden durch das Modul <code>numpy.ma</code> bereitgestellt. Maskierte Arrays erlauben es, Werte als ungültig oder fehlend zu markieren, ohne diese zu ersetzen oder zu löschen. Ein maskiertes Array besteht aus drei Elementen. Dies sind erstens ein normales NumPy-Array und zweitens eine Maske. Die Maske hat entweder den Wert <code>numpy.ma.nomask</code>, wenn kein Wert ungültig ist oder fehlt. Andernfalls besteht die Maske aus einem Array mit Wahrheitswerten für jedes Element des NumPy-Arrays, ob ein ungültiger/fehlender Wert <code>True</code> vorliegt oder nicht <code>False</code>. Alle Elemente des NumPy-Arrays, die in der zugehörigen Maske den Wahrheitswert <code>True</code> haben, werden im maskierten Array durch eine Zeichenkette ersetzt. Standardmäßig ist dies die Zeichenkette<code>numpy.ma.masked_print_option = '--'</code>, die mit dem genannten Argument geändert werden kann. Über die Attribute <code>.data</code> und <code>mask</code> kann auf das zugrundeliegende NumPy-Array und die Maske zugegriffen werden.</p>
<p><strong>ergänzen: masked_array ist ein Alias von MaskedArray; 16 weitere Methoden ein maskiertes Array zu erzeugen unter: <a href="https://numpy.org/doc/stable/reference/maskedarray.generic.html#constructing-masked-arrays" class="uri">https://numpy.org/doc/stable/reference/maskedarray.generic.html#constructing-masked-arrays</a> - einige davon sind wirklich praktisch</strong></p>
<div id="1625b0bc" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NumPy-Array:</span><span class="ch">\t\t</span><span class="sc">{</span>np_array_with_none<span class="sc">}</span><span class="ss">"</span>) </span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>maskiertes_array <span class="op">=</span> ma.masked_array(data <span class="op">=</span> np_array_with_none, mask <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"maskiertes Array:</span><span class="ch">\t</span><span class="sc">{</span>maskiertes_array<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Daten:</span><span class="ch">\t\t\t\t</span><span class="sc">{</span>maskiertes_array<span class="sc">.</span>data<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-10"><a href="#cb276-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maske:</span><span class="ch">\t\t\t\t</span><span class="sc">{</span>maskiertes_array<span class="sc">.</span>mask<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NumPy-Array:        [1 2 None 4]
maskiertes Array:   [1 2 -- --]
Daten:              [1 2 None 4]
Maske:              [False False  True  True]</code></pre>
</div>
</div>
<p>Das dritte Element eines maskierten Arrays ist der Füllwert, der beim Anlegen des maskierten Arrays mit dem Argument <code>fill_value</code> übergeben werden kann. Der Füllwert wird zunächst nur gespeichert und kann später verwendet werden, um ungültige bzw. fehlende Werte zu ersetzen. Der Füllwert wird mit der <code>Methode.filled()</code> aktiviert. Dann wird die Maske auf den Wert <code>numpy.ma.nomask</code> gesetzt und ein normales NumPy-Array ausgegeben. <strong>Testen: in Pandas fill_value is not stored in the Int64 object.</strong></p>
<div id="fad69c6f" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Anlegen eines maskierten Arrays mit einem Füllwert</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a>fill_value_array <span class="op">=</span> ma.masked_array(data <span class="op">=</span> daten_ohne_fehlende_werte[<span class="dv">0</span>:<span class="dv">4</span>], mask <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>], fill_value <span class="op">=</span> <span class="dv">42</span>) <span class="co"># np_array_with_none</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"In der Ausgabe wird ein normales maskiertes Array zurückgegeben:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert wird mit der Methode numpy.ma.filled() aktiviert:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>fill_value_array.fill_value <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert kann mit np.ma.fill_value = wert geändert werden:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>fill_value_array.fill_value <span class="op">=</span> <span class="va">None</span></span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert None bewirkt den Rückgriff auf einen datentypabhängigen Standardwert:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Das maskierte Array ist weiterhin vorhanden:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>In der Ausgabe wird ein normales maskiertes Array zurückgegeben:
[20.1 20.1 -- --]

Der Füllwert wird mit der Methode numpy.ma.filled() aktiviert:
[20.1 20.1 42.  42. ]

Der Füllwert kann mit np.ma.fill_value = wert geändert werden:
[20.1 20.1  1.5  1.5]

Der Füllwert None bewirkt den Rückgriff auf einen datentypabhängigen Standardwert:
[2.01e+01 2.01e+01 1.00e+20 1.00e+20]

Das maskierte Array ist weiterhin vorhanden:
[20.1 20.1 -- --]
</code></pre>
</div>
</div>
<p>Der Standardwert des Arguments <code>fill_value</code> ist <code>None</code>, mit dem beim Aufrufen der <code>Methode.filled()</code> abhängig vom Datentyp ein Standardwert eingesetzt wird.</p>
<div class="border">
<div id="d876d511" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dt <span class="kw">in</span> [np.int32, np.int64, np.float64, np.complex128, np.string_, np.bool_]:</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(dt, <span class="st">"</span><span class="ch">\t\t</span><span class="st">"</span>, np.ma.array([<span class="dv">0</span>, <span class="dv">1</span>], dtype <span class="op">=</span> dt).get_fill_value())</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'numpy.int32'&gt;        999999
&lt;class 'numpy.int64'&gt;        999999
&lt;class 'numpy.float64'&gt;          1e+20
&lt;class 'numpy.complex128'&gt;       (1e+20+0j)
&lt;class 'numpy.bytes_'&gt;       b'N/A'
&lt;class 'numpy.bool_'&gt;        True</code></pre>
</div>
</div>
<p>Quelle: <a href="https://numpy.org/doc/stable/reference/maskedarray.baseclass.html#numpy.ma.MaskedArray.fill_value" class="uri">https://numpy.org/doc/stable/reference/maskedarray.baseclass.html#numpy.ma.MaskedArray.fill_value</a></p>
</div>
<p>Problemtisch ist die Übergabe des Füllwerts <code>None</code>, wenn das initale NumPy-Array None enthält.</p>
<div id="wrn-fillvalueandnone" class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-52-contents" aria-controls="callout-52" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis&nbsp;11: Füllwert bei initialem NumPy-Array mit None
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-52" class="callout-52-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="c1ea458a" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Anlegen eines maskierten Arrays mit Füllwert, initiales NumPy-Array enthält None</span></span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>fill_value_array <span class="op">=</span> ma.masked_array(data <span class="op">=</span> np_array_with_none, mask <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>], fill_value <span class="op">=</span> <span class="dv">42</span>)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"In der Ausgabe wird ein normales maskiertes Array zurückgegeben:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert wird mit der Methode numpy.ma.filled() aktiviert:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>fill_value_array.fill_value <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert kann mit np.ma.fill_value = wert geändert werden:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>fill_value_array.fill_value <span class="op">=</span> <span class="va">None</span></span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Der Füllwert None bewirkt den Rückgriff auf einen datentypabhängigen Standardwert:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">.</span>filled()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb282-13"><a href="#cb282-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-14"><a href="#cb282-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Das maskierte Array ist weiterhin vorhanden:</span><span class="ch">\n</span><span class="sc">{</span>fill_value_array<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>In der Ausgabe wird ein normales maskiertes Array zurückgegeben:
[1 2 -- --]

Der Füllwert wird mit der Methode numpy.ma.filled() aktiviert:
[1 2 42 42]

Der Füllwert kann mit np.ma.fill_value = wert geändert werden:
[1 2 1.5 1.5]

Der Füllwert None bewirkt den Rückgriff auf einen datentypabhängigen Standardwert:
[1 2 '?' '?']

Das maskierte Array ist weiterhin vorhanden:
[1 2 -- --]
</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Fehlersuche und -bereinigung: None ist in NumPy problematisch und sollte manuell kontrolliert und entfernt werden</strong></p>
<p><strong>Fehlersuche und -bereinigung: Dokumentation lesen, Funktionen können unerwartetes Verhalten zeigen. Arbeiten Sie mit Testdaten, die den einzulesenden Datensatz möglichst gut repräsentieren und arbeiten Sie schrittweise an einer Lösung. Wenden Sie die Lösung auf den echten Datensatz an und vergleichen das Ergbnis zu dem Ergebnis der Testdaten.</strong></p>
<p><strong>Operationen mit fill_value(): <a href="https://numpy.org/doc/stable/reference/routines.ma.html#filling-a-masked-array" class="uri">https://numpy.org/doc/stable/reference/routines.ma.html#filling-a-masked-array</a></strong></p>
<section id="operationen-mit-maskierten-arrays" class="level3">
<h3 class="anchored" data-anchor-id="operationen-mit-maskierten-arrays">Operationen mit maskierten Arrays</h3>
<p>Wie rechnet man jetzt damit? Der Platzhalter ‘–’ ist vom NoneType, damit kann man nicht rechnen, wenigstens nicht mit mehreren Arrays. Siehe:<br>
<a href="https://numpy.org/doc/stable/reference/maskedarray.generic.html#operations-on-masked-arrays" class="uri">https://numpy.org/doc/stable/reference/maskedarray.generic.html#operations-on-masked-arrays</a></p>
<div id="14e34012" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(maskiertes_array.<span class="bu">sum</span>())</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(maskiertes_array))</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np_array_with_nan, np_array_with_nan.dtype)</span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(maskiertes_array, maskiertes_array.dtype)</span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> np_array_with_nan <span class="op">+</span> maskiertes_array</span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(result)</span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> np_array_with_nan <span class="op">+</span> maskiertes_array.data</span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(result)</span>
<span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> np.ma.masked_array(np_array_with_nan) <span class="op">+</span> maskiertes_array.data</span>
<span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> error:</span>
<span id="cb284-26"><a href="#cb284-26" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Die Eingabe führt zu der Fehlermeldung:</span><span class="ch">\n</span><span class="st">"</span>, error)</span>
<span id="cb284-27"><a href="#cb284-27" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb284-28"><a href="#cb284-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(result)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3
4
[1 2 nan 4] object
[1 2 -- --] object

Die Eingabe führt zu der Fehlermeldung:
 unsupported operand type(s) for +: 'float' and 'NoneType'

Die Eingabe führt zu der Fehlermeldung:
 unsupported operand type(s) for +: 'float' and 'NoneType'

Die Eingabe führt zu der Fehlermeldung:
 unsupported operand type(s) for +: 'float' and 'NoneType'</code></pre>
</div>
</div>
<p>The result of a unary ufunc is masked wherever the input is masked … or wherever the corresponding input fall outside the validity domain. (siehe: <a href="https://numpy.org/doc/stable/reference/maskedarray.generic.html#operations-on-masked-arrays">Dokumentation</a>)</p>
<p><strong>In der Doku steht eine Warnung, dass man sich nicht darauf verlassen kann, dass maskierte Werte nicht von Operationen manipuliert werden.</strong></p>
<div>

</div>
<div class="border quarto-layout-panel" data-layout="[[5, 90, 5], [5, 90, 5], [1]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<p>Arithmetic and comparison operations are supported by masked arrays. As much as possible, invalid entries of a masked array are not processed, meaning that the corresponding <code>data</code> entries <em>should</em> be the same before and after the operation.</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 90.0%;justify-content: flex-start;">
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warnung
</div>
</div>
<div class="callout-body-container callout-body">
<p>We need to stress that this behavior may not be systematic, that masked data may be affected by the operation in some cases and therefore users should not rely on this data remaining unchanged.</p>
</div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 5.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p><a href="https://numpy.org/doc/stable/reference/maskedarray.generic.html#operations-on-masked-arrays" class="uri">https://numpy.org/doc/stable/reference/maskedarray.generic.html#operations-on-masked-arrays</a></p>
</div>
</div>
</div>
<p><strong>Unklar ist, welche Operationen nicht verlässlich funktionieren.</strong></p>
<p>Das Prinzip: Das Modul <code>numpy.ma</code> implementiert die meisten NumPy-Funktionen. Funktionen, die nur einen bestimmten Wertebereich als Eingabe akzeptieren, geben den Wert <code>masked</code> zurück, wenn Werte außerhalb des gültigen Bereichs übergeben werden. Ein Beispiel ist die <code>ma.log()</code>.</p>
<div id="4ef8ead9" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>ma.log([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>])</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<pre><code>masked_array(data=[0.0, 0.6931471805599453, 1.0986122886681098, --],
             mask=[False, False, False,  True],
       fill_value=1e+20)</code></pre>
</div>
</div>
<p>In der Ausgabe wird der Man kann auch Werte maskieren, das ist aber abgesehen von Integer nicht exakt. Für Fließkommazahlen werden auch minimal größere oder kleinere Werte maskiert. Siehe: <a href="https://numpy.org/doc/stable/reference/generated/numpy.ma.masked_values.html" class="uri">https://numpy.org/doc/stable/reference/generated/numpy.ma.masked_values.html</a> Fehlende Werte in NumPy maskieren <a href="https://numpy.org/doc/stable/reference/maskedarray.html" class="uri">https://numpy.org/doc/stable/reference/maskedarray.html</a></p>
<p>… können auch mit genfromtxt erzeugt werden <code>usemask</code> We may also want to keep track of the occurrence of missing data by constructing a boolean mask, with True entries where data was missing and False otherwise. To do that, we just have to set the optional argument usemask to True (the default is False). The output array will then be a MaskedArray.</p>
<p><strong>Rückkehr des fill_value nach <a href="https://github.com/numpy/numpy/issues/20850#issuecomment-2077856842" class="uri">https://github.com/numpy/numpy/issues/20850#issuecomment-2077856842</a></strong></p>
<pre><code>&gt;&gt;&gt; arr1 = np.ma.masked_equal(arr, value=0)
&gt;&gt;&gt; arr1.fill_value
0.0
&gt;&gt;&gt; arr2 = np.ma.masked_less_equal(arr, value=0)
&gt;&gt;&gt; arr2.fill_value
1e+20</code></pre>
</section>
<section id="unmasking-and-hard-masks" class="level3">
<h3 class="anchored" data-anchor-id="unmasking-and-hard-masks">Unmasking and hard masks</h3>
<p><a href="https://numpy.org/doc/stable/reference/maskedarray.generic.html#unmasking-an-entry" class="uri">https://numpy.org/doc/stable/reference/maskedarray.generic.html#unmasking-an-entry</a></p>
<p>Wie hier <a href="https://github.com/numpy/numpy/issues/20850" class="uri">https://github.com/numpy/numpy/issues/20850</a> erwähnt, nutzt keine der genannten Methoden fill_value und das Verhalten sei inkonstistent: <strong>testen, das Verhalten von fill_value = None ist seltsam, aber works as designed</strong></p>
<ul>
<li><p>ma.MaskedArray.filled(fill_value=None) uses a.fill_value when fill_value is None</p></li>
<li><p>a.mask = ma.unmasked ignores a.fill_value</p></li>
<li><p>ma.fix_invalid(a, mask=False, copy=True, fill_value=None) uses a.fill_value when fill_value is None</p></li>
<li><p>ma.MaskedArray.tolist(fill_value=None) ignores a.fill_value</p></li>
<li><p>ma.MaskedArray.tobytes(fill_value=None, order=‘C’) uses a.fill_value when fill_value is None</p></li>
<li><p>ma.min/ma.max/ma.argmin/ma.argmax ignore a.fill_value</p></li>
</ul>
</section>
</section>
</section>
<section id="das-wichtigste-vielleicht-als-video" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Das Wichtigste (vielleicht als Video)</h1>
</section>
<section id="lernzielkontrolle" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Lernzielkontrolle</h1>
<ul>
<li><p>Kompetenzquiz (ggf. aufklappbarer Callout Block, Textverweis für PDF, polierte Lösungen evntl. via Lumi später entscheiden)</p></li>
<li><p>Übungsaufgaben (kleine Projekte)</p></li>
<li><p>Prüfungsaufgaben (ohne Lösungen)</p></li>
</ul>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Literatur</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Arnold-2023-funktionen-module-dateien" class="csl-entry" role="listitem">
Arnold, Simone. 2023a. <span>„Datenanalyse mit Python. Funktionen Module Dateien.“</span> Fachhochschule Dortmund.
</div>
<div id="ref-Arnold-2023-numpy-dateien" class="csl-entry" role="listitem">
———. 2023b. <span>„Datenanalyse mit Python. NumPy und Dateien.“</span> Fachhochschule Dortmund.
</div>
<div id="ref-Dasu-Johnson-2003" class="csl-entry" role="listitem">
Dasu, Tamraparni, und Theodore Johnson. 2003. <span>„Exploratory Data Mining and Data Cleaning“</span>. Hoboken; New Jersey.: John Wiley &amp; Sons, Inc. 2003. <a href="https://download.e-bookshelf.de/download/0000/5837/88/L-G-0000583788-0002360584.pdf">https://download.e-bookshelf.de/download/0000/5837/88/L-G-0000583788-0002360584.pdf</a>.
</div>
<div id="ref-Wickham-2014" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>„Tidy Data“</span>. Journal of Statistical Software. 2014. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
<div id="ref-R-for-Data-Science" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Çetinkaya-Rundel, und Garrett Grolemund. 2023. <span>„R for data science: Import, tidy, transform, visualize, and model data“</span>. Beijing; Boston; Farnham; Sebastopol; Tokyo: O’Reilly. 2023. <a href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz/</a>.
</div>
<div id="ref-Ziemann-2016" class="csl-entry" role="listitem">
Ziemann, Mark, Yotam Eren, und Assam El-Osta. 2016. <span>„Gene name errors are widespread in the scientific literature“</span>. <em>Genome Biol.</em> 17 (1).
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>